# LLMを用いた給与計算自動アプリケーション

本プロジェクトは、LLM（大規模言語モデル）を活用して給与計算の自動化を実現するアプリケーションです。従来の手動作業を削減し、効率的かつ正確な給与計算を目指します。

## ディレクトリ構成

- **applicationフォルダ**  
  現在作成に取り組んでいるアプリケーション本体を格納しています。実行に必要なパッケージは、このフォルダ内の `requirements.txt` を用いてインストールしてください。

- **dataフォルダ**  
  テストに使用するXlsxやCSVなどのデータファイル、及びLLMに投げるプロンプトのテスト用ファイルや過去のバージョンが、testディレクトリに配置されています。

## 実行方法

1. **パッケージのインストール**  
   アプリケーションの実行には、`application` フォルダ内の `requirements.txt` に記載されたパッケージを使用します。以下のコマンドでインストールしてください。

   ```bash
   pip install -r application/requirements.txt
   ```

2. **アプリケーションの起動**  
   インストールが完了したら、通常のPython実行方法に従いアプリケーションを起動してください。

## バージョン管理

バージョンを更新する際は、フォルダ名を `application_v2` のように増やすのではなく、Git のタグ機能を用いてバージョン管理を行ってください。これにより、コードの履歴や変更内容の管理が一元化されます。

## TODO / 未解決の課題

### 【GUIウィンドウ非表示の問題】

- **現状**  
  Windows環境においてプログラム実行時、コンソールには「設定ファイルを正常に読み込みました」や「タスクを正常に作成しました．タスク数：4」と表示されるにもかかわらず、GUIウィンドウが表示されない問題が発生しています。

- **原因と考察**  
  - Qt の `QPixmap`（および `QImage`）は、GUIシステムの初期化後に生成する必要があるため、グローバルで PIL を用いて画像変換処理を実施していたことが原因の一つと考えられます。  
  - また、`AgentCollection` の初期化やタスク生成がメインスレッド上で重く実行されることにより、GUI描画がブロックされる可能性もありますが、主な焦点は `QPixmap` 生成のタイミングにあると考えられます。

- **修正案**  
  - グローバルでの画像変換処理を削除し、`ChatBubbleWidget` のインスタンス生成時（`QApplication` 生成後）に遅延処理として画像変換を行う。  
  - 32bit RGBA画像の `QImage` 生成時に、1行あたりのバイト数（`width × 4`）を明示的に指定する。

- **修正後の状況**  
  上記の修正案を適用したものの、Windows環境でのGUI起動問題は解決せず、現在はWSL環境での実行を試みる状況です。

### 【その他の課題】

- タスク選択時に「生成中」と表示されるが、生成速度が遅いため、マルチスレッド化の実装が必要と考えられる。
- 「納品物作成1-1」タスクでは、処理時の日付を手動で入力する必要があるため、自動取得できる仕組みへの改修が望ましい。
- タスク実行時に毎回「Yes」または「No」の入力が求められるため、GUI上にYes／Noボタンを組み込むなど、ユーザーインターフェースの改善が必要。
- ルール確認時に表示された内容がチャットウィンドウ外に出てしまい、スクロール範囲外に隠れる問題の解消が必要。
- 出力されたCSVファイルが従来の仕様と大きく異なり、全スタッフ分のデータ処理ができず、一部スタッフコードのみのデータや欠損が見受けられる問題の修正。
- タスク管理において、「納品物1-1」や「納品物1-2」といった名称が具体的にどのタスクを指すのか分かりにくいため、旧アプリのタスク表記と統一することが望まれる。

