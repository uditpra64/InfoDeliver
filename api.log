2025-03-19 16:32:18,535 - payroll_api - INFO - Service modules imported successfully
2025-03-19 16:32:18,558 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 16:32:18,595 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 16:32:18,596 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 16:32:18,596 - payroll_api - INFO - FileService initialized successfully
2025-03-19 16:32:18,596 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 16:32:18,598 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 16:32:18,598 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 16:32:18,598 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 16:32:18,599 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 16:32:18,604 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 16:32:18,604 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 16:32:21,248 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 16:32:21,252 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 16:32:21,252 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 16:32:21,252 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 16:32:21,253 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 16:32:33,082 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 16:32:33,082 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 16:32:35,547 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 16:32:35,568 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 16:32:35,590 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 16:32:35,597 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 16:32:35,800 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 16:32:35,800 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 16:32:35,800 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 16:32:35,800 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 16:32:35,800 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 16:32:35,800 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 16:32:35,800 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 16:32:35,800 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 16:32:35,800 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 16:32:36,020 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 16:32:36,020 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 16:32:36,020 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 16:32:36,020 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 16:32:36,020 - payroll_api - INFO - Initializing authentication
2025-03-19 16:32:36,020 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 16:32:36,020 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 16:32:51,259 - payroll_api - INFO - API shutting down
2025-03-19 16:32:51,259 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 16:32:57,396 - payroll_api - INFO - Service modules imported successfully
2025-03-19 16:32:57,417 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 16:32:57,449 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 16:32:57,449 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 16:32:57,449 - payroll_api - INFO - FileService initialized successfully
2025-03-19 16:32:57,450 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 16:32:57,450 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 16:32:57,450 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 16:32:57,450 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 16:32:57,450 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 16:32:57,452 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 16:32:57,452 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 16:32:59,736 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 16:32:59,736 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 16:32:59,736 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 16:32:59,736 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 16:32:59,736 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 16:33:07,796 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 16:33:07,796 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 16:33:10,239 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 16:33:10,261 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 16:33:10,275 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 16:33:10,291 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 16:33:10,515 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 16:33:10,515 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 16:33:10,530 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 16:33:10,530 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 16:33:10,530 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 16:33:10,531 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 16:33:10,531 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 16:33:10,531 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 16:33:10,531 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 16:33:10,716 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 16:33:10,716 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 16:33:10,716 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 16:33:10,716 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 16:33:10,716 - payroll_api - INFO - Initializing authentication
2025-03-19 16:33:10,716 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 16:33:10,716 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 16:33:54,960 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "C:\Users\Udit Pradhan\formai_excelllm\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-03-19 17:03:09,660 - payroll_api - INFO - API shutting down
2025-03-19 17:03:09,662 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:03:21,314 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:03:21,352 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:03:21,398 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:03:21,408 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:03:21,408 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:03:21,408 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:03:21,409 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:03:21,409 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:03:21,409 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:03:21,409 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:03:21,416 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:03:21,416 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:03:25,855 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:03:25,857 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:03:25,857 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:03:25,857 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:03:25,857 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:03:42,789 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:03:42,789 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:03:45,251 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:03:45,292 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:03:45,317 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:03:45,339 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:03:45,585 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:03:45,585 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:03:45,585 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:03:45,588 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:03:45,588 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:03:45,588 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:03:45,588 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:03:45,588 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:03:45,588 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:03:45,808 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:03:45,815 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:03:45,815 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:03:45,816 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:03:45,816 - payroll_api - INFO - Initializing authentication
2025-03-19 17:03:45,817 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:03:45,817 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:07:03,655 - payroll_api - INFO - API shutting down
2025-03-19 17:07:03,656 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:07:13,825 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:07:13,841 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:07:13,873 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:07:13,874 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:07:13,874 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:07:13,874 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:07:13,874 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:07:13,875 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:07:13,875 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:07:13,875 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:07:13,879 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:07:13,879 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:07:16,240 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:07:16,249 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:07:16,249 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:07:16,249 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:07:16,249 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:07:24,520 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:07:24,520 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:07:26,968 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:07:26,998 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:07:27,020 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:07:27,027 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:07:27,236 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:07:27,236 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:07:27,236 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:07:27,250 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:07:27,250 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:07:27,251 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:07:27,251 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:07:27,251 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:07:27,251 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:07:27,469 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:07:27,469 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:07:27,470 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:07:27,470 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:07:27,470 - payroll_api - INFO - Initializing authentication
2025-03-19 17:07:27,470 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:07:27,470 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:09:33,466 - payroll_api - INFO - API shutting down
2025-03-19 17:09:33,468 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:11:20,041 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:11:20,044 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:11:20,090 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:11:20,090 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:11:20,091 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:11:20,091 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:11:20,091 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:11:20,091 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:11:20,093 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:11:20,093 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:11:20,093 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:11:20,093 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:11:21,919 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:11:21,920 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:11:21,920 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:11:21,920 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:11:21,920 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:11:28,526 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:11:28,526 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:11:31,080 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:11:31,104 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:11:31,133 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:11:31,140 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:11:31,341 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:11:31,341 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:11:31,341 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:11:31,341 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:11:31,341 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:11:31,341 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:11:31,341 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:11:31,341 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:11:31,341 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:11:31,540 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:11:31,540 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:11:31,540 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:11:31,540 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:11:31,540 - payroll_api - INFO - Initializing authentication
2025-03-19 17:11:31,540 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:11:31,540 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:16:56,503 - payroll_api - INFO - API shutting down
2025-03-19 17:16:56,503 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:17:03,223 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:17:03,244 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:17:03,281 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:17:03,282 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:17:03,282 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:17:03,283 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:17:03,283 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:17:03,283 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:17:03,284 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:17:03,285 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:17:03,290 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:17:03,290 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:17:06,458 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:17:06,462 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:17:06,463 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:17:06,463 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:17:06,463 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:17:17,020 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:17:17,020 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:17:19,725 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:17:19,758 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:17:19,793 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:17:19,805 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:17:20,036 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:17:20,037 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:17:20,038 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:17:20,039 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:17:20,039 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:17:20,040 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:17:20,041 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:17:20,042 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:17:20,042 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:17:20,317 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:17:20,318 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:17:20,318 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:17:20,318 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:17:20,318 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:17:20,318 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:17:20,320 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:17:20,320 - payroll_api - INFO - Initializing authentication
2025-03-19 17:17:20,320 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:17:20,320 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:18:20,482 - payroll_api - INFO - API shutting down
2025-03-19 17:18:20,485 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:18:27,162 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:18:27,184 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:18:27,228 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:18:27,229 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:18:27,230 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:18:27,230 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:18:27,230 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:18:27,231 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:18:27,231 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:18:27,231 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:18:27,231 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:18:27,231 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:18:29,662 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:18:29,665 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:18:29,665 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:18:29,666 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:18:29,666 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:18:39,657 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:18:39,657 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:18:42,044 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:18:42,076 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:18:42,104 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:18:42,116 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:18:42,332 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:18:42,332 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:18:42,333 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:18:42,333 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:18:42,334 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:18:42,334 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:18:42,335 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:18:42,335 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:18:42,335 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:18:42,610 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:18:42,611 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:18:42,611 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:18:42,612 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:18:42,612 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:18:42,613 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:18:42,614 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:18:42,614 - payroll_api - INFO - Initializing authentication
2025-03-19 17:18:42,615 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:18:42,615 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:19:25,544 - payroll_api - INFO - API shutting down
2025-03-19 17:19:25,545 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:19:32,024 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:19:32,062 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:19:32,111 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:19:32,111 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:19:32,114 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:19:32,114 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:19:32,114 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:19:32,115 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:19:32,115 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:19:32,116 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:19:32,118 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:19:32,118 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:19:35,526 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:19:35,530 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:19:35,530 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:19:35,530 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:19:35,531 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:19:45,042 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:19:45,042 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:19:45,051 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:19:45,380 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:19:45,555 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:19:45,721 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:19:45,899 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:19:46,048 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:19:46,232 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:19:46,407 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:19:47,117 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:19:47,404 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:19:47,587 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:19:47,587 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:19:47,613 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:19:47,613 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:19:47,613 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:19:47,618 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:19:47,618 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:19:47,645 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:19:47,645 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:19:47,676 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:19:47,686 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:19:47,688 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:19:47,694 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:19:47,706 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:19:47,885 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:19:47,888 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:19:47,896 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:19:47,897 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:19:47,897 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:19:47,898 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:19:47,898 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:19:47,899 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:19:47,899 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:19:47,899 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:19:47,900 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:19:48,080 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:19:48,080 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:19:48,080 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:19:48,080 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:19:48,080 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:19:48,080 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:19:48,080 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:19:48,096 - payroll_api - INFO - Initializing authentication
2025-03-19 17:19:48,096 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:19:48,096 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:20:04,784 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:20:04,784 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 17:20:04,784 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 17:20:04,785 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:20:04,785 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:20:04,786 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 17:20:04,786 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 17:20:04,786 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:20:04,786 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:20:04,786 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 17:20:04,787 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 17:20:04,787 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:20:04,787 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 17:20:04,789 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 17:20:04,790 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:20:04,790 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:20:04,791 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-19 17:20:04,791 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-19 17:20:05,067 - payroll_api - DEBUG - Authentication result: False
2025-03-19 17:28:01,950 - payroll_api - INFO - API shutting down
2025-03-19 17:28:01,952 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:28:01,957 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:28:01,981 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:30:07,306 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:30:07,326 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:30:07,363 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:30:07,365 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:30:07,365 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:30:07,366 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:30:07,366 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:30:07,366 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:30:07,367 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:30:07,367 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:30:07,372 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:30:07,372 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:30:09,609 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:30:09,615 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:30:09,615 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:30:09,615 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:30:09,615 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:30:43,055 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:30:43,055 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:30:43,062 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:30:43,287 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:30:43,461 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:30:43,638 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:30:43,816 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:30:44,007 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:30:45,867 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:30:46,034 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:30:46,719 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:30:47,006 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:30:47,205 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:30:47,211 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:30:47,245 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:30:47,246 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:30:47,246 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:30:47,256 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:30:47,256 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:30:47,285 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:30:47,286 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:30:47,612 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:30:47,622 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:30:47,623 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:30:47,695 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:30:47,714 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:30:47,874 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:30:47,898 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:30:47,900 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:30:47,900 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:30:47,901 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:30:47,902 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:30:47,903 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:30:47,904 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:30:47,904 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:30:47,905 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:30:47,905 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:30:48,185 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:30:48,186 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:30:48,186 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:30:48,187 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:30:48,187 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:30:48,188 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:30:48,188 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:30:48,189 - payroll_api - INFO - Initializing authentication
2025-03-19 17:30:48,189 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:30:48,190 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:31:20,902 - payroll_api - INFO - API shutting down
2025-03-19 17:31:20,902 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:31:20,904 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:31:20,906 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:32:32,997 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:32:33,024 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:32:33,058 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:32:33,058 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:32:33,058 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:32:33,058 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:32:33,058 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:32:33,058 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:32:33,062 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:32:33,062 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:32:33,065 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:32:33,065 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:32:35,797 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:32:35,797 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:32:35,797 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:32:35,797 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:32:35,797 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:32:44,094 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:32:44,094 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:32:44,094 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:32:44,366 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:32:44,576 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:32:44,789 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:32:44,987 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:32:45,185 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:32:45,392 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:32:45,723 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:32:46,355 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:32:46,587 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:32:46,753 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:32:46,769 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:32:46,796 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:32:46,797 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:32:46,797 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:32:46,798 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:32:46,800 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:32:46,819 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:32:46,819 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:32:46,847 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:32:46,853 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:32:46,858 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:32:46,866 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:32:46,893 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:32:47,047 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:32:47,067 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:32:47,067 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:32:47,067 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:32:47,067 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:32:47,067 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:32:47,073 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:32:47,073 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:32:47,074 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:32:47,074 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:32:47,075 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:32:47,269 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:32:47,269 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:32:47,278 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:32:47,278 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:32:47,278 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:32:47,279 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:32:47,279 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:32:47,279 - payroll_api - INFO - Initializing authentication
2025-03-19 17:32:47,279 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:32:47,280 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:33:22,478 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:33:22,478 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 17:33:22,479 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 17:33:22,479 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:33:22,479 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:33:22,480 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 17:33:22,481 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 17:33:22,481 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:33:22,482 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:33:22,482 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 17:33:22,482 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 17:33:22,482 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:33:22,483 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 17:33:22,485 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 17:33:22,485 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:33:22,485 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:42:47,982 - payroll_api - INFO - API shutting down
2025-03-19 17:42:47,982 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:42:47,982 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:42:48,018 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:42:53,047 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:42:53,049 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:42:53,089 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:42:53,089 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:42:53,089 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:42:53,090 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:42:53,090 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:42:53,090 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:42:53,090 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:42:53,090 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:42:53,090 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:42:53,090 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:42:54,980 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:42:54,980 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:42:54,980 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:42:54,980 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:42:54,980 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:43:03,598 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:43:03,598 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:43:03,606 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:43:03,828 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:43:04,013 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:43:04,178 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:43:04,344 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:43:04,527 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:43:04,713 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:43:04,895 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:43:06,353 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:43:06,576 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:43:06,762 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:43:06,764 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:43:06,785 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:43:06,785 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:43:06,785 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:43:06,788 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:43:06,788 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:43:06,801 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:43:06,801 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:43:06,826 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:43:06,831 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:43:06,831 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:43:06,839 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:43:06,858 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:43:07,018 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:43:07,034 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:43:07,041 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:43:07,042 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:43:07,043 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:43:07,045 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:43:07,046 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:43:07,049 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:43:07,051 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:43:07,052 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:43:07,052 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:43:07,281 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:43:07,290 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:43:07,290 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:43:07,290 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:43:07,290 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:43:07,291 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:43:07,291 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:43:07,293 - payroll_api - INFO - Initializing authentication
2025-03-19 17:43:07,293 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:43:07,293 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:43:07,294 - payroll_api - INFO - API shutting down
2025-03-19 17:43:07,295 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:43:07,335 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:43:07,336 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:43:13,391 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:43:13,412 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:43:13,448 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:43:13,449 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:43:13,449 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:43:13,449 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:43:13,449 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:43:13,450 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:43:13,450 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:43:13,450 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:43:13,452 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:43:13,452 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:43:16,224 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:43:16,240 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:43:16,240 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:43:16,240 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:43:16,240 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:43:25,421 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:43:25,421 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:43:25,421 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:43:25,637 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:43:25,808 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:43:25,974 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:43:26,140 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:43:26,319 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:43:26,489 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:43:26,654 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:43:27,187 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:43:27,436 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:43:27,608 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:43:27,609 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:43:27,642 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:43:27,643 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:43:27,643 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:43:27,646 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:43:27,646 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:43:27,673 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:43:27,673 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:43:27,694 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:43:27,709 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:43:27,711 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:43:27,719 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:43:27,745 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:43:27,903 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:43:27,925 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:43:27,928 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:43:27,929 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:43:27,929 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:43:27,930 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:43:27,930 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:43:27,931 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:43:27,931 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:43:27,931 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:43:27,932 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:43:28,120 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:43:28,134 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:43:28,134 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:43:28,134 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:43:28,135 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:43:28,135 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:43:28,135 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:43:28,136 - payroll_api - INFO - Initializing authentication
2025-03-19 17:43:28,137 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:43:28,137 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:44:19,870 - payroll_api - INFO - API shutting down
2025-03-19 17:44:19,871 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:44:19,873 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:44:19,876 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:44:26,209 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:44:26,227 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:44:26,272 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:44:26,272 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:44:26,274 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:44:26,274 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:44:26,274 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:44:26,274 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:44:26,274 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:44:26,274 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:44:26,274 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:44:26,274 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:44:28,437 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:44:28,437 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:44:28,437 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:44:28,437 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:44:28,437 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:49:00,323 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:49:00,342 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:49:00,373 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:49:00,374 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:49:00,375 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:49:00,375 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:49:00,375 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:49:00,376 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:49:00,378 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:49:00,378 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:49:00,381 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:49:00,382 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:49:02,139 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:49:02,155 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:49:02,155 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:49:02,155 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:49:02,155 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:49:08,623 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:49:08,623 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:49:08,634 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:49:08,855 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:49:09,022 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:49:09,189 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:49:09,355 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:49:09,522 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:49:09,687 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:49:09,855 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:49:10,371 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:49:10,588 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:49:10,785 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:49:10,788 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:49:10,811 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:49:10,811 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:49:10,811 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:49:10,814 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:49:10,815 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:49:10,834 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:49:10,834 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:49:10,853 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:49:10,860 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:49:10,861 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:49:10,866 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:49:10,883 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:49:11,038 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:49:11,068 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:49:11,071 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:49:11,071 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:49:11,071 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:49:11,072 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:49:11,072 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:49:11,073 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:49:11,073 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:49:11,073 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:49:11,073 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:49:11,255 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:49:11,255 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:49:11,255 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:49:11,255 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:49:11,255 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:49:11,255 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:49:11,255 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:49:11,255 - payroll_api - INFO - Initializing authentication
2025-03-19 17:49:11,255 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:49:11,255 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:49:27,647 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:49:27,647 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 17:49:27,647 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 17:49:27,648 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:49:27,648 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:49:27,649 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 17:49:27,649 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 17:49:27,649 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:49:27,649 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:49:27,649 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 17:49:27,650 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 17:49:27,650 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:49:27,650 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 17:49:27,652 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 17:49:27,652 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:49:27,653 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:52:52,607 - payroll_api - INFO - API shutting down
2025-03-19 17:52:52,608 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:52:52,609 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:52:52,618 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:52:57,672 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:52:57,697 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:52:57,723 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:52:57,723 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:52:57,723 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:52:57,723 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:52:57,723 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:52:57,723 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:52:57,729 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:52:57,729 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:52:57,731 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:52:57,731 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:52:59,569 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:52:59,586 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:52:59,586 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:52:59,586 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:52:59,586 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:53:07,475 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:53:07,475 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:53:07,485 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:53:07,736 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:53:07,917 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:53:08,083 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:53:08,250 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:53:08,417 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:53:08,595 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:53:08,750 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:53:09,300 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:53:09,737 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:53:09,916 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:53:09,918 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:53:09,947 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:53:09,947 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:53:09,947 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:53:09,951 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:53:09,951 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:53:09,970 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:53:09,971 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:53:09,994 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:53:10,003 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:53:10,003 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:53:10,014 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:53:10,021 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:53:10,200 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:53:10,215 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:53:10,218 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:53:10,218 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:53:10,218 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:53:10,219 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:53:10,219 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:53:10,219 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:53:10,220 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:53:10,220 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:53:10,220 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:53:10,402 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:53:10,402 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:53:10,402 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:53:10,402 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:53:10,402 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:53:10,402 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:53:10,402 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:53:10,402 - payroll_api - INFO - Initializing authentication
2025-03-19 17:53:10,402 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:53:10,402 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:53:34,424 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:53:34,424 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 17:53:34,425 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 17:53:34,425 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:53:34,425 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:53:34,425 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 17:53:34,425 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 17:53:34,425 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:53:34,425 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:53:34,426 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 17:53:34,426 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 17:53:34,426 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:53:34,426 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 17:53:34,429 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 17:53:34,429 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:53:34,429 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:57:01,489 - payroll_api - INFO - API shutting down
2025-03-19 17:57:01,491 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:57:01,493 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:57:01,508 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:57:07,956 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:57:07,986 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:57:08,022 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:57:08,022 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:57:08,024 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:57:08,024 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:57:08,024 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:57:08,024 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:57:08,025 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:57:08,026 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:57:08,027 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:57:08,027 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:57:10,205 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:57:10,205 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:57:10,205 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:57:10,205 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:57:10,205 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:57:17,436 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:57:17,438 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:57:17,440 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:57:17,775 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:57:17,968 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:57:18,143 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:57:18,320 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:57:18,486 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:57:18,651 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:57:18,836 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:57:19,338 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:57:19,583 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:57:19,761 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:57:19,764 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:57:19,787 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:57:19,787 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:57:19,788 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:57:19,790 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:57:19,790 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:57:19,809 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:57:19,809 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:57:19,830 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:57:19,837 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:57:19,837 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:57:19,844 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:57:19,865 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:57:20,022 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:57:20,058 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:57:20,062 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:57:20,064 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:57:20,064 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:57:20,069 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:57:20,070 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:57:20,073 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:57:20,075 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:57:20,076 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:57:20,077 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:57:20,335 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:57:20,335 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:57:20,335 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:57:20,335 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:57:20,335 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:57:20,340 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:57:20,340 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:57:20,340 - payroll_api - INFO - Initializing authentication
2025-03-19 17:57:20,341 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:57:20,341 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:57:20,343 - payroll_api - INFO - API shutting down
2025-03-19 17:57:20,343 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:57:20,386 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:57:20,389 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:57:25,984 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:57:26,004 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:57:26,040 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:57:26,040 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:57:26,040 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:57:26,040 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:57:26,040 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:57:26,040 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:57:26,040 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:57:26,040 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:57:26,048 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:57:26,048 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:57:28,583 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:57:28,583 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:57:28,596 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:57:28,596 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:57:28,597 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:57:36,963 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:57:36,963 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:57:36,978 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:57:37,163 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:57:37,563 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:57:37,729 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:57:37,897 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:57:38,077 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:57:38,244 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:57:38,414 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:57:38,980 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:57:39,196 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:57:39,380 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:57:39,380 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:57:39,400 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:57:39,400 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:57:39,400 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:57:39,411 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:57:39,412 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:57:39,433 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:57:39,435 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:57:39,458 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:57:39,468 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:57:39,470 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:57:39,479 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:57:39,499 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:57:39,660 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:57:39,683 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:57:39,691 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:57:39,692 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:57:39,692 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:57:39,692 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:57:39,692 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:57:39,693 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:57:39,694 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:57:39,694 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:57:39,694 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:57:39,879 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:57:39,893 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:57:39,893 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:57:39,894 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:57:39,894 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:57:39,894 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:57:39,894 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:57:39,894 - payroll_api - INFO - Initializing authentication
2025-03-19 17:57:39,895 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:57:39,895 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 17:57:55,605 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:57:55,606 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 17:57:55,606 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 17:57:55,606 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:57:55,606 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:57:55,606 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 17:57:55,607 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 17:57:55,607 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:57:55,608 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 17:57:55,608 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 17:57:55,608 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 17:57:55,608 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 17:57:55,609 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 17:57:55,611 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 17:57:55,611 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:57:55,612 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:57:55,612 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-19 17:57:55,613 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-19 17:57:55,898 - payroll_api - DEBUG - Authentication result: False
2025-03-19 17:58:54,605 - payroll_api - INFO - API shutting down
2025-03-19 17:58:54,606 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:58:54,608 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:58:54,612 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 17:59:06,786 - payroll_api - INFO - Service modules imported successfully
2025-03-19 17:59:06,821 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:59:06,855 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:59:06,856 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 17:59:06,856 - payroll_api - INFO - FileService initialized successfully
2025-03-19 17:59:06,857 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:59:06,857 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 17:59:06,857 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 17:59:06,859 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:59:06,859 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 17:59:06,861 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 17:59:06,861 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 17:59:09,437 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 17:59:09,448 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 17:59:09,448 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 17:59:09,448 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 17:59:09,448 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 17:59:20,472 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 17:59:20,472 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 17:59:20,477 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 17:59:20,798 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:59:20,973 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 17:59:21,147 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 17:59:21,322 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 17:59:21,502 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 17:59:21,669 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 17:59:21,845 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 17:59:22,461 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 17:59:22,714 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 17:59:22,889 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 17:59:22,892 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 17:59:22,920 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 17:59:22,920 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 17:59:22,920 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 17:59:22,920 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 17:59:22,920 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 17:59:22,957 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 17:59:22,957 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 17:59:22,985 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 17:59:22,989 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 17:59:22,989 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 17:59:23,005 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 17:59:23,033 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 17:59:23,190 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 17:59:23,380 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 17:59:23,388 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 17:59:23,388 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 17:59:23,388 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 17:59:23,388 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 17:59:23,388 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 17:59:23,388 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 17:59:23,388 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 17:59:23,388 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 17:59:23,388 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 17:59:23,674 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 17:59:23,674 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 17:59:23,675 - payroll_api - INFO - Admin password from env: password
2025-03-19 17:59:23,675 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 17:59:23,676 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 17:59:23,676 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 17:59:23,677 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 17:59:23,677 - payroll_api - INFO - Initializing authentication
2025-03-19 17:59:23,679 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 17:59:23,679 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 18:00:00,248 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:00:00,249 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:00:00,249 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:00:00,249 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:00:00,250 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:00:00,250 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:00:00,250 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 18:00:00,250 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:00:00,251 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:00:00,251 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 18:00:00,251 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 18:00:00,251 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:00:00,252 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:00:00,255 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 18:00:00,255 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:00:00,256 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:00:00,256 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-19 18:00:00,257 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-19 18:00:00,537 - payroll_api - DEBUG - Authentication result: False
2025-03-19 18:02:31,878 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:02:31,878 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:02:31,878 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:02:31,878 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:02:31,878 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:02:31,879 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:02:31,879 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:33]
2025-03-19 18:02:31,879 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:02:31,879 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:02:31,880 - python_multipart.multipart - DEBUG - Calling on_field_name with data[34:42]
2025-03-19 18:02:31,881 - python_multipart.multipart - DEBUG - Calling on_field_data with data[43:51]
2025-03-19 18:02:31,881 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:02:31,881 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:02:31,883 - payroll_api - DEBUG - Login attempt: username=user, password=***
2025-03-19 18:02:31,883 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:02:31,883 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:02:32,237 - payroll_api - DEBUG - Authentication result: True
2025-03-19 18:02:55,858 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:02:55,859 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:02:55,859 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:02:55,860 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:02:55,860 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:02:55,860 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:02:55,861 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:33]
2025-03-19 18:02:55,861 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:02:55,861 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:02:55,861 - python_multipart.multipart - DEBUG - Calling on_field_name with data[34:42]
2025-03-19 18:02:55,862 - python_multipart.multipart - DEBUG - Calling on_field_data with data[43:51]
2025-03-19 18:02:55,862 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:02:55,862 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:02:55,863 - python_multipart.multipart - DEBUG - Calling on_field_name with data[52:57]
2025-03-19 18:02:55,863 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:02:55,864 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:02:55,864 - python_multipart.multipart - DEBUG - Calling on_field_name with data[59:68]
2025-03-19 18:02:55,864 - python_multipart.multipart - DEBUG - Calling on_field_data with data[69:75]
2025-03-19 18:02:55,865 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:02:55,865 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:02:55,865 - python_multipart.multipart - DEBUG - Calling on_field_name with data[76:89]
2025-03-19 18:02:55,866 - python_multipart.multipart - DEBUG - Calling on_field_data with data[90:96]
2025-03-19 18:02:55,866 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:02:55,867 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:02:55,881 - payroll_api - DEBUG - Login attempt: username=user, password=***
2025-03-19 18:02:55,883 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:02:55,883 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:02:56,223 - payroll_api - DEBUG - Authentication result: True
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:04:09,096 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:04:09,096 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 18:04:09,096 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:04:09,096 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:04:09,362 - payroll_api - DEBUG - Authentication result: False
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:33]
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_name with data[34:42]
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_data with data[43:51]
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:04:36,037 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:04:36,037 - payroll_api - DEBUG - Login attempt: username=user, password=***
2025-03-19 18:04:36,037 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:04:36,037 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:04:36,265 - payroll_api - DEBUG - Authentication result: True
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_name with data[53:58]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_data with data[59:64]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_name with data[65:74]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_data with data[75:81]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_name with data[82:95]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_data with data[96:102]
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:05:08,644 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:05:08,644 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 18:05:08,644 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:05:08,644 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:05:08,925 - payroll_api - DEBUG - Authentication result: False
2025-03-19 18:13:59,167 - payroll_api - INFO - API shutting down
2025-03-19 18:13:59,167 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 18:13:59,169 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 18:13:59,185 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 18:14:06,265 - payroll_api - INFO - Service modules imported successfully
2025-03-19 18:14:06,288 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 18:14:06,334 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 18:14:06,334 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 18:14:06,334 - payroll_api - INFO - FileService initialized successfully
2025-03-19 18:14:06,335 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 18:14:06,335 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 18:14:06,335 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 18:14:06,336 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 18:14:06,336 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 18:14:06,340 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 18:14:06,340 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 18:14:08,650 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 18:14:08,655 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 18:14:08,655 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 18:14:08,655 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 18:14:08,656 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 18:14:17,372 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 18:14:17,373 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 18:14:17,378 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 18:14:17,591 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 18:14:17,761 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 18:14:17,955 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 18:14:18,120 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 18:14:18,290 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 18:14:18,455 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 18:14:18,625 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 18:14:19,250 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 18:14:19,468 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 18:14:19,646 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 18:14:19,649 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 18:14:19,676 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 18:14:19,677 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 18:14:19,677 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 18:14:19,679 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 18:14:19,680 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 18:14:19,702 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 18:14:19,702 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 18:14:19,723 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 18:14:19,730 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 18:14:19,731 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 18:14:19,738 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 18:14:19,763 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 18:14:19,923 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 18:14:19,938 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 18:14:19,939 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 18:14:19,940 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 18:14:19,940 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 18:14:19,941 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 18:14:19,941 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 18:14:19,942 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 18:14:19,942 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 18:14:19,942 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 18:14:19,943 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 18:14:20,191 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:14:20,191 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:14:20,192 - payroll_api - INFO - Admin password from env: password
2025-03-19 18:14:20,192 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 18:14:20,192 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 18:14:20,194 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 18:14:20,194 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 18:14:20,194 - payroll_api - INFO - Initializing authentication
2025-03-19 18:14:20,195 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 18:14:20,195 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 18:15:22,739 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:15:22,739 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:15:22,740 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:15:22,740 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:15:22,740 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:15:22,740 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:15:22,740 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 18:15:22,740 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:15:22,741 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:15:22,741 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 18:15:22,741 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 18:15:22,741 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:15:22,741 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:15:22,743 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 18:15:22,744 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:15:22,744 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:15:22,744 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-19 18:15:22,745 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-19 18:15:23,025 - payroll_api - DEBUG - Authentication result: False
2025-03-19 18:16:47,084 - payroll_api - INFO - API shutting down
2025-03-19 18:16:47,085 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 18:16:47,086 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 18:16:47,093 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 18:16:53,895 - payroll_api - INFO - Service modules imported successfully
2025-03-19 18:16:53,925 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 18:16:53,971 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 18:16:53,973 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 18:16:53,973 - payroll_api - INFO - FileService initialized successfully
2025-03-19 18:16:53,973 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 18:16:53,973 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 18:16:53,973 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 18:16:53,976 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 18:16:53,976 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 18:16:53,981 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 18:16:53,981 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 18:16:56,616 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 18:16:56,618 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 18:16:56,618 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 18:16:56,618 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 18:16:56,618 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 18:17:06,283 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 18:17:06,283 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 18:17:06,288 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 18:17:06,850 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 18:17:07,027 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 18:17:07,194 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 18:17:07,368 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 18:17:07,529 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 18:17:07,694 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 18:17:07,924 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 18:17:09,097 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 18:17:09,712 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 18:17:09,884 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 18:17:09,884 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 18:17:09,931 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 18:17:09,931 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 18:17:09,931 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 18:17:09,939 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 18:17:09,939 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 18:17:09,970 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 18:17:09,971 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 18:17:09,995 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 18:17:10,010 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 18:17:10,010 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 18:17:10,022 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 18:17:10,053 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 18:17:10,200 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 18:17:10,233 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 18:17:10,236 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 18:17:10,236 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 18:17:10,236 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 18:17:10,236 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 18:17:10,240 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 18:17:10,240 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 18:17:10,240 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 18:17:10,240 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 18:17:10,240 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 18:17:10,484 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:17:10,484 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:17:10,500 - payroll_api - INFO - Admin password from env: password
2025-03-19 18:17:10,500 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 18:17:10,500 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 18:17:10,500 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 18:17:10,500 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 18:17:10,500 - payroll_api - INFO - Initializing authentication
2025-03-19 18:17:10,500 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 18:17:10,500 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 18:17:25,090 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:17:25,091 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:17:25,091 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:17:25,091 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:17:25,091 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:17:25,092 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:17:25,092 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 18:17:25,092 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:17:25,092 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:17:25,093 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 18:17:25,093 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 18:17:25,093 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:17:25,093 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:17:25,096 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 18:17:25,096 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:17:25,097 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:17:25,097 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-19 18:17:25,098 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-19 18:17:25,381 - payroll_api - DEBUG - Authentication result: False
2025-03-19 18:20:57,698 - payroll_api - INFO - API shutting down
2025-03-19 18:20:57,698 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 18:20:57,698 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 18:20:57,733 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 18:21:09,406 - payroll_api - INFO - Service modules imported successfully
2025-03-19 18:21:09,427 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 18:21:09,471 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 18:21:09,472 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 18:21:09,472 - payroll_api - INFO - FileService initialized successfully
2025-03-19 18:21:09,473 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 18:21:09,473 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 18:21:09,473 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 18:21:09,474 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 18:21:09,475 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 18:21:09,479 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 18:21:09,479 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 18:21:11,720 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 18:21:11,722 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 18:21:11,722 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 18:21:11,722 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 18:21:11,722 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 18:21:19,818 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 18:21:19,818 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 18:21:19,826 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 18:21:20,101 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 18:21:20,486 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 18:21:20,953 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 18:21:21,119 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 18:21:21,303 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 18:21:21,469 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 18:21:21,636 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 18:21:22,200 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 18:21:22,453 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 18:21:22,637 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 18:21:22,637 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 18:21:22,668 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 18:21:22,669 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 18:21:22,669 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 18:21:22,670 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 18:21:22,670 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 18:21:22,690 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 18:21:22,691 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 18:21:22,714 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 18:21:22,725 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 18:21:22,726 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 18:21:22,734 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 18:21:22,757 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 18:21:22,901 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 18:21:22,934 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 18:21:22,936 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 18:21:22,937 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 18:21:22,937 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 18:21:22,937 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 18:21:22,938 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 18:21:22,939 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 18:21:22,939 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 18:21:22,939 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 18:21:22,940 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 18:21:23,157 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:21:23,164 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:21:23,164 - payroll_api - INFO - Admin password from env: password
2025-03-19 18:21:23,166 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 18:21:23,166 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 18:21:23,167 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 18:21:23,167 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 18:21:23,167 - payroll_api - INFO - Initializing authentication
2025-03-19 18:21:23,167 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 18:21:23,169 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 18:24:06,945 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:24:06,946 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:24:06,946 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:24:06,946 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:24:06,947 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:24:06,947 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:24:06,947 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 18:24:06,947 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:24:06,948 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:24:06,948 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 18:24:06,948 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 18:24:06,948 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:24:06,948 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:24:06,951 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 18:24:06,951 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:24:06,951 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:24:07,238 - payroll_api - DEBUG - Authentication result: True
2025-03-19 18:24:31,941 - payroll_api - INFO - Admin requested all sessions: admin
2025-03-19 18:24:36,641 - payroll_api - INFO - Admin requested all sessions: admin
2025-03-19 18:25:02,776 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:02,776 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:25:02,777 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:25:02,777 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:02,777 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:02,777 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:25:02,778 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 18:25:02,778 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:02,778 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:02,779 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 18:25:02,779 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 18:25:02,779 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:02,780 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:02,780 - python_multipart.multipart - DEBUG - Calling on_field_name with data[53:58]
2025-03-19 18:25:02,780 - python_multipart.multipart - DEBUG - Calling on_field_data with data[59:64]
2025-03-19 18:25:02,781 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:02,781 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:02,781 - python_multipart.multipart - DEBUG - Calling on_field_name with data[65:74]
2025-03-19 18:25:02,782 - python_multipart.multipart - DEBUG - Calling on_field_data with data[75:81]
2025-03-19 18:25:02,782 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:02,782 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:02,782 - python_multipart.multipart - DEBUG - Calling on_field_name with data[82:95]
2025-03-19 18:25:02,784 - python_multipart.multipart - DEBUG - Calling on_field_data with data[96:102]
2025-03-19 18:25:02,784 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:02,785 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:25:02,788 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 18:25:02,788 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:25:02,789 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:25:03,122 - payroll_api - DEBUG - Authentication result: True
2025-03-19 18:25:04,457 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:04,457 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 18:25:04,458 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 18:25:04,458 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:04,458 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:04,458 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 18:25:04,460 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 18:25:04,460 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:04,460 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:04,460 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 18:25:04,460 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 18:25:04,461 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:04,461 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:04,461 - python_multipart.multipart - DEBUG - Calling on_field_name with data[53:58]
2025-03-19 18:25:04,462 - python_multipart.multipart - DEBUG - Calling on_field_data with data[59:64]
2025-03-19 18:25:04,462 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:04,462 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:04,463 - python_multipart.multipart - DEBUG - Calling on_field_name with data[65:74]
2025-03-19 18:25:04,463 - python_multipart.multipart - DEBUG - Calling on_field_data with data[75:81]
2025-03-19 18:25:04,464 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:04,464 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 18:25:04,465 - python_multipart.multipart - DEBUG - Calling on_field_name with data[82:95]
2025-03-19 18:25:04,465 - python_multipart.multipart - DEBUG - Calling on_field_data with data[96:102]
2025-03-19 18:25:04,466 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 18:25:04,466 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 18:25:04,479 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 18:25:04,479 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 18:25:04,479 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 18:25:04,787 - payroll_api - DEBUG - Authentication result: True
2025-03-19 21:57:48,909 - payroll_api - INFO - Service modules imported successfully
2025-03-19 21:57:48,932 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 21:57:48,984 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 21:57:48,985 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 21:57:48,986 - payroll_api - INFO - FileService initialized successfully
2025-03-19 21:57:48,986 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 21:57:48,986 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 21:57:48,988 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 21:57:48,989 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 21:57:48,989 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 21:57:48,994 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 21:57:48,994 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 21:57:51,274 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 21:57:51,278 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 21:57:51,278 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 21:57:51,279 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 21:57:51,279 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 21:58:00,784 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 21:58:00,784 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 21:58:00,789 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 21:58:01,089 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 21:58:01,293 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 21:58:01,501 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 21:58:01,810 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 21:58:02,420 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 21:58:02,630 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 21:58:02,843 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 21:58:03,549 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 21:58:03,854 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 21:58:04,366 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 21:58:04,376 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 21:58:04,442 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 21:58:04,443 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 21:58:04,443 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 21:58:04,447 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 21:58:04,448 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 21:58:04,481 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 21:58:04,482 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 21:58:04,513 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 21:58:04,526 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 21:58:04,527 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 21:58:04,537 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 21:58:04,567 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 21:58:04,784 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 21:58:04,786 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 21:58:04,788 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 21:58:04,789 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 21:58:04,789 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 21:58:04,791 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 21:58:04,791 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 21:58:04,793 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 21:58:04,793 - application.services.session_service - INFO - Loaded 0 sessions from disk
2025-03-19 21:58:04,794 - application.services.session_service - INFO - SessionService initialized with 0 sessions
2025-03-19 21:58:04,794 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 21:58:05,092 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 21:58:05,093 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 21:58:05,094 - payroll_api - INFO - Admin password from env: password
2025-03-19 21:58:05,094 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 21:58:05,094 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 21:58:05,096 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 21:58:05,096 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 21:58:05,097 - payroll_api - INFO - Initializing authentication
2025-03-19 21:58:05,097 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 21:58:05,098 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 21:59:39,508 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 21:59:39,508 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 21:59:39,508 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 21:59:39,509 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 21:59:39,509 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 21:59:39,509 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 21:59:39,510 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 21:59:39,510 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 21:59:39,510 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 21:59:39,510 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 21:59:39,511 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 21:59:39,511 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 21:59:39,511 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 21:59:39,514 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 21:59:39,514 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 21:59:39,514 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 21:59:39,515 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-19 21:59:39,516 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-19 21:59:39,905 - payroll_api - DEBUG - Authentication result: True
2025-03-19 21:59:47,835 - application.services.session_service - INFO - Created new session: e8b29861-e8fc-4f55-a8e0-5201d6e819ed
2025-03-19 21:59:47,836 - payroll_api - INFO - Created new session: e8b29861-e8fc-4f55-a8e0-5201d6e819ed
2025-03-19 21:59:47,838 - payroll_api - INFO - Files list requested by user admin for session e8b29861-e8fc-4f55-a8e0-5201d6e819ed
2025-03-19 21:59:47,839 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-19 21:59:57,079 - application.services.session_service - INFO - Created new session: 2278e4d1-8ad6-461a-9f4c-c1c83c48bfef
2025-03-19 21:59:57,080 - payroll_api - INFO - Created new session: 2278e4d1-8ad6-461a-9f4c-c1c83c48bfef
2025-03-19 21:59:57,082 - payroll_api - INFO - Files list requested by user admin for session 2278e4d1-8ad6-461a-9f4c-c1c83c48bfef
2025-03-19 21:59:57,083 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-19 22:01:04,668 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:01:04,668 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-19 22:01:04,670 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-19 22:01:04,670 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:01:04,671 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-19 22:01:04,671 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-19 22:01:04,671 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:01:04,673 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:01:04,673 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:32768]
2025-03-19 22:01:04,677 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:16384]
2025-03-19 22:01:04,680 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:153389]
2025-03-19 22:01:04,681 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:01:04,682 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:01:04,682 - python_multipart.multipart - DEBUG - Calling on_header_field with data[153433:153452]
2025-03-19 22:01:04,683 - python_multipart.multipart - DEBUG - Calling on_header_value with data[153454:153481]
2025-03-19 22:01:04,684 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:01:04,684 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:01:04,685 - python_multipart.multipart - DEBUG - Calling on_part_data with data[153485:153488]
2025-03-19 22:01:04,685 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:01:04,686 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:01:04,687 - python_multipart.multipart - DEBUG - Calling on_header_field with data[153532:153551]
2025-03-19 22:01:04,688 - python_multipart.multipart - DEBUG - Calling on_header_value with data[153553:153580]
2025-03-19 22:01:04,688 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:01:04,689 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:01:04,690 - python_multipart.multipart - DEBUG - Calling on_part_data with data[153584:153590]
2025-03-19 22:01:04,690 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:01:04,691 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 22:01:04,695 - application.services.session_service - INFO - Created new session: 0d55bcd8-5765-47c2-8b2c-4835c490e9b7
2025-03-19 22:01:04,696 - payroll_api - INFO - Created new session: 0d55bcd8-5765-47c2-8b2c-4835c490e9b7
2025-03-19 22:01:04,698 - payroll_api - INFO - File upload request from user admin, session 0d55bcd8-5765-47c2-8b2c-4835c490e9b7: sikyu_csv_sample.csv
2025-03-19 22:01:04,873 - application.services.file_service - INFO - Created secure copy of C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35ce7170-c469-43b0-8456-32951059a45e.csv at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\92e989fc-109a-4da2-b012-a8a6cfdc7fc2.csv
2025-03-19 22:01:04,875 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\92e989fc-109a-4da2-b012-a8a6cfdc7fc2.csv
2025-03-19 22:01:04,876 - application.modules.file_agent - ERROR - check_file_identity中にエラーが発生
Traceback (most recent call last):
  File "C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\modules\file_agent.py", line 253, in check_file_identity
    for task_dict in self.task_configs.values():
                     ^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'values'
2025-03-19 22:01:04,911 - application.services.file_service - INFO - Successfully processed file: 35ce7170-c469-43b0-8456-32951059a45e.csv
2025-03-19 22:01:04,912 - application.services.payroll_service - INFO - Processing message: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35ce7170-c469-43b0-8456-32951059a45e.csv
2025-03-19 22:01:04,913 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-19 22:01:04,914 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈


# 現在のユーザー入力
User: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35ce7170-c469-43b0-8456-32951059a45e.csv

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-19 22:01:04,940 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\n\n\n# 現在のユーザー入力\nUser: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\35ce7170-c469-43b0-8456-32951059a45e.csv\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-19 22:01:04,978 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-19 22:01:04,980 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-19 22:01:05,315 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000028EF66A97D0>
2025-03-19 22:01:05,317 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000028EF82B8A70> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-19 22:01:05,751 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000028EF8169190>
2025-03-19 22:01:05,753 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-19 22:01:05,755 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-19 22:01:05,756 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-19 22:01:05,758 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-19 22:01:05,759 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-19 22:01:06,443 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1258'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'6147e86d-88d4-4b44-b113-3a1c9101f13d'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'999'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'96835'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'392'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-02'), (b'x-envoy-upstream-service-time', b'440'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'7f3b389d-65e7-466f-9bac-8a2262077799'), (b'ms-azureml-model-time', b'438'), (b'x-ms-client-request-id', b'6147e86d-88d4-4b44-b113-3a1c9101f13d'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 13:01:05 GMT')])
2025-03-19 22:01:06,447 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-19 22:01:06,448 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-19 22:01:06,448 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-19 22:01:06,449 - httpcore.http11 - DEBUG - response_closed.started
2025-03-19 22:01:06,450 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-19 22:01:06,450 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1258', 'content-type': 'application/json', 'apim-request-id': '6147e86d-88d4-4b44-b113-3a1c9101f13d', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '999', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '96835', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '392', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-02', 'x-envoy-upstream-service-time': '440', 'x-ms-rai-invoked': 'true', 'x-request-id': '7f3b389d-65e7-466f-9bac-8a2262077799', 'ms-azureml-model-time': '438', 'x-ms-client-request-id': '6147e86d-88d4-4b44-b113-3a1c9101f13d', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 13:01:05 GMT'})
2025-03-19 22:01:06,453 - openai._base_client - DEBUG - request_id: 7f3b389d-65e7-466f-9bac-8a2262077799
2025-03-19 22:01:06,463 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'file_upload', 'file_type': 'csv'}
2025-03-19 22:01:06,464 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35ce7170-c469-43b0-8456-32951059a45e.csv
2025-03-19 22:01:06,749 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('アップロードされたファイルは以下のファイルの一つと推定する：\n支給控除等一覧(データ更新)-支給・控除等一覧表\n支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表\n支給控除等一覧(後処理)-更新された支給・控除等一覧表\n支給控除等一覧(後処理)-削除リスト\n支給控除等一覧(後処理)-漢字変換リスト\nYonosukeデータ作成(加算処理)-給与明細データ\nYonosukeデータ作成(加算処理)-前月Yonosukeデータ\nYonosukeデータ作成(加算処理)-賞与データ\nYonosukeデータ作成(データ除去)-今月Yonosukeデータ\nYonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト', ''), type: <class 'tuple'>
2025-03-19 22:01:06,751 - application.services.payroll_service - DEBUG - Standardized response: (アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト, )
2025-03-19 22:01:06,763 - payroll_api - INFO - File uploaded successfully: sikyu_csv_sample.csv
2025-03-19 22:01:06,769 - payroll_api - DEBUG - Cleaned up temporary file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35ce7170-c469-43b0-8456-32951059a45e.csv
2025-03-19 22:14:30,353 - payroll_api - INFO - API shutting down
2025-03-19 22:14:30,354 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:14:30,358 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:14:30,376 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:14:41,244 - payroll_api - INFO - Service modules imported successfully
2025-03-19 22:14:41,289 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:14:41,361 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:14:41,362 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 22:14:41,364 - payroll_api - INFO - FileService initialized successfully
2025-03-19 22:14:41,364 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:14:41,365 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 22:14:41,366 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:14:41,369 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:14:41,370 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 22:14:41,377 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:14:41,377 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 22:14:44,818 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:14:44,825 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 22:14:44,826 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 22:14:44,827 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 22:14:44,827 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 22:15:05,109 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 22:15:05,109 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 22:15:05,115 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 22:15:05,440 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:15:05,644 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 22:15:05,848 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 22:15:06,054 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:15:06,258 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 22:15:06,463 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 22:15:06,673 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 22:15:08,619 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 22:15:09,024 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 22:15:09,330 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 22:15:09,339 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 22:15:09,388 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 22:15:09,390 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 22:15:09,390 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 22:15:09,394 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 22:15:09,395 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 22:15:09,434 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 22:15:09,435 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 22:15:09,478 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 22:15:09,491 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 22:15:09,492 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 22:15:09,502 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 22:15:09,530 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 22:15:09,742 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 22:15:09,743 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 22:15:09,751 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 22:15:09,752 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 22:15:09,754 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 22:15:09,757 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 22:15:09,759 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 22:15:09,761 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 22:15:09,869 - application.services.session_service - INFO - Loaded 3 sessions from disk
2025-03-19 22:15:09,870 - application.services.session_service - INFO - SessionService initialized with 3 sessions
2025-03-19 22:15:09,871 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 22:15:10,057 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 22:15:10,059 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 22:15:10,060 - payroll_api - INFO - Admin password from env: password
2025-03-19 22:15:10,061 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 22:15:10,062 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 22:15:10,066 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:15:10,067 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 22:15:10,067 - payroll_api - INFO - Initializing authentication
2025-03-19 22:15:10,068 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 22:15:10,069 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 22:15:36,765 - payroll_api - INFO - API shutting down
2025-03-19 22:15:36,768 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:15:36,773 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:15:36,813 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:15:47,599 - payroll_api - INFO - Service modules imported successfully
2025-03-19 22:15:47,639 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:15:47,721 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:15:47,723 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 22:15:47,724 - payroll_api - INFO - FileService initialized successfully
2025-03-19 22:15:47,725 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:15:47,725 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 22:15:47,726 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:15:47,728 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:15:47,729 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 22:15:47,737 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:15:47,738 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 22:15:53,561 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:15:53,570 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 22:15:53,571 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 22:15:53,572 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 22:15:53,574 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 22:16:13,385 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 22:16:13,386 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 22:16:13,397 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 22:16:13,637 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:16:13,852 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 22:16:14,049 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 22:16:14,229 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:16:14,408 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 22:16:14,598 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 22:16:14,786 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 22:16:16,303 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 22:16:16,715 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 22:16:17,024 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 22:16:17,037 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 22:16:17,149 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 22:16:17,150 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 22:16:17,152 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 22:16:17,159 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 22:16:17,160 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 22:16:17,197 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 22:16:17,198 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 22:16:17,226 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 22:16:17,237 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 22:16:17,238 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 22:16:17,247 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 22:16:17,271 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 22:16:17,532 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 22:16:17,533 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 22:16:17,537 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 22:16:17,538 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 22:16:17,538 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 22:16:17,539 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 22:16:17,540 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 22:16:17,541 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 22:16:17,543 - application.services.session_service - INFO - Loaded 3 sessions from disk
2025-03-19 22:16:17,544 - application.services.session_service - INFO - SessionService initialized with 3 sessions
2025-03-19 22:16:17,544 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 22:16:17,636 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 22:16:17,637 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 22:16:17,637 - payroll_api - INFO - Admin password from env: password
2025-03-19 22:16:17,639 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 22:16:17,639 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 22:16:17,641 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:16:17,641 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 22:16:17,641 - payroll_api - INFO - Initializing authentication
2025-03-19 22:16:17,642 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 22:16:17,642 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 22:16:38,505 - payroll_api - INFO - API shutting down
2025-03-19 22:16:38,509 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:16:38,517 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:16:38,556 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:16:51,187 - payroll_api - INFO - Service modules imported successfully
2025-03-19 22:16:51,233 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:16:51,316 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:16:51,319 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 22:16:51,320 - payroll_api - INFO - FileService initialized successfully
2025-03-19 22:16:51,320 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:16:51,321 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 22:16:51,322 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:16:51,325 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:16:51,327 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 22:16:51,334 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:16:51,335 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 22:16:57,543 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:16:57,550 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 22:16:57,551 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 22:16:57,552 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 22:16:57,552 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 22:17:15,171 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 22:17:15,172 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 22:17:15,176 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 22:17:15,493 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:17:15,799 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 22:17:16,004 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 22:17:16,518 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:17:16,726 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 22:17:16,926 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 22:17:17,131 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 22:17:17,835 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 22:17:18,155 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 22:17:18,593 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 22:17:18,596 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 22:17:18,623 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 22:17:18,623 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 22:17:18,624 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 22:17:18,627 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 22:17:18,627 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 22:17:18,652 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 22:17:18,652 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 22:17:18,678 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 22:17:18,688 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 22:17:18,689 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 22:17:18,696 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 22:17:18,721 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 22:17:18,947 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 22:17:18,948 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 22:17:18,955 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 22:17:18,955 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 22:17:18,956 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 22:17:18,959 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 22:17:18,959 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 22:17:18,962 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 22:17:18,965 - application.services.session_service - INFO - Loaded 3 sessions from disk
2025-03-19 22:17:18,966 - application.services.session_service - INFO - SessionService initialized with 3 sessions
2025-03-19 22:17:18,966 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 22:17:19,115 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 22:17:19,117 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 22:17:19,119 - payroll_api - INFO - Admin password from env: password
2025-03-19 22:17:19,120 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 22:17:19,120 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 22:17:19,123 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:17:19,124 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 22:17:19,125 - payroll_api - INFO - Initializing authentication
2025-03-19 22:17:19,125 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 22:17:19,127 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 22:18:12,880 - payroll_api - INFO - API shutting down
2025-03-19 22:18:12,883 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:18:12,891 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:18:12,933 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:18:25,529 - payroll_api - INFO - Service modules imported successfully
2025-03-19 22:18:25,573 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:18:25,718 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:18:25,720 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 22:18:25,721 - payroll_api - INFO - FileService initialized successfully
2025-03-19 22:18:25,721 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:18:25,722 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 22:18:25,723 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:18:25,725 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:18:25,727 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 22:18:25,734 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:18:25,735 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 22:18:31,700 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:18:31,707 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 22:18:31,708 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 22:18:31,708 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 22:18:31,709 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 22:18:51,298 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 22:18:51,298 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 22:18:51,309 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 22:18:51,653 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:18:52,060 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 22:18:52,266 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 22:18:52,447 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:18:52,675 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 22:18:52,864 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 22:18:53,042 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 22:18:54,313 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 22:18:54,724 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 22:18:55,030 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 22:18:55,037 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 22:18:55,099 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 22:18:55,099 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 22:18:55,100 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 22:18:55,105 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 22:18:55,106 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 22:18:55,159 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 22:18:55,160 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 22:18:55,214 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 22:18:55,230 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 22:18:55,231 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 22:18:55,248 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 22:18:55,288 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 22:18:55,543 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 22:18:55,544 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 22:18:55,548 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 22:18:55,549 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 22:18:55,550 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 22:18:55,551 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 22:18:55,552 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 22:18:55,554 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 22:18:55,557 - application.services.session_service - INFO - Loaded 3 sessions from disk
2025-03-19 22:18:55,558 - application.services.session_service - INFO - SessionService initialized with 3 sessions
2025-03-19 22:18:55,558 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 22:18:55,678 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 22:18:55,679 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 22:18:55,679 - payroll_api - INFO - Admin password from env: password
2025-03-19 22:18:55,680 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 22:18:55,681 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 22:18:55,682 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:18:55,683 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 22:18:55,683 - payroll_api - INFO - Initializing authentication
2025-03-19 22:18:55,684 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 22:18:55,684 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 22:23:38,644 - payroll_api - INFO - API shutting down
2025-03-19 22:23:38,646 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:23:38,652 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:23:38,691 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:23:51,503 - payroll_api - INFO - Service modules imported successfully
2025-03-19 22:23:51,547 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:23:51,623 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:23:51,625 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 22:23:51,626 - payroll_api - INFO - FileService initialized successfully
2025-03-19 22:23:51,626 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:23:51,627 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 22:23:51,628 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:23:51,630 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:23:51,631 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 22:23:51,639 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:23:51,640 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 22:23:57,871 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:23:57,880 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 22:23:57,880 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 22:23:57,881 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 22:23:57,881 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 22:24:16,064 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 22:24:16,065 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 22:24:16,072 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 22:24:16,377 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:24:16,581 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 22:24:16,787 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 22:24:16,991 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:24:17,400 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 22:24:17,605 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 22:24:17,811 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 22:24:18,744 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 22:24:19,040 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 22:24:19,244 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 22:24:19,250 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 22:24:19,278 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 22:24:19,278 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 22:24:19,279 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 22:24:19,281 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 22:24:19,282 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 22:24:19,307 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 22:24:19,308 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 22:24:19,334 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 22:24:19,346 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 22:24:19,347 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 22:24:19,355 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 22:24:19,378 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 22:24:19,552 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 22:24:19,578 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 22:24:19,581 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 22:24:19,581 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 22:24:19,582 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 22:24:19,583 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 22:24:19,583 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 22:24:19,584 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 22:24:19,587 - application.services.session_service - INFO - Loaded 3 sessions from disk
2025-03-19 22:24:19,587 - application.services.session_service - INFO - SessionService initialized with 3 sessions
2025-03-19 22:24:19,588 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 22:24:19,679 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 22:24:19,680 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 22:24:19,681 - payroll_api - INFO - Admin password from env: password
2025-03-19 22:24:19,682 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 22:24:19,684 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 22:24:19,686 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:24:19,687 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 22:24:19,688 - payroll_api - INFO - Initializing authentication
2025-03-19 22:24:19,690 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 22:24:19,691 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 22:26:10,082 - payroll_api - INFO - API shutting down
2025-03-19 22:26:10,085 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:26:10,089 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:26:10,124 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:26:18,131 - payroll_api - INFO - Service modules imported successfully
2025-03-19 22:26:18,154 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:26:18,201 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:26:18,202 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 22:26:18,202 - payroll_api - INFO - FileService initialized successfully
2025-03-19 22:26:18,203 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:26:18,203 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 22:26:18,204 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 22:26:18,205 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:26:18,205 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 22:26:18,210 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 22:26:18,212 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 22:26:23,688 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 22:26:23,696 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 22:26:23,697 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 22:26:23,698 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 22:26:23,698 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 22:26:43,753 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 22:26:43,754 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 22:26:43,764 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 22:26:44,047 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:26:44,562 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 22:26:44,763 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 22:26:44,968 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 22:26:45,173 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 22:26:45,378 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 22:26:45,582 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 22:26:46,914 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 22:26:47,324 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 22:26:47,529 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 22:26:47,540 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 22:26:47,653 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 22:26:47,654 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 22:26:47,655 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 22:26:47,663 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 22:26:47,665 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 22:26:47,741 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 22:26:47,742 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 22:26:47,800 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 22:26:47,820 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 22:26:47,822 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 22:26:47,839 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 22:26:47,886 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 22:26:48,145 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 22:26:48,146 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 22:26:48,157 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 22:26:48,159 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 22:26:48,160 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 22:26:48,162 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 22:26:48,163 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 22:26:48,166 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 22:26:48,172 - application.services.session_service - INFO - Loaded 3 sessions from disk
2025-03-19 22:26:48,173 - application.services.session_service - INFO - SessionService initialized with 3 sessions
2025-03-19 22:26:48,174 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 22:26:48,382 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 22:26:48,384 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 22:26:48,386 - payroll_api - INFO - Admin password from env: password
2025-03-19 22:26:48,387 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 22:26:48,388 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 22:26:48,391 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 22:26:48,392 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 22:26:48,393 - payroll_api - INFO - Initializing authentication
2025-03-19 22:26:48,394 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 22:26:48,395 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 22:27:37,306 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:27:37,306 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-19 22:27:37,307 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-19 22:27:37,307 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:27:37,307 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-19 22:27:37,308 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-19 22:27:37,308 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:27:37,309 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:27:37,309 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:98304]
2025-03-19 22:27:37,311 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:104237]
2025-03-19 22:27:37,311 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:27:37,312 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:27:37,312 - python_multipart.multipart - DEBUG - Calling on_header_field with data[104281:104300]
2025-03-19 22:27:37,312 - python_multipart.multipart - DEBUG - Calling on_header_value with data[104302:104329]
2025-03-19 22:27:37,313 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:27:37,313 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:27:37,313 - python_multipart.multipart - DEBUG - Calling on_part_data with data[104333:104339]
2025-03-19 22:27:37,314 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:27:37,314 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:27:37,315 - python_multipart.multipart - DEBUG - Calling on_header_field with data[104383:104402]
2025-03-19 22:27:37,315 - python_multipart.multipart - DEBUG - Calling on_header_value with data[104404:104431]
2025-03-19 22:27:37,315 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:27:37,316 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:27:37,316 - python_multipart.multipart - DEBUG - Calling on_part_data with data[104435:104441]
2025-03-19 22:27:37,317 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:27:37,317 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 22:27:39,404 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:27:39,405 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-19 22:27:39,405 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-19 22:27:39,406 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:27:39,406 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-19 22:27:39,406 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-19 22:27:39,407 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:27:39,407 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:27:39,408 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:98304]
2025-03-19 22:27:39,409 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:104237]
2025-03-19 22:27:39,410 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:27:39,410 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:27:39,410 - python_multipart.multipart - DEBUG - Calling on_header_field with data[104281:104300]
2025-03-19 22:27:39,411 - python_multipart.multipart - DEBUG - Calling on_header_value with data[104302:104329]
2025-03-19 22:27:39,411 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:27:39,411 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:27:39,412 - python_multipart.multipart - DEBUG - Calling on_part_data with data[104333:104339]
2025-03-19 22:27:39,412 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:27:39,412 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:27:39,414 - python_multipart.multipart - DEBUG - Calling on_header_field with data[104383:104402]
2025-03-19 22:27:39,414 - python_multipart.multipart - DEBUG - Calling on_header_value with data[104404:104431]
2025-03-19 22:27:39,415 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:27:39,415 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:27:39,415 - python_multipart.multipart - DEBUG - Calling on_part_data with data[104435:104441]
2025-03-19 22:27:39,416 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:27:39,416 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 22:27:55,210 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 22:27:55,210 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 22:27:55,210 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 22:27:55,212 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 22:27:55,212 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 22:27:55,212 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 22:27:55,212 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 22:27:55,213 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 22:27:55,213 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 22:27:55,214 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 22:27:55,214 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 22:27:55,214 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 22:27:55,215 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 22:27:55,219 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 22:27:55,220 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 22:27:55,220 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 22:27:55,222 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-19 22:27:55,223 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-19 22:27:55,578 - payroll_api - DEBUG - Authentication result: True
2025-03-19 22:28:05,974 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:28:05,975 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-19 22:28:05,975 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-19 22:28:05,976 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:28:05,977 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-19 22:28:05,979 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-19 22:28:05,980 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:28:05,980 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:28:05,981 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:81920]
2025-03-19 22:28:05,984 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:81920]
2025-03-19 22:28:05,986 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:38701]
2025-03-19 22:28:05,987 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:28:05,987 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:28:05,988 - python_multipart.multipart - DEBUG - Calling on_header_field with data[38745:38764]
2025-03-19 22:28:05,988 - python_multipart.multipart - DEBUG - Calling on_header_value with data[38766:38793]
2025-03-19 22:28:05,989 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:28:05,990 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:28:05,990 - python_multipart.multipart - DEBUG - Calling on_part_data with data[38797:38803]
2025-03-19 22:28:05,991 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:28:05,992 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 22:28:05,992 - python_multipart.multipart - DEBUG - Calling on_header_field with data[38847:38866]
2025-03-19 22:28:05,993 - python_multipart.multipart - DEBUG - Calling on_header_value with data[38868:38895]
2025-03-19 22:28:05,994 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 22:28:05,994 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 22:28:05,995 - python_multipart.multipart - DEBUG - Calling on_part_data with data[38899:38905]
2025-03-19 22:28:05,996 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 22:28:05,997 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 22:28:05,999 - application.services.session_service - INFO - Created new session: 10c9a701-dcda-4cd9-8794-b0d35740f2e6
2025-03-19 22:28:06,000 - payroll_api - INFO - Created new session: 10c9a701-dcda-4cd9-8794-b0d35740f2e6
2025-03-19 22:28:06,002 - payroll_api - INFO - File upload request from user admin, session 10c9a701-dcda-4cd9-8794-b0d35740f2e6: sikyu_csv_sample.csv
2025-03-19 22:28:06,004 - payroll_api - DEBUG - File saved to: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\1106d9d8-e045-4c57-8447-7c71df480668.csv
2025-03-19 22:28:06,005 - application.services.file_service - INFO - Starting to upload file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\1106d9d8-e045-4c57-8447-7c71df480668.csv
2025-03-19 22:28:06,113 - application.services.file_service - DEBUG - File validation result: valid=True, message=File validation successful
2025-03-19 22:28:06,113 - application.services.file_service - DEBUG - Creating secure copy of file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\1106d9d8-e045-4c57-8447-7c71df480668.csv
2025-03-19 22:28:06,139 - application.services.file_service - INFO - Created secure copy of C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\1106d9d8-e045-4c57-8447-7c71df480668.csv at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\5a9dca53-7254-4135-8112-51d17c1ac86d.csv
2025-03-19 22:28:06,140 - application.services.file_service - DEBUG - Checking file identity: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\5a9dca53-7254-4135-8112-51d17c1ac86d.csv
2025-03-19 22:28:06,140 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\5a9dca53-7254-4135-8112-51d17c1ac86d.csv
2025-03-19 22:28:06,141 - application.modules.file_agent - ERROR - check_file_identity中にエラーが発生
Traceback (most recent call last):
  File "C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\modules\file_agent.py", line 253, in check_file_identity
    for task_dict in self.task_configs.values():
                     ^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'values'
2025-03-19 22:28:06,143 - application.services.file_service - INFO - File identity result: 'NoneType' object has no attribute 'values'
2025-03-19 22:28:06,144 - application.services.file_service - INFO - Successfully processed file: 1106d9d8-e045-4c57-8447-7c71df480668.csv
2025-03-19 22:28:06,144 - payroll_api - DEBUG - File processed by file_service: {'success': True, 'file_path': 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\5a9dca53-7254-4135-8112-51d17c1ac86d.csv', 'file_name': '1106d9d8-e045-4c57-8447-7c71df480668.csv', 'identity_result': "'NoneType' object has no attribute 'values'", 'original_path': 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\1106d9d8-e045-4c57-8447-7c71df480668.csv'}
2025-03-19 22:28:06,145 - application.services.payroll_service - INFO - Processing message: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\1106d9d8-e045-4c57-8447-7c71df480668.csv
2025-03-19 22:28:06,146 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-19 22:28:06,147 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈


# 現在のユーザー入力
User: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\1106d9d8-e045-4c57-8447-7c71df480668.csv

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-19 22:28:06,157 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\n\n\n# 現在のユーザー入力\nUser: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\1106d9d8-e045-4c57-8447-7c71df480668.csv\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-19 22:28:06,178 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-19 22:28:06,180 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-19 22:28:06,483 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001F373281390>
2025-03-19 22:28:06,484 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001F3734349E0> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-19 22:28:06,907 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001F371AFB010>
2025-03-19 22:28:06,909 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-19 22:28:06,911 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-19 22:28:06,913 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-19 22:28:06,915 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-19 22:28:06,915 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-19 22:28:07,611 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1258'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'15ce41d5-f63d-4cc4-be58-2490aca8496b'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'999'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'96835'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'410'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'463'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'fa995591-cf2d-4627-b688-f701b736283e'), (b'ms-azureml-model-time', b'460'), (b'x-ms-client-request-id', b'15ce41d5-f63d-4cc4-be58-2490aca8496b'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 13:28:07 GMT')])
2025-03-19 22:28:07,617 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-19 22:28:07,619 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-19 22:28:07,620 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-19 22:28:07,621 - httpcore.http11 - DEBUG - response_closed.started
2025-03-19 22:28:07,622 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-19 22:28:07,623 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1258', 'content-type': 'application/json', 'apim-request-id': '15ce41d5-f63d-4cc4-be58-2490aca8496b', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '999', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '96835', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '410', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '463', 'x-ms-rai-invoked': 'true', 'x-request-id': 'fa995591-cf2d-4627-b688-f701b736283e', 'ms-azureml-model-time': '460', 'x-ms-client-request-id': '15ce41d5-f63d-4cc4-be58-2490aca8496b', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 13:28:07 GMT'})
2025-03-19 22:28:07,628 - openai._base_client - DEBUG - request_id: fa995591-cf2d-4627-b688-f701b736283e
2025-03-19 22:28:07,645 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'file_upload', 'file_type': 'csv'}
2025-03-19 22:28:07,648 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\1106d9d8-e045-4c57-8447-7c71df480668.csv
2025-03-19 22:28:07,989 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 22:28:08,470 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('アップロードされたファイルは以下のファイルの一つと推定する：\n支給控除等一覧(データ更新)-支給・控除等一覧表\n支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表\n支給控除等一覧(後処理)-更新された支給・控除等一覧表\n支給控除等一覧(後処理)-削除リスト\n支給控除等一覧(後処理)-漢字変換リスト\nYonosukeデータ作成(加算処理)-給与明細データ\nYonosukeデータ作成(加算処理)-前月Yonosukeデータ\nYonosukeデータ作成(加算処理)-賞与データ\nYonosukeデータ作成(データ除去)-今月Yonosukeデータ\nYonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト', ''), type: <class 'tuple'>
2025-03-19 22:28:08,472 - application.services.payroll_service - DEBUG - Standardized response: (アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト, )
2025-03-19 22:28:08,479 - payroll_api - DEBUG - Payroll service processed message: アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト
2025-03-19 22:28:08,499 - payroll_api - INFO - File uploaded successfully: sikyu_csv_sample.csv
2025-03-19 22:28:08,517 - payroll_api - DEBUG - Cleaned up temporary file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\1106d9d8-e045-4c57-8447-7c71df480668.csv
2025-03-19 22:28:35,529 - application.services.session_service - INFO - Created new session: 20bea39a-5115-4efb-84ac-b5c013ef9258
2025-03-19 22:28:35,529 - payroll_api - INFO - Created new session: 20bea39a-5115-4efb-84ac-b5c013ef9258
2025-03-19 22:28:35,531 - payroll_api - INFO - Files list requested by user admin for session 20bea39a-5115-4efb-84ac-b5c013ef9258
2025-03-19 22:28:35,531 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-19 22:28:35,544 - payroll_api - DEBUG - Raw files from file_service: []
2025-03-19 22:28:35,544 - payroll_api - DEBUG - Adapted files for frontend: []
2025-03-19 22:28:38,562 - application.services.session_service - INFO - Created new session: d511907a-03f9-4ffc-a01c-9537e1b0484c
2025-03-19 22:28:38,563 - payroll_api - INFO - Created new session: d511907a-03f9-4ffc-a01c-9537e1b0484c
2025-03-19 22:28:38,564 - payroll_api - INFO - Files list requested by user admin for session d511907a-03f9-4ffc-a01c-9537e1b0484c
2025-03-19 22:28:38,565 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-19 22:28:38,567 - payroll_api - DEBUG - Raw files from file_service: []
2025-03-19 22:28:38,567 - payroll_api - DEBUG - Adapted files for frontend: []
2025-03-19 23:21:34,671 - payroll_api - INFO - API shutting down
2025-03-19 23:21:34,672 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:21:34,675 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:21:40,608 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:21:40,631 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:21:40,663 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:21:40,663 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-19 23:21:40,663 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-19 23:21:40,664 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 23:21:40,664 - payroll_api - INFO - FileService initialized successfully
2025-03-19 23:21:40,664 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:21:40,664 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 23:21:40,665 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:21:40,666 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:21:40,666 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 23:21:40,670 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:21:40,670 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 23:21:42,865 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:21:42,871 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 23:21:42,871 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 23:21:42,873 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 23:21:42,873 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 23:21:50,743 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 23:21:50,744 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 23:21:50,749 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 23:21:50,942 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:21:51,105 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 23:21:51,285 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 23:21:51,455 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:21:51,622 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 23:21:51,799 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 23:21:51,981 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 23:21:52,635 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 23:21:52,848 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 23:21:53,022 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 23:21:53,025 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 23:21:53,050 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 23:21:53,050 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 23:21:53,050 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 23:21:53,052 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 23:21:53,052 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 23:21:53,075 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 23:21:53,076 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 23:21:53,100 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 23:21:53,109 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 23:21:53,110 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 23:21:53,118 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 23:21:53,143 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 23:21:53,315 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 23:21:53,341 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 23:21:53,343 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 23:21:53,344 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 23:21:53,344 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 23:21:53,345 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 23:21:53,345 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 23:21:53,346 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 23:21:53,374 - application.services.session_service - INFO - Loaded 6 sessions from disk
2025-03-19 23:21:53,374 - application.services.session_service - INFO - SessionService initialized with 6 sessions
2025-03-19 23:21:53,375 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 23:21:53,420 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 23:21:53,420 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 23:21:53,420 - payroll_api - INFO - Admin password from env: password
2025-03-19 23:21:53,420 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 23:21:53,421 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 23:21:53,421 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:21:53,421 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 23:21:53,422 - payroll_api - INFO - Initializing authentication
2025-03-19 23:21:53,422 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 23:21:53,422 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 23:22:41,641 - payroll_api - INFO - API shutting down
2025-03-19 23:22:41,642 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:22:41,645 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:22:41,654 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:22:49,413 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:22:49,434 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:22:49,471 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:22:49,471 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-19 23:22:49,472 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-19 23:22:49,473 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 23:22:49,473 - payroll_api - INFO - FileService initialized successfully
2025-03-19 23:22:49,473 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:22:49,473 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 23:22:49,475 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:22:49,475 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:22:49,476 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 23:22:49,480 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:22:49,480 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 23:22:52,764 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:22:52,772 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 23:22:52,772 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 23:22:52,773 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 23:22:52,773 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 23:23:02,294 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 23:23:02,294 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 23:23:02,300 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 23:23:02,525 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:23:02,695 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 23:23:02,878 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 23:23:03,045 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:23:03,218 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 23:23:03,388 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 23:23:03,557 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 23:23:04,180 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 23:23:04,404 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 23:23:05,179 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 23:23:05,181 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 23:23:05,208 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 23:23:05,208 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 23:23:05,208 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 23:23:05,210 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 23:23:05,212 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 23:23:05,234 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 23:23:05,235 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 23:23:05,263 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 23:23:05,271 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 23:23:05,272 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 23:23:05,280 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 23:23:05,304 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 23:23:05,493 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 23:23:05,510 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 23:23:05,513 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 23:23:05,513 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 23:23:05,513 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 23:23:05,513 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 23:23:05,515 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 23:23:05,515 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 23:23:05,518 - application.services.session_service - INFO - Loaded 6 sessions from disk
2025-03-19 23:23:05,519 - application.services.session_service - INFO - SessionService initialized with 6 sessions
2025-03-19 23:23:05,519 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 23:23:05,571 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 23:23:05,572 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 23:23:05,572 - payroll_api - INFO - Admin password from env: password
2025-03-19 23:23:05,572 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 23:23:05,572 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 23:23:05,573 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:23:05,573 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 23:23:05,573 - payroll_api - INFO - Initializing authentication
2025-03-19 23:23:05,574 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 23:23:05,574 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 23:23:35,620 - payroll_api - INFO - API shutting down
2025-03-19 23:23:35,622 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:23:35,622 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:23:35,630 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:23:42,310 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:23:42,328 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:23:42,382 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:23:42,384 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-19 23:23:42,386 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-19 23:23:42,388 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 23:23:42,389 - payroll_api - INFO - FileService initialized successfully
2025-03-19 23:23:42,389 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:23:42,391 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 23:23:42,391 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:23:42,394 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:23:42,395 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 23:23:42,400 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:23:42,400 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 23:23:45,994 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:23:46,000 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 23:23:46,000 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 23:23:46,000 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 23:23:46,002 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 23:23:56,634 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 23:23:56,635 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 23:23:56,641 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 23:23:56,830 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:23:56,994 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 23:23:57,161 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 23:23:57,325 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:23:57,488 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 23:23:57,670 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 23:23:57,842 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 23:23:58,556 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 23:23:58,783 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 23:23:58,972 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 23:23:58,976 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 23:23:59,049 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 23:23:59,050 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 23:23:59,050 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 23:23:59,053 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 23:23:59,054 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 23:23:59,100 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 23:23:59,101 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 23:23:59,136 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 23:23:59,148 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 23:23:59,149 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 23:23:59,159 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 23:23:59,191 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 23:23:59,383 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 23:23:59,401 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 23:23:59,405 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 23:23:59,405 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 23:23:59,405 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 23:23:59,407 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 23:23:59,407 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 23:23:59,408 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 23:23:59,413 - application.services.session_service - INFO - Loaded 6 sessions from disk
2025-03-19 23:23:59,413 - application.services.session_service - INFO - SessionService initialized with 6 sessions
2025-03-19 23:23:59,414 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 23:23:59,507 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 23:23:59,507 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 23:23:59,508 - payroll_api - INFO - Admin password from env: password
2025-03-19 23:23:59,508 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 23:23:59,508 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 23:23:59,509 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:23:59,510 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 23:23:59,510 - payroll_api - INFO - Initializing authentication
2025-03-19 23:23:59,511 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 23:23:59,511 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 23:24:20,088 - payroll_api - INFO - API shutting down
2025-03-19 23:24:20,089 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:24:20,090 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:24:20,100 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:24:26,546 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:24:26,578 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:24:26,632 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:24:26,633 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-19 23:24:26,633 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-19 23:24:26,634 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 23:24:26,635 - payroll_api - INFO - FileService initialized successfully
2025-03-19 23:24:26,635 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:24:26,637 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 23:24:26,637 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:24:26,638 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:24:26,639 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 23:24:26,647 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:24:26,647 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 23:24:29,315 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:24:29,319 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 23:24:29,319 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 23:24:29,320 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 23:24:29,320 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 23:24:38,032 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 23:24:38,032 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 23:24:38,036 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 23:24:38,287 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:24:38,460 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 23:24:38,636 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 23:24:38,826 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:24:39,009 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 23:24:39,190 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 23:24:39,365 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 23:24:39,932 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 23:24:40,191 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 23:24:40,373 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 23:24:40,375 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 23:24:40,398 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 23:24:40,399 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 23:24:40,399 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 23:24:40,401 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 23:24:40,402 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 23:24:40,424 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 23:24:40,424 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 23:24:40,449 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 23:24:40,456 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 23:24:40,457 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 23:24:40,465 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 23:24:40,483 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 23:24:40,704 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 23:24:40,716 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 23:24:40,718 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 23:24:40,719 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 23:24:40,719 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 23:24:40,720 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 23:24:40,720 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 23:24:40,720 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 23:24:40,722 - application.services.session_service - INFO - Loaded 6 sessions from disk
2025-03-19 23:24:40,723 - application.services.session_service - INFO - SessionService initialized with 6 sessions
2025-03-19 23:24:40,723 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 23:24:40,765 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 23:24:40,765 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 23:24:40,765 - payroll_api - INFO - Admin password from env: password
2025-03-19 23:24:40,767 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 23:24:40,767 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 23:24:40,768 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:24:40,768 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 23:24:40,768 - payroll_api - INFO - Initializing authentication
2025-03-19 23:24:40,768 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 23:24:40,768 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 23:26:13,816 - payroll_api - INFO - API shutting down
2025-03-19 23:26:13,818 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:26:13,820 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:26:13,827 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:26:20,168 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:26:20,190 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:26:20,237 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:26:20,238 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-19 23:26:20,239 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-19 23:26:20,240 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 23:26:20,241 - payroll_api - INFO - FileService initialized successfully
2025-03-19 23:26:20,242 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:26:20,242 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 23:26:20,242 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:26:20,244 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:26:20,244 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 23:26:20,248 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:26:20,248 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 23:26:23,592 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:26:23,600 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 23:26:23,618 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 23:26:23,618 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 23:26:23,619 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 23:26:31,946 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 23:26:31,947 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 23:26:31,951 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 23:26:32,170 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:26:32,375 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 23:26:32,544 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 23:26:32,899 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:26:34,128 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 23:26:34,306 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 23:26:34,477 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 23:26:35,056 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 23:26:35,327 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 23:26:35,515 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 23:26:35,518 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 23:26:35,542 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 23:26:35,543 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 23:26:35,543 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 23:26:35,545 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 23:26:35,546 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 23:26:35,572 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 23:26:35,573 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 23:26:35,598 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 23:26:35,607 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 23:26:35,607 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 23:26:35,616 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 23:26:35,637 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 23:26:35,821 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 23:26:35,843 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 23:26:35,845 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 23:26:35,845 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 23:26:35,846 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 23:26:35,846 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 23:26:35,846 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 23:26:35,848 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 23:26:35,853 - application.services.session_service - INFO - Loaded 6 sessions from disk
2025-03-19 23:26:35,853 - application.services.session_service - INFO - SessionService initialized with 6 sessions
2025-03-19 23:26:35,853 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 23:26:35,934 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 23:26:35,934 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 23:26:35,935 - payroll_api - INFO - Admin password from env: password
2025-03-19 23:26:35,935 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 23:26:35,935 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 23:26:35,936 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:26:35,937 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 23:26:35,937 - payroll_api - INFO - Initializing authentication
2025-03-19 23:26:35,937 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 23:26:35,938 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 23:26:59,534 - payroll_api - INFO - API shutting down
2025-03-19 23:26:59,535 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:26:59,536 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:26:59,543 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:27:06,015 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:27:06,036 - payroll_api - CRITICAL - Error initializing services: 'FileService' object has no attribute 'file_agent'
2025-03-19 23:27:55,566 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:27:55,585 - payroll_api - CRITICAL - Error initializing services: 'FileService' object has no attribute 'file_agent'
2025-03-19 23:29:33,251 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:29:33,354 - payroll_api - CRITICAL - Error initializing services: 'FileService' object has no attribute 'file_agent'
2025-03-19 23:33:01,413 - payroll_api - CRITICAL - Failed to import service modules: No module named 'modules.file_agent'; 'modules' is not a package
2025-03-19 23:33:36,641 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:33:36,660 - payroll_api - CRITICAL - Error initializing services: 'FileService' object has no attribute 'file_agent'
2025-03-19 23:36:03,915 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:36:03,932 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:36:03,962 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:36:03,971 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-19 23:36:03,971 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-19 23:36:03,972 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-19 23:36:03,973 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 23:36:03,973 - payroll_api - INFO - FileService initialized successfully
2025-03-19 23:36:03,973 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:36:03,973 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 23:36:03,973 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:36:03,975 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:36:03,975 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 23:36:03,978 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:36:03,979 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 23:36:06,215 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:36:06,222 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 23:36:06,223 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 23:36:06,223 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 23:36:06,223 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 23:36:12,884 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 23:36:12,884 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 23:36:12,889 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 23:36:13,100 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:36:13,276 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 23:36:13,443 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 23:36:13,604 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:36:13,774 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 23:36:13,956 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 23:36:14,184 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 23:36:14,665 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 23:36:14,881 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 23:36:15,052 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 23:36:15,055 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 23:36:15,079 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 23:36:15,080 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 23:36:15,080 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 23:36:15,083 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 23:36:15,084 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 23:36:15,105 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 23:36:15,106 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 23:36:15,128 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 23:36:15,134 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 23:36:15,135 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 23:36:15,144 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 23:36:15,166 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 23:36:15,356 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 23:36:15,801 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 23:36:15,807 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 23:36:15,808 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 23:36:15,809 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 23:36:15,812 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 23:36:15,812 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 23:36:15,815 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 23:36:15,819 - application.services.session_service - INFO - Loaded 6 sessions from disk
2025-03-19 23:36:15,820 - application.services.session_service - INFO - SessionService initialized with 6 sessions
2025-03-19 23:36:15,821 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 23:36:16,024 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 23:36:16,024 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 23:36:16,024 - payroll_api - INFO - Admin password from env: password
2025-03-19 23:36:16,026 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 23:36:16,026 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 23:36:16,027 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:36:16,027 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 23:36:16,027 - payroll_api - INFO - Initializing authentication
2025-03-19 23:36:16,027 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 23:36:16,027 - payroll_api - INFO - Authentication initialized successfully
2025-03-19 23:37:31,135 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 23:37:31,136 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 23:37:31,136 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 23:37:31,137 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 23:37:31,137 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 23:37:31,138 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 23:37:31,138 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 23:37:31,138 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 23:37:31,139 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 23:37:31,139 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 23:37:31,139 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 23:37:31,140 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 23:37:31,140 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 23:37:31,141 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 23:37:31,142 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-19 23:37:31,142 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-19 23:37:31,143 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 23:37:31,143 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 23:37:31,143 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-19 23:37:31,145 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-19 23:37:31,145 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 23:37:31,145 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-19 23:37:31,146 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-19 23:37:31,146 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-19 23:37:31,147 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-19 23:37:31,147 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 23:37:31,152 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 23:37:31,152 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 23:37:31,153 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 23:37:31,154 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-19 23:37:31,154 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-19 23:37:31,484 - payroll_api - DEBUG - Authentication result: True
2025-03-19 23:37:31,490 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-19 23:37:31,490 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 23:37:31,491 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 23:37:31,831 - payroll_api - DEBUG - Authentication result: True
2025-03-19 23:37:47,762 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 23:37:47,762 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-19 23:37:47,762 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-19 23:37:47,762 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 23:37:47,762 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-19 23:37:47,762 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-19 23:37:47,764 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 23:37:47,764 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 23:37:47,764 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:98304]
2025-03-19 23:37:47,765 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:104237]
2025-03-19 23:37:47,766 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 23:37:47,766 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 23:37:47,766 - python_multipart.multipart - DEBUG - Calling on_header_field with data[104281:104300]
2025-03-19 23:37:47,767 - python_multipart.multipart - DEBUG - Calling on_header_value with data[104302:104329]
2025-03-19 23:37:47,767 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 23:37:47,767 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 23:37:47,768 - python_multipart.multipart - DEBUG - Calling on_part_data with data[104333:104339]
2025-03-19 23:37:47,768 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 23:37:47,768 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-19 23:37:47,768 - python_multipart.multipart - DEBUG - Calling on_header_field with data[104383:104402]
2025-03-19 23:37:47,769 - python_multipart.multipart - DEBUG - Calling on_header_value with data[104404:104431]
2025-03-19 23:37:47,769 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-19 23:37:47,769 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-19 23:37:47,770 - python_multipart.multipart - DEBUG - Calling on_part_data with data[104435:104441]
2025-03-19 23:37:47,770 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-19 23:37:47,770 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-19 23:37:47,773 - application.services.session_service - INFO - Created new session: 940604d5-d2b1-409d-9d2d-f3e78023b4f3
2025-03-19 23:37:47,773 - payroll_api - INFO - Created new session: 940604d5-d2b1-409d-9d2d-f3e78023b4f3
2025-03-19 23:37:47,774 - payroll_api - INFO - File upload request from user admin, session 940604d5-d2b1-409d-9d2d-f3e78023b4f3: sikyu_csv_sample.csv
2025-03-19 23:37:47,776 - payroll_api - DEBUG - File saved to: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv
2025-03-19 23:37:47,776 - application.services.file_service - INFO - Starting to upload file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv
2025-03-19 23:37:47,848 - application.services.file_service - DEBUG - File validation result: valid=True, message=File validation successful
2025-03-19 23:37:47,848 - application.services.file_service - DEBUG - Creating secure copy of file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv
2025-03-19 23:37:47,872 - application.services.file_service - INFO - Created secure copy of C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\f6920d73-2443-42a4-9988-1d73344d4a45.csv
2025-03-19 23:37:47,873 - application.services.file_service - DEBUG - Checking file identity: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\f6920d73-2443-42a4-9988-1d73344d4a45.csv
2025-03-19 23:37:47,873 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\f6920d73-2443-42a4-9988-1d73344d4a45.csv
2025-03-19 23:37:47,873 - application.services.file_service - INFO - File identity result: 検索した結果、ファイルの識別ができません。
2025-03-19 23:37:47,874 - application.services.file_service - INFO - Successfully processed file: 43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv
2025-03-19 23:37:47,874 - payroll_api - DEBUG - File processed by file_service: {'success': True, 'file_path': 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\f6920d73-2443-42a4-9988-1d73344d4a45.csv', 'file_name': '43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv', 'identity_result': '検索した結果、ファイルの識別ができません。', 'original_path': 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv'}
2025-03-19 23:37:47,875 - payroll_api - ERROR - Error storing file in database: name 'pd' is not defined
2025-03-19 23:37:47,875 - payroll_api - ERROR - Detailed traceback:
Traceback (most recent call last):
  File "C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\api.py", line 643, in upload_file_endpoint
    df = pd.read_csv(file_path)
         ^^
NameError: name 'pd' is not defined
2025-03-19 23:37:47,877 - application.services.payroll_service - INFO - Processing message: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv
2025-03-19 23:37:47,877 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-19 23:37:47,878 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈


# 現在のユーザー入力
User: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-19 23:37:47,888 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\n\n\n# 現在のユーザー入力\nUser: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-19 23:37:47,915 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-19 23:37:47,915 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-19 23:37:48,172 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000213B1DB1D90>
2025-03-19 23:37:48,172 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021392E315B0> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-19 23:37:48,523 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000213B1DBCA10>
2025-03-19 23:37:48,523 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-19 23:37:48,524 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-19 23:37:48,524 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-19 23:37:48,524 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-19 23:37:48,524 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-19 23:37:49,424 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1258'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'1fadb20b-8f50-41e2-a18e-13759e4a586a'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'999'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'96835'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'617'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'671'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'3136a408-4feb-46ff-a1ac-58b656cd7c8a'), (b'ms-azureml-model-time', b'668'), (b'x-ms-client-request-id', b'1fadb20b-8f50-41e2-a18e-13759e4a586a'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 14:37:49 GMT')])
2025-03-19 23:37:49,426 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-19 23:37:49,427 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-19 23:37:49,427 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-19 23:37:49,427 - httpcore.http11 - DEBUG - response_closed.started
2025-03-19 23:37:49,428 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-19 23:37:49,428 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1258', 'content-type': 'application/json', 'apim-request-id': '1fadb20b-8f50-41e2-a18e-13759e4a586a', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '999', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '96835', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '617', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '671', 'x-ms-rai-invoked': 'true', 'x-request-id': '3136a408-4feb-46ff-a1ac-58b656cd7c8a', 'ms-azureml-model-time': '668', 'x-ms-client-request-id': '1fadb20b-8f50-41e2-a18e-13759e4a586a', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 14:37:49 GMT'})
2025-03-19 23:37:49,429 - openai._base_client - DEBUG - request_id: 3136a408-4feb-46ff-a1ac-58b656cd7c8a
2025-03-19 23:37:49,433 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'file_upload', 'file_type': 'csv'}
2025-03-19 23:37:49,434 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv
2025-03-19 23:37:49,542 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('アップロードされたファイルは以下のファイルの一つと推定する：\n支給控除等一覧(データ更新)-支給・控除等一覧表\n支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表\n支給控除等一覧(後処理)-更新された支給・控除等一覧表\n支給控除等一覧(後処理)-削除リスト\n支給控除等一覧(後処理)-漢字変換リスト\nYonosukeデータ作成(加算処理)-給与明細データ\nYonosukeデータ作成(加算処理)-前月Yonosukeデータ\nYonosukeデータ作成(加算処理)-賞与データ\nYonosukeデータ作成(データ除去)-今月Yonosukeデータ\nYonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト', ''), type: <class 'tuple'>
2025-03-19 23:37:49,543 - application.services.payroll_service - DEBUG - Standardized response: (アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト, )
2025-03-19 23:37:49,545 - payroll_api - DEBUG - Payroll service processed message: アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト
2025-03-19 23:37:49,549 - payroll_api - INFO - File uploaded successfully: sikyu_csv_sample.csv
2025-03-19 23:37:49,552 - payroll_api - DEBUG - Cleaned up temporary file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\43fb69ea-ad77-4b8c-b94e-aa13b6475b29.csv
2025-03-19 23:38:43,113 - application.services.session_service - INFO - Created new session: 87a3c8f3-6d9b-419c-8f98-777365c8dd35
2025-03-19 23:38:43,114 - payroll_api - INFO - Created new session: 87a3c8f3-6d9b-419c-8f98-777365c8dd35
2025-03-19 23:38:43,115 - payroll_api - INFO - Files list requested by user admin for session 87a3c8f3-6d9b-419c-8f98-777365c8dd35
2025-03-19 23:38:43,116 - application.services.file_service - INFO - Getting list of all files
2025-03-19 23:38:43,116 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-19 23:38:43,119 - application.services.file_service - DEBUG - Raw files from file_agent.get_all_files(): []
2025-03-19 23:38:43,119 - application.services.file_service - DEBUG - Processed file list: []
2025-03-19 23:38:43,119 - payroll_api - DEBUG - Raw files from file_service: []
2025-03-19 23:38:43,119 - payroll_api - DEBUG - Adapted files for frontend: []
2025-03-19 23:53:21,057 - payroll_api - INFO - API shutting down
2025-03-19 23:53:21,059 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:53:21,061 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:53:21,073 - langsmith.client - DEBUG - Closing Client.session
2025-03-19 23:53:27,078 - payroll_api - INFO - Service modules imported successfully
2025-03-19 23:53:27,096 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:53:27,133 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:53:27,164 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-19 23:53:27,168 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-19 23:53:27,171 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-19 23:53:27,175 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-19 23:53:27,175 - payroll_api - INFO - FileService initialized successfully
2025-03-19 23:53:27,175 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:53:27,175 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-19 23:53:27,177 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-19 23:53:27,179 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:53:27,180 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-19 23:53:27,200 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-19 23:53:27,201 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-19 23:53:30,043 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-19 23:53:30,048 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-19 23:53:30,049 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-19 23:53:30,049 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-19 23:53:30,050 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-19 23:53:38,035 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-19 23:53:38,035 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-19 23:53:38,040 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-19 23:53:38,264 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:53:38,466 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-19 23:53:38,638 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-19 23:53:38,805 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-19 23:53:38,984 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-19 23:53:39,165 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-19 23:53:39,335 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-19 23:53:39,864 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-19 23:53:40,096 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-19 23:53:40,311 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-19 23:53:40,314 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-19 23:53:40,341 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-19 23:53:40,342 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-19 23:53:40,342 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-19 23:53:40,344 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-19 23:53:40,345 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-19 23:53:40,365 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-19 23:53:40,365 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-19 23:53:40,392 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-19 23:53:40,397 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-19 23:53:40,399 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-19 23:53:40,407 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-19 23:53:40,425 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-19 23:53:40,643 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-19 23:53:40,676 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-19 23:53:40,678 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-19 23:53:40,678 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-19 23:53:40,678 - application.modules.agent_collection - INFO - workflow 作成
2025-03-19 23:53:40,679 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-19 23:53:40,679 - payroll_api - INFO - PayrollService initialized successfully
2025-03-19 23:53:40,680 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-19 23:53:40,682 - application.services.session_service - INFO - Loaded 8 sessions from disk
2025-03-19 23:53:40,683 - application.services.session_service - INFO - SessionService initialized with 8 sessions
2025-03-19 23:53:40,683 - payroll_api - INFO - SessionService initialized successfully
2025-03-19 23:53:40,939 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-19 23:53:40,941 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-19 23:53:40,941 - payroll_api - INFO - Admin password from env: password
2025-03-19 23:53:40,941 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-19 23:53:40,942 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-19 23:53:40,943 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-19 23:53:40,943 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-19 23:53:40,944 - payroll_api - INFO - Initializing authentication
2025-03-19 23:53:40,944 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-19 23:53:40,944 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 00:05:48,047 - payroll_api - INFO - API shutting down
2025-03-20 00:05:48,048 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:05:48,050 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:05:48,061 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:05:54,285 - payroll_api - INFO - Service modules imported successfully
2025-03-20 00:05:54,302 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:05:54,333 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:05:54,341 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:05:54,341 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 00:05:54,342 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 00:05:54,342 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 00:05:54,344 - payroll_api - INFO - FileService initialized successfully
2025-03-20 00:05:54,344 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:05:54,344 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 00:05:54,344 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:05:54,345 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:05:54,345 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 00:05:54,349 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:05:54,349 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 00:05:56,889 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:05:56,893 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 00:05:56,893 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 00:05:56,893 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 00:05:56,894 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 00:06:06,647 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 00:06:06,647 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 00:06:06,653 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 00:06:06,875 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:06:07,045 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 00:06:07,208 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 00:06:07,377 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:06:07,542 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 00:06:07,752 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 00:06:07,918 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 00:06:08,416 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 00:06:08,641 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 00:06:08,816 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 00:06:08,818 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 00:06:08,843 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 00:06:08,843 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 00:06:08,843 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 00:06:08,847 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 00:06:08,847 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 00:06:08,869 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 00:06:08,869 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 00:06:08,893 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 00:06:08,901 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 00:06:08,903 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 00:06:08,912 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 00:06:08,932 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 00:06:09,114 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 00:06:09,127 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 00:06:09,130 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 00:06:09,130 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 00:06:09,132 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 00:06:09,133 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 00:06:09,133 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 00:06:09,133 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 00:06:09,136 - application.services.session_service - INFO - Loaded 8 sessions from disk
2025-03-20 00:06:09,136 - application.services.session_service - INFO - SessionService initialized with 8 sessions
2025-03-20 00:06:09,136 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 00:06:09,451 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:06:09,451 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:06:09,452 - payroll_api - INFO - Admin password from env: password
2025-03-20 00:06:09,452 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 00:06:09,452 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 00:06:09,455 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:06:09,455 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 00:06:09,456 - payroll_api - INFO - Initializing authentication
2025-03-20 00:06:09,456 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 00:06:09,457 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 00:06:28,243 - payroll_api - INFO - API shutting down
2025-03-20 00:06:28,243 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:06:28,244 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:06:28,252 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:06:34,344 - payroll_api - INFO - Service modules imported successfully
2025-03-20 00:06:34,360 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:06:34,391 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:06:34,399 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:06:34,399 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 00:06:34,400 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 00:06:34,400 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 00:06:34,401 - payroll_api - INFO - FileService initialized successfully
2025-03-20 00:06:34,401 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:06:34,401 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 00:06:34,401 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:06:34,402 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:06:34,402 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 00:06:34,405 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:06:34,406 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 00:06:36,813 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:06:36,817 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 00:06:36,817 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 00:06:36,818 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 00:06:36,818 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 00:06:46,070 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 00:06:46,070 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 00:06:46,074 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 00:06:46,337 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:06:46,504 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 00:06:46,676 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 00:06:46,851 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:06:47,035 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 00:06:50,151 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 00:06:50,333 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 00:06:50,895 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 00:06:51,139 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 00:06:51,329 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 00:06:51,332 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 00:06:51,373 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 00:06:51,373 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 00:06:51,373 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 00:06:51,377 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 00:06:51,378 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 00:06:51,411 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 00:06:51,412 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 00:06:51,448 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 00:06:51,462 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 00:06:51,465 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 00:06:51,476 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 00:06:51,509 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 00:06:51,690 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 00:06:51,720 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 00:06:51,723 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 00:06:51,723 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 00:06:51,724 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 00:06:51,724 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 00:06:51,725 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 00:06:51,727 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 00:06:51,730 - application.services.session_service - INFO - Loaded 8 sessions from disk
2025-03-20 00:06:51,731 - application.services.session_service - INFO - SessionService initialized with 8 sessions
2025-03-20 00:06:51,731 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 00:06:52,119 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:06:52,119 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:06:52,120 - payroll_api - INFO - Admin password from env: password
2025-03-20 00:06:52,120 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 00:06:52,121 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 00:06:52,122 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:06:52,122 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 00:06:52,122 - payroll_api - INFO - Initializing authentication
2025-03-20 00:06:52,123 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 00:06:52,123 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 00:08:10,632 - payroll_api - INFO - API shutting down
2025-03-20 00:08:10,632 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:08:10,633 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:08:10,640 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:08:19,499 - payroll_api - INFO - Service modules imported successfully
2025-03-20 00:08:19,535 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:08:19,589 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:08:19,604 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:08:19,605 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 00:08:19,606 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 00:08:19,606 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 00:08:19,607 - payroll_api - INFO - FileService initialized successfully
2025-03-20 00:08:19,607 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:08:19,607 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 00:08:19,609 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:08:19,609 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:08:19,610 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 00:08:19,613 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:08:19,613 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 00:08:22,507 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:08:22,514 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 00:08:22,515 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 00:08:22,516 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 00:08:22,518 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 00:08:30,952 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 00:08:30,952 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 00:08:30,959 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 00:08:31,362 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:08:31,615 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 00:08:31,862 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 00:08:32,033 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:08:32,217 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 00:08:32,476 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 00:08:32,753 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 00:08:33,294 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 00:08:33,608 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 00:08:33,801 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 00:08:33,810 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 00:08:33,899 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 00:08:33,900 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 00:08:33,901 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 00:08:33,904 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 00:08:33,905 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 00:08:33,939 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 00:08:33,940 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 00:08:33,982 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 00:08:33,994 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 00:08:33,998 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 00:08:34,011 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 00:08:34,041 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 00:08:34,314 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 00:08:34,329 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 00:08:34,332 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 00:08:34,332 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 00:08:34,334 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 00:08:34,335 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 00:08:34,335 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 00:08:34,336 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 00:08:34,339 - application.services.session_service - INFO - Loaded 8 sessions from disk
2025-03-20 00:08:34,339 - application.services.session_service - INFO - SessionService initialized with 8 sessions
2025-03-20 00:08:34,340 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 00:08:34,591 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:08:34,592 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:08:34,592 - payroll_api - INFO - Admin password from env: password
2025-03-20 00:08:34,592 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 00:08:34,593 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 00:08:34,593 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:08:34,594 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 00:08:34,594 - payroll_api - INFO - Initializing authentication
2025-03-20 00:08:34,594 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 00:08:34,596 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 00:12:42,520 - payroll_api - INFO - API shutting down
2025-03-20 00:12:42,522 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:12:42,523 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:12:42,536 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:12:47,893 - payroll_api - INFO - Service modules imported successfully
2025-03-20 00:12:47,913 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:12:47,951 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:12:47,961 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:12:47,962 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 00:12:47,962 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 00:12:47,962 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 00:12:47,963 - payroll_api - INFO - FileService initialized successfully
2025-03-20 00:12:47,963 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:12:47,963 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 00:12:47,965 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:12:47,965 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:12:47,966 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 00:12:47,969 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:12:47,970 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 00:12:50,333 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:12:50,339 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 00:12:50,339 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 00:12:50,340 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 00:12:50,340 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 00:12:57,743 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 00:12:57,744 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 00:12:57,748 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 00:12:58,339 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:12:58,509 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 00:12:58,680 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 00:12:58,860 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:12:59,025 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 00:12:59,194 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 00:12:59,365 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 00:12:59,824 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 00:13:00,046 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 00:13:00,234 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 00:13:00,237 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 00:13:00,259 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 00:13:00,259 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 00:13:00,259 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 00:13:00,261 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 00:13:00,262 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 00:13:00,280 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 00:13:00,280 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 00:13:00,303 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 00:13:00,310 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 00:13:00,311 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 00:13:00,319 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 00:13:00,339 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 00:13:00,512 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 00:13:00,529 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 00:13:00,531 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 00:13:00,531 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 00:13:00,531 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 00:13:00,531 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 00:13:00,532 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 00:13:00,533 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 00:13:00,535 - application.services.session_service - INFO - Loaded 8 sessions from disk
2025-03-20 00:13:00,535 - application.services.session_service - INFO - SessionService initialized with 8 sessions
2025-03-20 00:13:00,535 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 00:13:00,722 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:13:00,722 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:13:00,723 - payroll_api - INFO - Admin password from env: password
2025-03-20 00:13:00,723 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 00:13:00,723 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 00:13:00,724 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:13:00,724 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 00:13:00,724 - payroll_api - INFO - Initializing authentication
2025-03-20 00:13:00,724 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 00:13:00,724 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 00:14:48,634 - payroll_api - INFO - API shutting down
2025-03-20 00:14:48,635 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:14:48,636 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:14:48,644 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:14:54,474 - payroll_api - INFO - Service modules imported successfully
2025-03-20 00:14:54,493 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:14:54,528 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:14:54,536 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:14:54,536 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 00:14:54,536 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 00:14:54,538 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 00:14:54,538 - payroll_api - INFO - FileService initialized successfully
2025-03-20 00:14:54,539 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:14:54,539 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 00:14:54,539 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:14:54,540 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:14:54,541 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 00:14:54,544 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:14:54,544 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 00:14:57,450 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:14:57,454 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 00:14:57,454 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 00:14:57,455 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 00:14:57,455 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 00:15:31,764 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 00:15:31,764 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 00:15:31,770 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 00:15:31,988 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:15:32,167 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 00:15:32,471 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 00:15:32,660 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:15:32,842 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 00:15:33,027 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 00:15:33,194 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 00:15:34,001 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 00:15:34,250 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 00:15:34,514 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 00:15:34,521 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 00:15:34,545 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 00:15:34,545 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 00:15:34,546 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 00:15:34,554 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 00:15:34,554 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 00:15:34,577 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 00:15:34,578 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 00:15:34,847 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 00:15:34,856 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 00:15:34,860 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 00:15:34,929 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 00:15:34,944 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 00:15:35,133 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 00:15:35,167 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 00:15:35,169 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 00:15:35,170 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 00:15:35,170 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 00:15:35,171 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 00:15:35,171 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 00:15:35,171 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 00:15:35,228 - application.services.session_service - INFO - Loaded 8 sessions from disk
2025-03-20 00:15:35,228 - application.services.session_service - INFO - SessionService initialized with 8 sessions
2025-03-20 00:15:35,229 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 00:15:35,438 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:15:35,439 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:15:35,439 - payroll_api - INFO - Admin password from env: password
2025-03-20 00:15:35,439 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 00:15:35,439 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 00:15:35,440 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:15:35,440 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 00:15:35,441 - payroll_api - INFO - Initializing authentication
2025-03-20 00:15:35,441 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 00:15:35,441 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 00:15:35,442 - payroll_api - INFO - API shutting down
2025-03-20 00:15:35,443 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:15:35,489 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:15:35,497 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:15:48,401 - payroll_api - INFO - Service modules imported successfully
2025-03-20 00:15:48,439 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:15:48,478 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:15:48,490 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:15:48,490 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 00:15:48,491 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 00:15:48,492 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 00:15:48,492 - payroll_api - INFO - FileService initialized successfully
2025-03-20 00:15:48,492 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:15:48,493 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 00:15:48,493 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:15:48,494 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:15:48,494 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 00:15:48,498 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:15:48,498 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 00:15:51,351 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:15:51,355 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 00:15:51,355 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 00:15:51,355 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 00:15:51,356 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 00:15:59,226 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 00:15:59,227 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 00:15:59,231 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 00:15:59,432 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:15:59,649 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 00:15:59,819 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 00:15:59,999 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:16:00,181 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 00:16:00,352 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 00:16:00,543 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 00:16:01,043 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 00:16:01,382 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 00:16:01,691 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 00:16:01,701 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 00:16:01,737 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 00:16:01,737 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 00:16:01,737 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 00:16:01,739 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 00:16:01,739 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 00:16:01,758 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 00:16:01,758 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 00:16:01,782 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 00:16:01,790 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 00:16:01,792 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 00:16:01,801 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 00:16:01,818 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 00:16:01,998 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 00:16:02,105 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 00:16:02,108 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 00:16:02,108 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 00:16:02,108 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 00:16:02,109 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 00:16:02,109 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 00:16:02,109 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 00:16:02,111 - application.services.session_service - INFO - Loaded 8 sessions from disk
2025-03-20 00:16:02,111 - application.services.session_service - INFO - SessionService initialized with 8 sessions
2025-03-20 00:16:02,111 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 00:16:02,307 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:16:02,307 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:16:02,307 - payroll_api - INFO - Admin password from env: password
2025-03-20 00:16:02,308 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 00:16:02,308 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 00:16:02,310 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:16:02,310 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 00:16:02,310 - payroll_api - INFO - Initializing authentication
2025-03-20 00:16:02,310 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 00:16:02,310 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 00:16:31,484 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:16:31,484 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-20 00:16:31,484 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-20 00:16:31,485 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:16:31,485 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:16:31,486 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-20 00:16:31,486 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-20 00:16:31,486 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:16:31,486 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:16:31,486 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-20 00:16:31,487 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-20 00:16:31,487 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:16:31,487 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 00:16:31,490 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-20 00:16:31,490 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:16:31,490 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:16:31,490 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-20 00:16:31,491 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-20 00:16:31,790 - payroll_api - DEBUG - Authentication result: True
2025-03-20 00:16:45,381 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:16:45,381 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-20 00:16:45,383 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-20 00:16:45,383 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:16:45,384 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-20 00:16:45,384 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-20 00:16:45,384 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:16:45,385 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:16:45,385 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:49152]
2025-03-20 00:16:45,388 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:32768]
2025-03-20 00:16:45,391 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:120621]
2025-03-20 00:16:45,392 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:16:45,392 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:16:45,393 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120665:120684]
2025-03-20 00:16:45,393 - python_multipart.multipart - DEBUG - Calling on_header_value with data[120686:120713]
2025-03-20 00:16:45,393 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:16:45,394 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:16:45,394 - python_multipart.multipart - DEBUG - Calling on_part_data with data[120717:120723]
2025-03-20 00:16:45,395 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:16:45,395 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:16:45,395 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120767:120786]
2025-03-20 00:16:45,397 - python_multipart.multipart - DEBUG - Calling on_header_value with data[120788:120815]
2025-03-20 00:16:45,397 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:16:45,398 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:16:45,398 - python_multipart.multipart - DEBUG - Calling on_part_data with data[120819:120825]
2025-03-20 00:16:45,399 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:16:45,399 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 00:16:45,404 - application.services.session_service - INFO - Created new session: b3ff170f-d69d-4385-9b11-2dc240cab704
2025-03-20 00:16:45,404 - payroll_api - INFO - Created new session: b3ff170f-d69d-4385-9b11-2dc240cab704
2025-03-20 00:16:45,407 - payroll_api - INFO - File upload request from user admin, session b3ff170f-d69d-4385-9b11-2dc240cab704: sikyu_csv_sample.csv
2025-03-20 00:16:45,410 - payroll_api - DEBUG - File saved to: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\42952e9f-208b-4cd4-8a47-4f0614754bda.csv
2025-03-20 00:16:45,456 - payroll_api - INFO - Successfully read file with 490 rows
2025-03-20 00:16:45,456 - application.modules.file_agent - INFO - store_csv_file開始: uploaded_8a5d0a82-7894-4872-af85-f14f666f2785, definition=Uploaded STRING file, task_name=string, rows=490
2025-03-20 00:16:45,459 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:16:45,463 - application.modules.file_agent - DEBUG - DataFrame info: {'columns': ['Unnamed: 0.1', 'Unnamed: 0', '従業員名', 'スタッフコード', 'グループ名', '給与規定グループ', '基本給', '基本給調整', '非課税通勤手当', '課税通勤手当', '通勤費調整（非）', '通勤費調整（課）', '自宅駐車場手当', '自宅駐車場手当調整', 'WFH 手当', 'WFH 手当調整', '単身赴任手当', '帰郷旅費手当', '赴任手当(課税)', '赴任手当(非課税)', '調整手当', '調整手当精算', '育児費用補助', '慶弔金', 'その他支給(課税）', 'その他支給(非課税）', 'Recognitionポイント', 'Recognition ポイント 所得税', 'その他報奨', 'その他報奨 所得税', '永年勤続', '交代勤務手当', '連操手当', '所定内残業手当', '普通残業手当', '深夜残業手当', '法定外休日残業手当', '法定休日残業手当', '60時間超手当', '時間外手当遡及', '代休控除', '遅刻早退欠勤控除', '経費', '支給合計', '課税支給合計', '非課税支給合計', '健康保険料', '健康保険料\u3000本人負担（翌月分）', '介護保険料', '介護保険料\u3000本人負担（翌月分）', '厚生年金保険料', '厚年保険料\u3000本人負担（翌月分）', '社会保険料調整\u3000本人負担', '雇用保険料', '社会保険料合計', 'DC加入者掛金', '所得税', '2024減税額', '2024減税後所得税', '住民税', '扶養是正', '還付徴収額（年調）', 'Recognition ポイント控除', '現物支給控除', '社用車プライベート使用料', '社宅費', '組合費', '給食費', '差押', '生保日本生命', '生保第一生命', '生保アフラック', '生保大樹', '積立貯蓄', '財形労金', 'その他控除', '控除合計', '差引支給額', '銀行振込１', '銀行振込２', '健保事業主負担', '介護事業主負担', '厚年事業主負担', '子育拠出金', '雇保事業主負担', '労災保険料', '一般拠出金', '確定拠出企業年金', 'キャッシュバランス', '出勤日数', '出勤時間', '所定内残業', '普通残業', '深夜残業', '法定外休日残業', '法定休日残業', '60時間超', '代休控除日数', '欠勤控除時間', '遅刻早退欠勤控除時間', '当月所定労働時間', '備考'], 'dtypes': {'Unnamed: 0.1': 'int64', 'Unnamed: 0': 'int64', '従業員名': 'float64', 'スタッフコード': 'int64', 'グループ名': 'float64', '給与規定グループ': 'object', '基本給': 'int64', '基本給調整': 'int64', '非課税通勤手当': 'int64', '課税通勤手当': 'int64', '通勤費調整（非）': 'int64', '通勤費調整（課）': 'int64', '自宅駐車場手当': 'int64', '自宅駐車場手当調整': 'int64', 'WFH 手当': 'int64', 'WFH 手当調整': 'int64', '単身赴任手当': 'int64', '帰郷旅費手当': 'int64', '赴任手当(課税)': 'int64', '赴任手当(非課税)': 'int64', '調整手当': 'int64', '調整手当精算': 'int64', '育児費用補助': 'int64', '慶弔金': 'int64', 'その他支給(課税）': 'int64', 'その他支給(非課税）': 'int64', 'Recognitionポイント': 'int64', 'Recognition ポイント 所得税': 'int64', 'その他報奨': 'int64', 'その他報奨 所得税': 'int64', '永年勤続': 'int64', '交代勤務手当': 'int64', '連操手当': 'int64', '所定内残業手当': 'int64', '普通残業手当': 'int64', '深夜残業手当': 'int64', '法定外休日残業手当': 'int64', '法定休日残業手当': 'int64', '60時間超手当': 'int64', '時間外手当遡及': 'int64', '代休控除': 'int64', '遅刻早退欠勤控除': 'int64', '経費': 'int64', '支給合計': 'int64', '課税支給合計': 'int64', '非課税支給合計': 'int64', '健康保険料': 'int64', '健康保険料\u3000本人負担（翌月分）': 'int64', '介護保険料': 'int64', '介護保険料\u3000本人負担（翌月分）': 'int64', '厚生年金保険料': 'int64', '厚年保険料\u3000本人負担（翌月分）': 'int64', '社会保険料調整\u3000本人負担': 'int64', '雇用保険料': 'int64', '社会保険料合計': 'int64', 'DC加入者掛金': 'int64', '所得税': 'int64', '2024減税額': 'int64', '2024減税後所得税': 'int64', '住民税': 'int64', '扶養是正': 'int64', '還付徴収額（年調）': 'int64', 'Recognition ポイント控除': 'int64', '現物支給控除': 'int64', '社用車プライベート使用料': 'int64', '社宅費': 'int64', '組合費': 'int64', '給食費': 'int64', '差押': 'int64', '生保日本生命': 'int64', '生保第一生命': 'int64', '生保アフラック': 'int64', '生保大樹': 'int64', '積立貯蓄': 'int64', '財形労金': 'int64', 'その他控除': 'int64', '控除合計': 'int64', '差引支給額': 'int64', '銀行振込１': 'int64', '銀行振込２': 'int64', '健保事業主負担': 'int64', '介護事業主負担': 'int64', '厚年事業主負担': 'int64', '子育拠出金': 'float64', '雇保事業主負担': 'float64', '労災保険料': 'float64', '一般拠出金': 'float64', '確定拠出企業年金': 'int64', 'キャッシュバランス': 'int64', '出勤日数': 'float64', '出勤時間': 'object', '所定内残業': 'object', '普通残業': 'object', '深夜残業': 'object', '法定外休日残業': 'object', '法定休日残業': 'object', '60時間超': 'object', '代休控除日数': 'float64', '欠勤控除時間': 'object', '遅刻早退欠勤控除時間': 'object', '当月所定労働時間': 'object', '備考': 'float64'}, 'has_nulls': {'Unnamed: 0.1': False, 'Unnamed: 0': False, '従業員名': True, 'スタッフコード': False, 'グループ名': False, '給与規定グループ': False, '基本給': False, '基本給調整': False, '非課税通勤手当': False, '課税通勤手当': False, '通勤費調整（非）': False, '通勤費調整（課）': False, '自宅駐車場手当': False, '自宅駐車場手当調整': False, 'WFH 手当': False, 'WFH 手当調整': False, '単身赴任手当': False, '帰郷旅費手当': False, '赴任手当(課税)': False, '赴任手当(非課税)': False, '調整手当': False, '調整手当精算': False, '育児費用補助': False, '慶弔金': False, 'その他支給(課税）': False, 'その他支給(非課税）': False, 'Recognitionポイント': False, 'Recognition ポイント 所得税': False, 'その他報奨': False, 'その他報奨 所得税': False, '永年勤続': False, '交代勤務手当': False, '連操手当': False, '所定内残業手当': False, '普通残業手当': False, '深夜残業手当': False, '法定外休日残業手当': False, '法定休日残業手当': False, '60時間超手当': False, '時間外手当遡及': False, '代休控除': False, '遅刻早退欠勤控除': False, '経費': False, '支給合計': False, '課税支給合計': False, '非課税支給合計': False, '健康保険料': False, '健康保険料\u3000本人負担（翌月分）': False, '介護保険料': False, '介護保険料\u3000本人負担（翌月分）': False, '厚生年金保険料': False, '厚年保険料\u3000本人負担（翌月分）': False, '社会保険料調整\u3000本人負担': False, '雇用保険料': False, '社会保険料合計': False, 'DC加入者掛金': False, '所得税': False, '2024減税額': False, '2024減税後所得税': False, '住民税': False, '扶養是正': False, '還付徴収額（年調）': False, 'Recognition ポイント控除': False, '現物支給控除': False, '社用車プライベート使用料': False, '社宅費': False, '組合費': False, '給食費': False, '差押': False, '生保日本生命': False, '生保第一生命': False, '生保アフラック': False, '生保大樹': False, '積立貯蓄': False, '財形労金': False, 'その他控除': False, '控除合計': False, '差引支給額': False, '銀行振込１': False, '銀行振込２': False, '健保事業主負担': False, '介護事業主負担': False, '厚年事業主負担': False, '子育拠出金': False, '雇保事業主負担': False, '労災保険料': False, '一般拠出金': False, '確定拠出企業年金': False, 'キャッシュバランス': False, '出勤日数': False, '出勤時間': False, '所定内残業': False, '普通残業': False, '深夜残業': False, '法定外休日残業': False, '法定休日残業': False, '60時間超': False, '代休控除日数': False, '欠勤控除時間': False, '遅刻早退欠勤控除時間': False, '当月所定労働時間': False, '備考': True}}
2025-03-20 00:16:45,478 - application.modules.file_agent - DEBUG - DataFile record created with ID: 1
2025-03-20 00:16:45,744 - application.modules.file_agent - DEBUG - Saved chunk 1 with 490 records
2025-03-20 00:16:45,762 - application.modules.file_agent - INFO - ファイルを保存しました。DataFile ID=1, 490 行, 1 chunks
2025-03-20 00:16:45,764 - payroll_api - INFO - File successfully stored in database with ID: 1
2025-03-20 00:16:45,764 - application.services.payroll_service - INFO - Processing message: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\42952e9f-208b-4cd4-8a47-4f0614754bda.csv
2025-03-20 00:16:45,764 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 00:16:45,766 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈


# 現在のユーザー入力
User: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\42952e9f-208b-4cd4-8a47-4f0614754bda.csv

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 00:16:45,779 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\n\n\n# 現在のユーザー入力\nUser: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\42952e9f-208b-4cd4-8a47-4f0614754bda.csv\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 00:16:45,817 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 00:16:45,817 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 00:16:46,158 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001411724B8D0>
2025-03-20 00:16:46,159 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000014177F650A0> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 00:16:46,525 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000014114FB1850>
2025-03-20 00:16:46,525 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 00:16:46,526 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 00:16:46,526 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 00:16:46,528 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 00:16:46,528 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 00:16:49,493 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1258'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'213e8a4d-c7a2-4916-a94d-d0a96951866a'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'999'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'96835'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'2724'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'2783'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'e5909185-7a1b-4b03-8e3f-6a66b3e8ca87'), (b'ms-azureml-model-time', b'2781'), (b'x-ms-client-request-id', b'213e8a4d-c7a2-4916-a94d-d0a96951866a'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 15:16:48 GMT')])
2025-03-20 00:16:49,495 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 00:16:49,497 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 00:16:49,497 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 00:16:49,497 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 00:16:49,497 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 00:16:49,497 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1258', 'content-type': 'application/json', 'apim-request-id': '213e8a4d-c7a2-4916-a94d-d0a96951866a', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '999', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '96835', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '2724', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '2783', 'x-ms-rai-invoked': 'true', 'x-request-id': 'e5909185-7a1b-4b03-8e3f-6a66b3e8ca87', 'ms-azureml-model-time': '2781', 'x-ms-client-request-id': '213e8a4d-c7a2-4916-a94d-d0a96951866a', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 15:16:48 GMT'})
2025-03-20 00:16:49,499 - openai._base_client - DEBUG - request_id: e5909185-7a1b-4b03-8e3f-6a66b3e8ca87
2025-03-20 00:16:49,503 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'file_upload', 'file_type': 'csv'}
2025-03-20 00:16:49,503 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\42952e9f-208b-4cd4-8a47-4f0614754bda.csv
2025-03-20 00:16:49,620 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('アップロードされたファイルは以下のファイルの一つと推定する：\n支給控除等一覧(データ更新)-支給・控除等一覧表\n支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表\n支給控除等一覧(後処理)-更新された支給・控除等一覧表\n支給控除等一覧(後処理)-削除リスト\n支給控除等一覧(後処理)-漢字変換リスト\nYonosukeデータ作成(加算処理)-給与明細データ\nYonosukeデータ作成(加算処理)-前月Yonosukeデータ\nYonosukeデータ作成(加算処理)-賞与データ\nYonosukeデータ作成(データ除去)-今月Yonosukeデータ\nYonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト', ''), type: <class 'tuple'>
2025-03-20 00:16:49,620 - application.services.payroll_service - DEBUG - Standardized response: (アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト, )
2025-03-20 00:16:49,622 - payroll_api - DEBUG - Payroll service processed message: アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト
2025-03-20 00:16:49,626 - payroll_api - INFO - File uploaded successfully: sikyu_csv_sample.csv with 490 rows
2025-03-20 00:16:49,629 - payroll_api - DEBUG - Cleaned up temporary file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\42952e9f-208b-4cd4-8a47-4f0614754bda.csv
2025-03-20 00:17:10,292 - application.services.session_service - INFO - Created new session: b278d456-6cc6-411d-a19e-0c8f8475538f
2025-03-20 00:17:10,293 - payroll_api - INFO - Created new session: b278d456-6cc6-411d-a19e-0c8f8475538f
2025-03-20 00:17:10,308 - payroll_api - INFO - Files list requested by user admin for session b278d456-6cc6-411d-a19e-0c8f8475538f
2025-03-20 00:17:10,308 - application.services.file_service - INFO - Getting list of all files
2025-03-20 00:17:10,309 - application.services.file_service - ERROR - Error getting file list: 'FileService' object has no attribute 'ensure_database_ready'
2025-03-20 00:17:10,309 - application.services.file_service - ERROR - Detailed traceback:
Traceback (most recent call last):
  File "C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\file_service.py", line 240, in get_file_list
    db_ready = self.ensure_database_ready()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'FileService' object has no attribute 'ensure_database_ready'
2025-03-20 00:17:10,330 - payroll_api - DEBUG - Raw files from file_service: []
2025-03-20 00:17:10,330 - payroll_api - DEBUG - Adapted files for frontend: []
2025-03-20 00:19:52,799 - payroll_api - INFO - API shutting down
2025-03-20 00:19:52,799 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:19:52,801 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:19:52,807 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:20:42,518 - payroll_api - INFO - Service modules imported successfully
2025-03-20 00:20:42,533 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:20:42,567 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:20:42,576 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:20:42,577 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 00:20:42,577 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 00:20:42,579 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 00:20:42,579 - payroll_api - INFO - FileService initialized successfully
2025-03-20 00:20:42,579 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:20:42,579 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 00:20:42,579 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:20:42,580 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:20:42,581 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 00:20:42,584 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:20:42,584 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 00:20:44,841 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:20:44,843 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 00:20:44,844 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 00:20:44,844 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 00:20:44,844 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 00:20:52,101 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 00:20:52,101 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 00:20:52,104 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 00:20:52,375 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:20:52,544 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 00:20:52,734 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 00:20:52,904 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:20:53,166 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 00:20:53,350 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 00:20:53,523 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 00:20:54,035 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 00:20:54,261 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 00:20:54,444 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 00:20:54,446 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 00:20:54,469 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 00:20:54,469 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 00:20:54,469 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 00:20:54,471 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 00:20:54,471 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 00:20:54,491 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 00:20:54,492 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 00:20:54,513 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 00:20:54,520 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 00:20:54,522 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 00:20:54,528 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 00:20:54,544 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 00:20:54,785 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 00:20:54,801 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 00:20:54,803 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 00:20:54,803 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 00:20:54,803 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 00:20:54,804 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 00:20:54,804 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 00:20:54,804 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 00:20:54,823 - application.services.session_service - INFO - Loaded 10 sessions from disk
2025-03-20 00:20:54,823 - application.services.session_service - INFO - SessionService initialized with 10 sessions
2025-03-20 00:20:54,824 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 00:20:55,008 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:20:55,010 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:20:55,010 - payroll_api - INFO - Admin password from env: password
2025-03-20 00:20:55,010 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 00:20:55,010 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 00:20:55,011 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:20:55,012 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 00:20:55,012 - payroll_api - INFO - Initializing authentication
2025-03-20 00:20:55,012 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 00:20:55,012 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 00:24:49,440 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:24:49,441 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-20 00:24:49,441 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-20 00:24:49,441 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:24:49,441 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:24:49,442 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-20 00:24:49,442 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-20 00:24:49,442 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:24:49,443 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:24:49,443 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-20 00:24:49,443 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-20 00:24:49,443 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:24:49,445 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 00:24:49,446 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-20 00:24:49,447 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:24:49,447 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:24:49,448 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-20 00:24:49,449 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-20 00:24:49,814 - payroll_api - DEBUG - Authentication result: True
2025-03-20 00:25:16,696 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:25:16,697 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-20 00:25:16,697 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-20 00:25:16,697 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:25:16,698 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-20 00:25:16,698 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-20 00:25:16,699 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:25:16,699 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:25:16,700 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:81920]
2025-03-20 00:25:16,702 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:98304]
2025-03-20 00:25:16,703 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:22317]
2025-03-20 00:25:16,703 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:25:16,703 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:25:16,704 - python_multipart.multipart - DEBUG - Calling on_header_field with data[22361:22380]
2025-03-20 00:25:16,704 - python_multipart.multipart - DEBUG - Calling on_header_value with data[22382:22409]
2025-03-20 00:25:16,705 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:25:16,705 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:25:16,707 - python_multipart.multipart - DEBUG - Calling on_part_data with data[22413:22419]
2025-03-20 00:25:16,707 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:25:16,708 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:25:16,708 - python_multipart.multipart - DEBUG - Calling on_header_field with data[22463:22482]
2025-03-20 00:25:16,709 - python_multipart.multipart - DEBUG - Calling on_header_value with data[22484:22511]
2025-03-20 00:25:16,709 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:25:16,710 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:25:16,710 - python_multipart.multipart - DEBUG - Calling on_part_data with data[22515:22521]
2025-03-20 00:25:16,711 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:25:16,711 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 00:25:16,714 - application.services.session_service - INFO - Created new session: 2af21bf7-e414-43b1-94c9-cb79584f755f
2025-03-20 00:25:16,714 - payroll_api - INFO - Created new session: 2af21bf7-e414-43b1-94c9-cb79584f755f
2025-03-20 00:25:16,717 - payroll_api - INFO - File upload request from user admin, session 2af21bf7-e414-43b1-94c9-cb79584f755f: sikyu_csv_sample.csv
2025-03-20 00:25:16,719 - payroll_api - DEBUG - File saved to: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35b97c57-bb12-470c-b5cf-39eb032e77fd.csv
2025-03-20 00:25:16,761 - payroll_api - INFO - Successfully read file with 490 rows
2025-03-20 00:25:16,762 - application.modules.file_agent - INFO - store_csv_file開始: uploaded_e8e2b5a7-4aa0-4756-8f51-3b00468fd1c3, definition=Uploaded STRING file, task_name=string, rows=490
2025-03-20 00:25:16,764 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:25:16,768 - application.modules.file_agent - DEBUG - DataFrame info: {'columns': ['Unnamed: 0.1', 'Unnamed: 0', '従業員名', 'スタッフコード', 'グループ名', '給与規定グループ', '基本給', '基本給調整', '非課税通勤手当', '課税通勤手当', '通勤費調整（非）', '通勤費調整（課）', '自宅駐車場手当', '自宅駐車場手当調整', 'WFH 手当', 'WFH 手当調整', '単身赴任手当', '帰郷旅費手当', '赴任手当(課税)', '赴任手当(非課税)', '調整手当', '調整手当精算', '育児費用補助', '慶弔金', 'その他支給(課税）', 'その他支給(非課税）', 'Recognitionポイント', 'Recognition ポイント 所得税', 'その他報奨', 'その他報奨 所得税', '永年勤続', '交代勤務手当', '連操手当', '所定内残業手当', '普通残業手当', '深夜残業手当', '法定外休日残業手当', '法定休日残業手当', '60時間超手当', '時間外手当遡及', '代休控除', '遅刻早退欠勤控除', '経費', '支給合計', '課税支給合計', '非課税支給合計', '健康保険料', '健康保険料\u3000本人負担（翌月分）', '介護保険料', '介護保険料\u3000本人負担（翌月分）', '厚生年金保険料', '厚年保険料\u3000本人負担（翌月分）', '社会保険料調整\u3000本人負担', '雇用保険料', '社会保険料合計', 'DC加入者掛金', '所得税', '2024減税額', '2024減税後所得税', '住民税', '扶養是正', '還付徴収額（年調）', 'Recognition ポイント控除', '現物支給控除', '社用車プライベート使用料', '社宅費', '組合費', '給食費', '差押', '生保日本生命', '生保第一生命', '生保アフラック', '生保大樹', '積立貯蓄', '財形労金', 'その他控除', '控除合計', '差引支給額', '銀行振込１', '銀行振込２', '健保事業主負担', '介護事業主負担', '厚年事業主負担', '子育拠出金', '雇保事業主負担', '労災保険料', '一般拠出金', '確定拠出企業年金', 'キャッシュバランス', '出勤日数', '出勤時間', '所定内残業', '普通残業', '深夜残業', '法定外休日残業', '法定休日残業', '60時間超', '代休控除日数', '欠勤控除時間', '遅刻早退欠勤控除時間', '当月所定労働時間', '備考'], 'dtypes': {'Unnamed: 0.1': 'int64', 'Unnamed: 0': 'int64', '従業員名': 'float64', 'スタッフコード': 'int64', 'グループ名': 'float64', '給与規定グループ': 'object', '基本給': 'int64', '基本給調整': 'int64', '非課税通勤手当': 'int64', '課税通勤手当': 'int64', '通勤費調整（非）': 'int64', '通勤費調整（課）': 'int64', '自宅駐車場手当': 'int64', '自宅駐車場手当調整': 'int64', 'WFH 手当': 'int64', 'WFH 手当調整': 'int64', '単身赴任手当': 'int64', '帰郷旅費手当': 'int64', '赴任手当(課税)': 'int64', '赴任手当(非課税)': 'int64', '調整手当': 'int64', '調整手当精算': 'int64', '育児費用補助': 'int64', '慶弔金': 'int64', 'その他支給(課税）': 'int64', 'その他支給(非課税）': 'int64', 'Recognitionポイント': 'int64', 'Recognition ポイント 所得税': 'int64', 'その他報奨': 'int64', 'その他報奨 所得税': 'int64', '永年勤続': 'int64', '交代勤務手当': 'int64', '連操手当': 'int64', '所定内残業手当': 'int64', '普通残業手当': 'int64', '深夜残業手当': 'int64', '法定外休日残業手当': 'int64', '法定休日残業手当': 'int64', '60時間超手当': 'int64', '時間外手当遡及': 'int64', '代休控除': 'int64', '遅刻早退欠勤控除': 'int64', '経費': 'int64', '支給合計': 'int64', '課税支給合計': 'int64', '非課税支給合計': 'int64', '健康保険料': 'int64', '健康保険料\u3000本人負担（翌月分）': 'int64', '介護保険料': 'int64', '介護保険料\u3000本人負担（翌月分）': 'int64', '厚生年金保険料': 'int64', '厚年保険料\u3000本人負担（翌月分）': 'int64', '社会保険料調整\u3000本人負担': 'int64', '雇用保険料': 'int64', '社会保険料合計': 'int64', 'DC加入者掛金': 'int64', '所得税': 'int64', '2024減税額': 'int64', '2024減税後所得税': 'int64', '住民税': 'int64', '扶養是正': 'int64', '還付徴収額（年調）': 'int64', 'Recognition ポイント控除': 'int64', '現物支給控除': 'int64', '社用車プライベート使用料': 'int64', '社宅費': 'int64', '組合費': 'int64', '給食費': 'int64', '差押': 'int64', '生保日本生命': 'int64', '生保第一生命': 'int64', '生保アフラック': 'int64', '生保大樹': 'int64', '積立貯蓄': 'int64', '財形労金': 'int64', 'その他控除': 'int64', '控除合計': 'int64', '差引支給額': 'int64', '銀行振込１': 'int64', '銀行振込２': 'int64', '健保事業主負担': 'int64', '介護事業主負担': 'int64', '厚年事業主負担': 'int64', '子育拠出金': 'float64', '雇保事業主負担': 'float64', '労災保険料': 'float64', '一般拠出金': 'float64', '確定拠出企業年金': 'int64', 'キャッシュバランス': 'int64', '出勤日数': 'float64', '出勤時間': 'object', '所定内残業': 'object', '普通残業': 'object', '深夜残業': 'object', '法定外休日残業': 'object', '法定休日残業': 'object', '60時間超': 'object', '代休控除日数': 'float64', '欠勤控除時間': 'object', '遅刻早退欠勤控除時間': 'object', '当月所定労働時間': 'object', '備考': 'float64'}, 'has_nulls': {'Unnamed: 0.1': False, 'Unnamed: 0': False, '従業員名': True, 'スタッフコード': False, 'グループ名': False, '給与規定グループ': False, '基本給': False, '基本給調整': False, '非課税通勤手当': False, '課税通勤手当': False, '通勤費調整（非）': False, '通勤費調整（課）': False, '自宅駐車場手当': False, '自宅駐車場手当調整': False, 'WFH 手当': False, 'WFH 手当調整': False, '単身赴任手当': False, '帰郷旅費手当': False, '赴任手当(課税)': False, '赴任手当(非課税)': False, '調整手当': False, '調整手当精算': False, '育児費用補助': False, '慶弔金': False, 'その他支給(課税）': False, 'その他支給(非課税）': False, 'Recognitionポイント': False, 'Recognition ポイント 所得税': False, 'その他報奨': False, 'その他報奨 所得税': False, '永年勤続': False, '交代勤務手当': False, '連操手当': False, '所定内残業手当': False, '普通残業手当': False, '深夜残業手当': False, '法定外休日残業手当': False, '法定休日残業手当': False, '60時間超手当': False, '時間外手当遡及': False, '代休控除': False, '遅刻早退欠勤控除': False, '経費': False, '支給合計': False, '課税支給合計': False, '非課税支給合計': False, '健康保険料': False, '健康保険料\u3000本人負担（翌月分）': False, '介護保険料': False, '介護保険料\u3000本人負担（翌月分）': False, '厚生年金保険料': False, '厚年保険料\u3000本人負担（翌月分）': False, '社会保険料調整\u3000本人負担': False, '雇用保険料': False, '社会保険料合計': False, 'DC加入者掛金': False, '所得税': False, '2024減税額': False, '2024減税後所得税': False, '住民税': False, '扶養是正': False, '還付徴収額（年調）': False, 'Recognition ポイント控除': False, '現物支給控除': False, '社用車プライベート使用料': False, '社宅費': False, '組合費': False, '給食費': False, '差押': False, '生保日本生命': False, '生保第一生命': False, '生保アフラック': False, '生保大樹': False, '積立貯蓄': False, '財形労金': False, 'その他控除': False, '控除合計': False, '差引支給額': False, '銀行振込１': False, '銀行振込２': False, '健保事業主負担': False, '介護事業主負担': False, '厚年事業主負担': False, '子育拠出金': False, '雇保事業主負担': False, '労災保険料': False, '一般拠出金': False, '確定拠出企業年金': False, 'キャッシュバランス': False, '出勤日数': False, '出勤時間': False, '所定内残業': False, '普通残業': False, '深夜残業': False, '法定外休日残業': False, '法定休日残業': False, '60時間超': False, '代休控除日数': False, '欠勤控除時間': False, '遅刻早退欠勤控除時間': False, '当月所定労働時間': False, '備考': True}}
2025-03-20 00:25:16,781 - application.modules.file_agent - DEBUG - DataFile record created with ID: 1
2025-03-20 00:25:16,979 - application.modules.file_agent - DEBUG - Saved chunk 1 with 490 records
2025-03-20 00:25:16,996 - application.modules.file_agent - INFO - ファイルを保存しました。DataFile ID=1, 490 行, 1 chunks
2025-03-20 00:25:16,998 - payroll_api - INFO - File successfully stored in database with ID: 1
2025-03-20 00:25:16,998 - application.services.payroll_service - INFO - Processing message: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35b97c57-bb12-470c-b5cf-39eb032e77fd.csv
2025-03-20 00:25:16,998 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 00:25:17,000 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈


# 現在のユーザー入力
User: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35b97c57-bb12-470c-b5cf-39eb032e77fd.csv

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 00:25:17,010 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\n\n\n# 現在のユーザー入力\nUser: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\35b97c57-bb12-470c-b5cf-39eb032e77fd.csv\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 00:25:17,029 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 00:25:17,030 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 00:25:17,366 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002050B3EBD10>
2025-03-20 00:25:17,366 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002056C244F80> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 00:25:17,760 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002056A840050>
2025-03-20 00:25:17,760 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 00:25:17,761 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 00:25:17,761 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 00:25:17,762 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 00:25:17,762 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 00:25:18,286 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1258'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'80f3e13a-b9bb-48e0-90eb-d5e0a83d2629'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'999'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'96835'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'285'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'336'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'12f6b30b-8341-4262-a718-a39d6b8b267a'), (b'ms-azureml-model-time', b'333'), (b'x-ms-client-request-id', b'80f3e13a-b9bb-48e0-90eb-d5e0a83d2629'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 15:25:17 GMT')])
2025-03-20 00:25:18,289 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 00:25:18,289 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 00:25:18,290 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 00:25:18,290 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 00:25:18,290 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 00:25:18,291 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1258', 'content-type': 'application/json', 'apim-request-id': '80f3e13a-b9bb-48e0-90eb-d5e0a83d2629', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '999', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '96835', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '285', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '336', 'x-ms-rai-invoked': 'true', 'x-request-id': '12f6b30b-8341-4262-a718-a39d6b8b267a', 'ms-azureml-model-time': '333', 'x-ms-client-request-id': '80f3e13a-b9bb-48e0-90eb-d5e0a83d2629', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 15:25:17 GMT'})
2025-03-20 00:25:18,292 - openai._base_client - DEBUG - request_id: 12f6b30b-8341-4262-a718-a39d6b8b267a
2025-03-20 00:25:18,298 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'file_upload', 'file_type': 'csv'}
2025-03-20 00:25:18,298 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35b97c57-bb12-470c-b5cf-39eb032e77fd.csv
2025-03-20 00:25:18,437 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('アップロードされたファイルは以下のファイルの一つと推定する：\n支給控除等一覧(データ更新)-支給・控除等一覧表\n支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表\n支給控除等一覧(後処理)-更新された支給・控除等一覧表\n支給控除等一覧(後処理)-削除リスト\n支給控除等一覧(後処理)-漢字変換リスト\nYonosukeデータ作成(加算処理)-給与明細データ\nYonosukeデータ作成(加算処理)-前月Yonosukeデータ\nYonosukeデータ作成(加算処理)-賞与データ\nYonosukeデータ作成(データ除去)-今月Yonosukeデータ\nYonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト', ''), type: <class 'tuple'>
2025-03-20 00:25:18,437 - application.services.payroll_service - DEBUG - Standardized response: (アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト, )
2025-03-20 00:25:18,439 - payroll_api - DEBUG - Payroll service processed message: アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト
2025-03-20 00:25:18,445 - payroll_api - INFO - File uploaded successfully: sikyu_csv_sample.csv with 490 rows
2025-03-20 00:25:18,449 - payroll_api - DEBUG - Cleaned up temporary file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\35b97c57-bb12-470c-b5cf-39eb032e77fd.csv
2025-03-20 00:25:28,836 - application.services.session_service - INFO - Created new session: bc2d58e0-af27-4914-8273-183890fa84ac
2025-03-20 00:25:28,836 - payroll_api - INFO - Created new session: bc2d58e0-af27-4914-8273-183890fa84ac
2025-03-20 00:25:28,838 - payroll_api - INFO - Files list requested by user admin for session bc2d58e0-af27-4914-8273-183890fa84ac
2025-03-20 00:25:28,838 - application.services.file_service - INFO - Getting list of all files
2025-03-20 00:25:28,839 - application.services.file_service - ERROR - Error getting file list: 'FileService' object has no attribute 'ensure_database_ready'
2025-03-20 00:25:28,839 - application.services.file_service - ERROR - Detailed traceback:
Traceback (most recent call last):
  File "C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\file_service.py", line 240, in get_file_list
    db_ready = self.ensure_database_ready()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'FileService' object has no attribute 'ensure_database_ready'
2025-03-20 00:25:28,842 - payroll_api - DEBUG - Raw files from file_service: []
2025-03-20 00:25:28,842 - payroll_api - DEBUG - Adapted files for frontend: []
2025-03-20 00:29:50,715 - payroll_api - INFO - API shutting down
2025-03-20 00:29:50,719 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:29:50,724 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:29:50,742 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:29:56,751 - payroll_api - INFO - Service modules imported successfully
2025-03-20 00:29:56,775 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:29:56,815 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:29:56,825 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:29:56,827 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 00:29:56,827 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 00:29:56,828 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 00:29:56,828 - payroll_api - INFO - FileService initialized successfully
2025-03-20 00:29:56,828 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:29:56,830 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 00:29:56,830 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 00:29:56,831 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:29:56,832 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 00:29:56,835 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 00:29:56,835 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 00:29:58,908 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 00:29:58,912 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 00:29:58,912 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 00:29:58,912 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 00:29:58,912 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 00:30:06,832 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 00:30:06,832 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 00:30:06,837 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 00:30:07,050 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:30:07,242 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 00:30:07,408 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 00:30:07,593 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 00:30:07,763 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 00:30:07,934 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 00:30:08,105 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 00:30:08,643 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 00:30:08,854 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 00:30:09,027 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 00:30:09,029 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 00:30:09,053 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 00:30:09,053 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 00:30:09,053 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 00:30:09,056 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 00:30:09,056 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 00:30:09,077 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 00:30:09,077 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 00:30:09,102 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 00:30:09,112 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 00:30:09,114 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 00:30:09,123 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 00:30:09,141 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 00:30:09,331 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 00:30:09,349 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 00:30:09,351 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 00:30:09,352 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 00:30:09,352 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 00:30:09,352 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 00:30:09,353 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 00:30:09,353 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 00:30:09,357 - application.services.session_service - INFO - Loaded 12 sessions from disk
2025-03-20 00:30:09,357 - application.services.session_service - INFO - SessionService initialized with 12 sessions
2025-03-20 00:30:09,357 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 00:30:09,549 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:30:09,549 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:30:09,550 - payroll_api - INFO - Admin password from env: password
2025-03-20 00:30:09,550 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 00:30:09,550 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 00:30:09,551 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:30:09,551 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 00:30:09,552 - payroll_api - INFO - Initializing authentication
2025-03-20 00:30:09,552 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 00:30:09,552 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 00:30:27,810 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:30:27,810 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:10]
2025-03-20 00:30:27,810 - python_multipart.multipart - DEBUG - Calling on_field_data with data[11:19]
2025-03-20 00:30:27,810 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:30:27,812 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:30:27,812 - python_multipart.multipart - DEBUG - Calling on_field_name with data[20:28]
2025-03-20 00:30:27,812 - python_multipart.multipart - DEBUG - Calling on_field_data with data[29:34]
2025-03-20 00:30:27,812 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:30:27,812 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:30:27,812 - python_multipart.multipart - DEBUG - Calling on_field_name with data[35:43]
2025-03-20 00:30:27,813 - python_multipart.multipart - DEBUG - Calling on_field_data with data[44:52]
2025-03-20 00:30:27,813 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:30:27,813 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 00:30:27,816 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-20 00:30:27,816 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:30:27,817 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:30:27,817 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-20 00:30:27,818 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-20 00:30:28,117 - payroll_api - DEBUG - Authentication result: True
2025-03-20 00:30:42,780 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:30:42,781 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-20 00:30:42,781 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-20 00:30:42,781 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:30:42,781 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-20 00:30:42,782 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-20 00:30:42,782 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:30:42,782 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:30:42,783 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:131072]
2025-03-20 00:30:42,784 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:71469]
2025-03-20 00:30:42,784 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:30:42,784 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:30:42,786 - python_multipart.multipart - DEBUG - Calling on_header_field with data[71513:71532]
2025-03-20 00:30:42,786 - python_multipart.multipart - DEBUG - Calling on_header_value with data[71534:71561]
2025-03-20 00:30:42,786 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:30:42,787 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:30:42,787 - python_multipart.multipart - DEBUG - Calling on_part_data with data[71565:71571]
2025-03-20 00:30:42,787 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:30:42,788 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:30:42,788 - python_multipart.multipart - DEBUG - Calling on_header_field with data[71615:71634]
2025-03-20 00:30:42,788 - python_multipart.multipart - DEBUG - Calling on_header_value with data[71636:71663]
2025-03-20 00:30:42,790 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:30:42,790 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:30:42,790 - python_multipart.multipart - DEBUG - Calling on_part_data with data[71667:71673]
2025-03-20 00:30:42,790 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:30:42,790 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 00:30:42,793 - application.services.session_service - INFO - Created new session: 70c84bc0-a774-47a4-8f5c-cc10c9920c69
2025-03-20 00:30:42,793 - payroll_api - INFO - Created new session: 70c84bc0-a774-47a4-8f5c-cc10c9920c69
2025-03-20 00:30:42,794 - payroll_api - INFO - File upload request from user admin, session 70c84bc0-a774-47a4-8f5c-cc10c9920c69: sikyu_csv_sample.csv
2025-03-20 00:30:42,795 - payroll_api - DEBUG - File saved to: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\f1b5d985-d187-47fe-9e97-fa5948dab836.csv
2025-03-20 00:30:42,826 - payroll_api - INFO - Successfully read file with 490 rows
2025-03-20 00:30:42,826 - application.modules.file_agent - INFO - store_csv_file開始: uploaded_c035b64b-29c1-4e04-9361-77564bfe7351, definition=Uploaded STRING file, task_name=string, rows=490
2025-03-20 00:30:42,827 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 00:30:42,829 - application.modules.file_agent - DEBUG - DataFrame info: {'columns': ['Unnamed: 0.1', 'Unnamed: 0', '従業員名', 'スタッフコード', 'グループ名', '給与規定グループ', '基本給', '基本給調整', '非課税通勤手当', '課税通勤手当', '通勤費調整（非）', '通勤費調整（課）', '自宅駐車場手当', '自宅駐車場手当調整', 'WFH 手当', 'WFH 手当調整', '単身赴任手当', '帰郷旅費手当', '赴任手当(課税)', '赴任手当(非課税)', '調整手当', '調整手当精算', '育児費用補助', '慶弔金', 'その他支給(課税）', 'その他支給(非課税）', 'Recognitionポイント', 'Recognition ポイント 所得税', 'その他報奨', 'その他報奨 所得税', '永年勤続', '交代勤務手当', '連操手当', '所定内残業手当', '普通残業手当', '深夜残業手当', '法定外休日残業手当', '法定休日残業手当', '60時間超手当', '時間外手当遡及', '代休控除', '遅刻早退欠勤控除', '経費', '支給合計', '課税支給合計', '非課税支給合計', '健康保険料', '健康保険料\u3000本人負担（翌月分）', '介護保険料', '介護保険料\u3000本人負担（翌月分）', '厚生年金保険料', '厚年保険料\u3000本人負担（翌月分）', '社会保険料調整\u3000本人負担', '雇用保険料', '社会保険料合計', 'DC加入者掛金', '所得税', '2024減税額', '2024減税後所得税', '住民税', '扶養是正', '還付徴収額（年調）', 'Recognition ポイント控除', '現物支給控除', '社用車プライベート使用料', '社宅費', '組合費', '給食費', '差押', '生保日本生命', '生保第一生命', '生保アフラック', '生保大樹', '積立貯蓄', '財形労金', 'その他控除', '控除合計', '差引支給額', '銀行振込１', '銀行振込２', '健保事業主負担', '介護事業主負担', '厚年事業主負担', '子育拠出金', '雇保事業主負担', '労災保険料', '一般拠出金', '確定拠出企業年金', 'キャッシュバランス', '出勤日数', '出勤時間', '所定内残業', '普通残業', '深夜残業', '法定外休日残業', '法定休日残業', '60時間超', '代休控除日数', '欠勤控除時間', '遅刻早退欠勤控除時間', '当月所定労働時間', '備考'], 'dtypes': {'Unnamed: 0.1': 'int64', 'Unnamed: 0': 'int64', '従業員名': 'float64', 'スタッフコード': 'int64', 'グループ名': 'float64', '給与規定グループ': 'object', '基本給': 'int64', '基本給調整': 'int64', '非課税通勤手当': 'int64', '課税通勤手当': 'int64', '通勤費調整（非）': 'int64', '通勤費調整（課）': 'int64', '自宅駐車場手当': 'int64', '自宅駐車場手当調整': 'int64', 'WFH 手当': 'int64', 'WFH 手当調整': 'int64', '単身赴任手当': 'int64', '帰郷旅費手当': 'int64', '赴任手当(課税)': 'int64', '赴任手当(非課税)': 'int64', '調整手当': 'int64', '調整手当精算': 'int64', '育児費用補助': 'int64', '慶弔金': 'int64', 'その他支給(課税）': 'int64', 'その他支給(非課税）': 'int64', 'Recognitionポイント': 'int64', 'Recognition ポイント 所得税': 'int64', 'その他報奨': 'int64', 'その他報奨 所得税': 'int64', '永年勤続': 'int64', '交代勤務手当': 'int64', '連操手当': 'int64', '所定内残業手当': 'int64', '普通残業手当': 'int64', '深夜残業手当': 'int64', '法定外休日残業手当': 'int64', '法定休日残業手当': 'int64', '60時間超手当': 'int64', '時間外手当遡及': 'int64', '代休控除': 'int64', '遅刻早退欠勤控除': 'int64', '経費': 'int64', '支給合計': 'int64', '課税支給合計': 'int64', '非課税支給合計': 'int64', '健康保険料': 'int64', '健康保険料\u3000本人負担（翌月分）': 'int64', '介護保険料': 'int64', '介護保険料\u3000本人負担（翌月分）': 'int64', '厚生年金保険料': 'int64', '厚年保険料\u3000本人負担（翌月分）': 'int64', '社会保険料調整\u3000本人負担': 'int64', '雇用保険料': 'int64', '社会保険料合計': 'int64', 'DC加入者掛金': 'int64', '所得税': 'int64', '2024減税額': 'int64', '2024減税後所得税': 'int64', '住民税': 'int64', '扶養是正': 'int64', '還付徴収額（年調）': 'int64', 'Recognition ポイント控除': 'int64', '現物支給控除': 'int64', '社用車プライベート使用料': 'int64', '社宅費': 'int64', '組合費': 'int64', '給食費': 'int64', '差押': 'int64', '生保日本生命': 'int64', '生保第一生命': 'int64', '生保アフラック': 'int64', '生保大樹': 'int64', '積立貯蓄': 'int64', '財形労金': 'int64', 'その他控除': 'int64', '控除合計': 'int64', '差引支給額': 'int64', '銀行振込１': 'int64', '銀行振込２': 'int64', '健保事業主負担': 'int64', '介護事業主負担': 'int64', '厚年事業主負担': 'int64', '子育拠出金': 'float64', '雇保事業主負担': 'float64', '労災保険料': 'float64', '一般拠出金': 'float64', '確定拠出企業年金': 'int64', 'キャッシュバランス': 'int64', '出勤日数': 'float64', '出勤時間': 'object', '所定内残業': 'object', '普通残業': 'object', '深夜残業': 'object', '法定外休日残業': 'object', '法定休日残業': 'object', '60時間超': 'object', '代休控除日数': 'float64', '欠勤控除時間': 'object', '遅刻早退欠勤控除時間': 'object', '当月所定労働時間': 'object', '備考': 'float64'}, 'has_nulls': {'Unnamed: 0.1': False, 'Unnamed: 0': False, '従業員名': True, 'スタッフコード': False, 'グループ名': False, '給与規定グループ': False, '基本給': False, '基本給調整': False, '非課税通勤手当': False, '課税通勤手当': False, '通勤費調整（非）': False, '通勤費調整（課）': False, '自宅駐車場手当': False, '自宅駐車場手当調整': False, 'WFH 手当': False, 'WFH 手当調整': False, '単身赴任手当': False, '帰郷旅費手当': False, '赴任手当(課税)': False, '赴任手当(非課税)': False, '調整手当': False, '調整手当精算': False, '育児費用補助': False, '慶弔金': False, 'その他支給(課税）': False, 'その他支給(非課税）': False, 'Recognitionポイント': False, 'Recognition ポイント 所得税': False, 'その他報奨': False, 'その他報奨 所得税': False, '永年勤続': False, '交代勤務手当': False, '連操手当': False, '所定内残業手当': False, '普通残業手当': False, '深夜残業手当': False, '法定外休日残業手当': False, '法定休日残業手当': False, '60時間超手当': False, '時間外手当遡及': False, '代休控除': False, '遅刻早退欠勤控除': False, '経費': False, '支給合計': False, '課税支給合計': False, '非課税支給合計': False, '健康保険料': False, '健康保険料\u3000本人負担（翌月分）': False, '介護保険料': False, '介護保険料\u3000本人負担（翌月分）': False, '厚生年金保険料': False, '厚年保険料\u3000本人負担（翌月分）': False, '社会保険料調整\u3000本人負担': False, '雇用保険料': False, '社会保険料合計': False, 'DC加入者掛金': False, '所得税': False, '2024減税額': False, '2024減税後所得税': False, '住民税': False, '扶養是正': False, '還付徴収額（年調）': False, 'Recognition ポイント控除': False, '現物支給控除': False, '社用車プライベート使用料': False, '社宅費': False, '組合費': False, '給食費': False, '差押': False, '生保日本生命': False, '生保第一生命': False, '生保アフラック': False, '生保大樹': False, '積立貯蓄': False, '財形労金': False, 'その他控除': False, '控除合計': False, '差引支給額': False, '銀行振込１': False, '銀行振込２': False, '健保事業主負担': False, '介護事業主負担': False, '厚年事業主負担': False, '子育拠出金': False, '雇保事業主負担': False, '労災保険料': False, '一般拠出金': False, '確定拠出企業年金': False, 'キャッシュバランス': False, '出勤日数': False, '出勤時間': False, '所定内残業': False, '普通残業': False, '深夜残業': False, '法定外休日残業': False, '法定休日残業': False, '60時間超': False, '代休控除日数': False, '欠勤控除時間': False, '遅刻早退欠勤控除時間': False, '当月所定労働時間': False, '備考': True}}
2025-03-20 00:30:42,840 - application.modules.file_agent - DEBUG - DataFile record created with ID: 1
2025-03-20 00:30:43,048 - application.modules.file_agent - DEBUG - Saved chunk 1 with 490 records
2025-03-20 00:30:43,068 - application.modules.file_agent - INFO - ファイルを保存しました。DataFile ID=1, 490 行, 1 chunks
2025-03-20 00:30:43,070 - payroll_api - INFO - File successfully stored in database with ID: 1
2025-03-20 00:30:43,070 - application.services.payroll_service - INFO - Processing message: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\f1b5d985-d187-47fe-9e97-fa5948dab836.csv
2025-03-20 00:30:43,072 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 00:30:43,072 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈


# 現在のユーザー入力
User: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\f1b5d985-d187-47fe-9e97-fa5948dab836.csv

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 00:30:43,084 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\n\n\n# 現在のユーザー入力\nUser: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\f1b5d985-d187-47fe-9e97-fa5948dab836.csv\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 00:30:43,110 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 00:30:43,111 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 00:30:43,439 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000146989E7210>
2025-03-20 00:30:43,446 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000146F9774F80> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 00:30:43,812 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000146989E6A50>
2025-03-20 00:30:43,813 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 00:30:43,814 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 00:30:43,814 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 00:30:43,815 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 00:30:43,815 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 00:30:44,475 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1258'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'61ff54a7-0c79-415b-bd3d-3850bb7ca9fb'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'999'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'96835'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'354'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-02'), (b'x-envoy-upstream-service-time', b'400'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'7bd0b4ed-a8b2-4a99-89a8-2fadd7a3c626'), (b'ms-azureml-model-time', b'397'), (b'x-ms-client-request-id', b'61ff54a7-0c79-415b-bd3d-3850bb7ca9fb'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 15:30:44 GMT')])
2025-03-20 00:30:44,477 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 00:30:44,478 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 00:30:44,478 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 00:30:44,478 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 00:30:44,479 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 00:30:44,479 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1258', 'content-type': 'application/json', 'apim-request-id': '61ff54a7-0c79-415b-bd3d-3850bb7ca9fb', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '999', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '96835', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '354', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-02', 'x-envoy-upstream-service-time': '400', 'x-ms-rai-invoked': 'true', 'x-request-id': '7bd0b4ed-a8b2-4a99-89a8-2fadd7a3c626', 'ms-azureml-model-time': '397', 'x-ms-client-request-id': '61ff54a7-0c79-415b-bd3d-3850bb7ca9fb', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 15:30:44 GMT'})
2025-03-20 00:30:44,480 - openai._base_client - DEBUG - request_id: 7bd0b4ed-a8b2-4a99-89a8-2fadd7a3c626
2025-03-20 00:30:44,487 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'file_upload', 'file_type': 'csv'}
2025-03-20 00:30:44,488 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\f1b5d985-d187-47fe-9e97-fa5948dab836.csv
2025-03-20 00:30:44,614 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('アップロードされたファイルは以下のファイルの一つと推定する：\n支給控除等一覧(データ更新)-支給・控除等一覧表\n支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表\n支給控除等一覧(後処理)-更新された支給・控除等一覧表\n支給控除等一覧(後処理)-削除リスト\n支給控除等一覧(後処理)-漢字変換リスト\nYonosukeデータ作成(加算処理)-給与明細データ\nYonosukeデータ作成(加算処理)-前月Yonosukeデータ\nYonosukeデータ作成(加算処理)-賞与データ\nYonosukeデータ作成(データ除去)-今月Yonosukeデータ\nYonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト', ''), type: <class 'tuple'>
2025-03-20 00:30:44,615 - application.services.payroll_service - DEBUG - Standardized response: (アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト, )
2025-03-20 00:30:44,616 - payroll_api - DEBUG - Payroll service processed message: アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト
2025-03-20 00:30:44,621 - payroll_api - INFO - File uploaded successfully: sikyu_csv_sample.csv with 490 rows
2025-03-20 00:30:44,627 - payroll_api - DEBUG - Cleaned up temporary file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\f1b5d985-d187-47fe-9e97-fa5948dab836.csv
2025-03-20 00:30:56,975 - application.services.session_service - INFO - Created new session: 7bcfd542-eeb3-4892-ae84-42e792eb0120
2025-03-20 00:30:56,975 - payroll_api - INFO - Created new session: 7bcfd542-eeb3-4892-ae84-42e792eb0120
2025-03-20 00:30:56,977 - payroll_api - INFO - Files list requested by user admin for session 7bcfd542-eeb3-4892-ae84-42e792eb0120
2025-03-20 00:30:56,978 - application.services.file_service - INFO - Getting list of all files
2025-03-20 00:30:56,978 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 00:30:56,980 - application.modules.file_agent - DEBUG - Database check successful. File count: 1
2025-03-20 00:30:56,981 - application.modules.file_agent - INFO - Retrieved 1 files from database
2025-03-20 00:30:56,981 - application.services.file_service - INFO - Retrieved 1 files from database
2025-03-20 00:30:56,982 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x00000146962BCA90>]
2025-03-20 00:30:56,982 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}
2025-03-20 00:30:56,982 - application.services.file_service - INFO - Returning 1 processed files
2025-03-20 00:30:56,982 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}]
2025-03-20 00:30:56,983 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}]
2025-03-20 00:43:58,034 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:43:58,034 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:8]
2025-03-20 00:43:58,034 - python_multipart.multipart - DEBUG - Calling on_field_data with data[9:14]
2025-03-20 00:43:58,034 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:43:58,035 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 00:43:58,035 - python_multipart.multipart - DEBUG - Calling on_field_name with data[15:23]
2025-03-20 00:43:58,035 - python_multipart.multipart - DEBUG - Calling on_field_data with data[24:32]
2025-03-20 00:43:58,035 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 00:43:58,035 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 00:43:58,037 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-20 00:43:58,037 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 00:43:58,038 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 00:43:58,352 - payroll_api - DEBUG - Authentication result: True
2025-03-20 00:43:58,498 - application.services.session_service - INFO - Created new session: 78c90f5e-c8c9-4cf2-a1fc-ae27ddd7202e
2025-03-20 00:43:58,498 - payroll_api - INFO - Invalid session ID provided, created new session: 78c90f5e-c8c9-4cf2-a1fc-ae27ddd7202e
2025-03-20 00:43:58,500 - payroll_api - INFO - Files list requested by user admin for session 78c90f5e-c8c9-4cf2-a1fc-ae27ddd7202e
2025-03-20 00:43:58,501 - application.services.file_service - INFO - Getting list of all files
2025-03-20 00:43:58,501 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 00:43:58,504 - application.modules.file_agent - DEBUG - Database check successful. File count: 1
2025-03-20 00:43:58,505 - application.modules.file_agent - INFO - Retrieved 1 files from database
2025-03-20 00:43:58,506 - application.services.file_service - INFO - Retrieved 1 files from database
2025-03-20 00:43:58,506 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x00000146988EE290>]
2025-03-20 00:43:58,506 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}
2025-03-20 00:43:58,507 - application.services.file_service - INFO - Returning 1 processed files
2025-03-20 00:43:58,507 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}]
2025-03-20 00:43:58,508 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}]
2025-03-20 00:43:58,514 - application.services.session_service - INFO - Created new session: f0b550be-8572-4b4f-b7ef-d1d7d532c1c9
2025-03-20 00:43:58,514 - payroll_api - INFO - Invalid session ID provided, created new session: f0b550be-8572-4b4f-b7ef-d1d7d532c1c9
2025-03-20 00:43:58,515 - payroll_api - INFO - Task list requested by user admin for session f0b550be-8572-4b4f-b7ef-d1d7d532c1c9
2025-03-20 00:43:58,517 - payroll_api - ERROR - Error getting tasks: 'TaskResponse' object has no attribute 'get'
2025-03-20 00:43:58,524 - application.services.session_service - INFO - Created new session: 2636dca2-6653-4bd6-a83d-74de39de3f4f
2025-03-20 00:43:58,525 - payroll_api - INFO - Invalid session ID provided, created new session: 2636dca2-6653-4bd6-a83d-74de39de3f4f
2025-03-20 00:43:58,526 - payroll_api - INFO - Session history list requested by user admin for session 2636dca2-6653-4bd6-a83d-74de39de3f4f
2025-03-20 00:43:58,532 - application.services.session_service - INFO - Created new session: f625da74-3df1-4db3-9099-f750cb972f69
2025-03-20 00:43:58,532 - payroll_api - INFO - Invalid session ID provided, created new session: f625da74-3df1-4db3-9099-f750cb972f69
2025-03-20 00:43:58,534 - payroll_api - INFO - Files list requested by user admin for session f625da74-3df1-4db3-9099-f750cb972f69
2025-03-20 00:43:58,534 - application.services.file_service - INFO - Getting list of all files
2025-03-20 00:43:58,535 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 00:43:58,537 - application.modules.file_agent - DEBUG - Database check successful. File count: 1
2025-03-20 00:43:58,538 - application.modules.file_agent - INFO - Retrieved 1 files from database
2025-03-20 00:43:58,538 - application.services.file_service - INFO - Retrieved 1 files from database
2025-03-20 00:43:58,538 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x0000014698A33390>]
2025-03-20 00:43:58,539 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}
2025-03-20 00:43:58,540 - application.services.file_service - INFO - Returning 1 processed files
2025-03-20 00:43:58,540 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}]
2025-03-20 00:43:58,541 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}]
2025-03-20 00:43:58,548 - application.services.session_service - INFO - Created new session: 2c3d6086-fbb0-484c-9440-5f27280835be
2025-03-20 00:43:58,548 - payroll_api - INFO - Invalid session ID provided, created new session: 2c3d6086-fbb0-484c-9440-5f27280835be
2025-03-20 00:43:58,549 - payroll_api - INFO - Task list requested by user admin for session 2c3d6086-fbb0-484c-9440-5f27280835be
2025-03-20 00:43:58,549 - payroll_api - ERROR - Error getting tasks: 'TaskResponse' object has no attribute 'get'
2025-03-20 00:43:58,556 - application.services.session_service - INFO - Created new session: cd5889bf-793f-451f-bf3a-50e0633ebddb
2025-03-20 00:43:58,557 - payroll_api - INFO - Invalid session ID provided, created new session: cd5889bf-793f-451f-bf3a-50e0633ebddb
2025-03-20 00:43:58,559 - payroll_api - INFO - Session history list requested by user admin for session cd5889bf-793f-451f-bf3a-50e0633ebddb
2025-03-20 00:44:15,947 - application.services.session_service - INFO - Created new session: 111fa29b-b40e-4fb9-87fe-4a439b1995e5
2025-03-20 00:44:15,947 - payroll_api - INFO - Invalid session ID provided, created new session: 111fa29b-b40e-4fb9-87fe-4a439b1995e5
2025-03-20 00:44:15,948 - payroll_api - INFO - Session reset requested by user admin for session 111fa29b-b40e-4fb9-87fe-4a439b1995e5
2025-03-20 00:44:15,950 - application.modules.agent_collection - INFO - タスク 支給控除等一覧(データ更新) をリセットします。
2025-03-20 00:44:15,950 - application.modules.agent_collection - INFO - タスク 支給控除等一覧(後処理) をリセットします。
2025-03-20 00:44:15,951 - application.modules.agent_collection - INFO - タスク Yonosukeデータ作成(加算処理) をリセットします。
2025-03-20 00:44:15,951 - application.modules.agent_collection - INFO - タスク Yonosukeデータ作成(データ除去) をリセットします。
2025-03-20 00:44:15,951 - application.modules.agent_collection - INFO - 状態を変更: chat -> chat
2025-03-20 00:44:21,713 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:44:21,714 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-20 00:44:21,715 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-20 00:44:21,715 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:44:21,717 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-20 00:44:21,718 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-20 00:44:21,719 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:44:21,719 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:44:21,719 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:65536]
2025-03-20 00:44:21,720 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:114688]
2025-03-20 00:44:21,721 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:22317]
2025-03-20 00:44:21,721 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:44:21,721 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:44:21,722 - python_multipart.multipart - DEBUG - Calling on_header_field with data[22361:22380]
2025-03-20 00:44:21,722 - python_multipart.multipart - DEBUG - Calling on_header_value with data[22382:22409]
2025-03-20 00:44:21,722 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:44:21,722 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:44:21,722 - python_multipart.multipart - DEBUG - Calling on_part_data with data[22413:22416]
2025-03-20 00:44:21,724 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:44:21,724 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:44:21,724 - python_multipart.multipart - DEBUG - Calling on_header_field with data[22460:22479]
2025-03-20 00:44:21,724 - python_multipart.multipart - DEBUG - Calling on_header_value with data[22481:22509]
2025-03-20 00:44:21,725 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:44:21,725 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:44:21,725 - python_multipart.multipart - DEBUG - Calling on_part_data with data[22513:22549]
2025-03-20 00:44:21,725 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:44:21,726 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 00:44:21,728 - application.services.session_service - INFO - Created new session: df6c543c-ac7b-4f0d-8ead-e69487f1f31c
2025-03-20 00:44:21,729 - payroll_api - INFO - Invalid session ID provided, created new session: df6c543c-ac7b-4f0d-8ead-e69487f1f31c
2025-03-20 00:44:21,731 - payroll_api - INFO - File upload request from user admin, session df6c543c-ac7b-4f0d-8ead-e69487f1f31c: sikyu_csv_sample.csv
2025-03-20 00:44:21,735 - payroll_api - DEBUG - File saved to: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\fe715044-b5b7-420c-afb8-fac3b7e8351e.csv
2025-03-20 00:44:21,766 - payroll_api - INFO - Successfully read file with 490 rows
2025-03-20 00:44:21,767 - application.modules.file_agent - INFO - store_csv_file開始: uploaded_8e768067-4b0d-46e7-8363-d97b1e445aad, definition=Uploaded CSV file, task_name=Manual Upload, rows=490
2025-03-20 00:44:21,769 - application.modules.file_agent - DEBUG - Database check successful. File count: 1
2025-03-20 00:44:21,770 - application.modules.file_agent - DEBUG - DataFrame info: {'columns': ['Unnamed: 0.1', 'Unnamed: 0', '従業員名', 'スタッフコード', 'グループ名', '給与規定グループ', '基本給', '基本給調整', '非課税通勤手当', '課税通勤手当', '通勤費調整（非）', '通勤費調整（課）', '自宅駐車場手当', '自宅駐車場手当調整', 'WFH 手当', 'WFH 手当調整', '単身赴任手当', '帰郷旅費手当', '赴任手当(課税)', '赴任手当(非課税)', '調整手当', '調整手当精算', '育児費用補助', '慶弔金', 'その他支給(課税）', 'その他支給(非課税）', 'Recognitionポイント', 'Recognition ポイント 所得税', 'その他報奨', 'その他報奨 所得税', '永年勤続', '交代勤務手当', '連操手当', '所定内残業手当', '普通残業手当', '深夜残業手当', '法定外休日残業手当', '法定休日残業手当', '60時間超手当', '時間外手当遡及', '代休控除', '遅刻早退欠勤控除', '経費', '支給合計', '課税支給合計', '非課税支給合計', '健康保険料', '健康保険料\u3000本人負担（翌月分）', '介護保険料', '介護保険料\u3000本人負担（翌月分）', '厚生年金保険料', '厚年保険料\u3000本人負担（翌月分）', '社会保険料調整\u3000本人負担', '雇用保険料', '社会保険料合計', 'DC加入者掛金', '所得税', '2024減税額', '2024減税後所得税', '住民税', '扶養是正', '還付徴収額（年調）', 'Recognition ポイント控除', '現物支給控除', '社用車プライベート使用料', '社宅費', '組合費', '給食費', '差押', '生保日本生命', '生保第一生命', '生保アフラック', '生保大樹', '積立貯蓄', '財形労金', 'その他控除', '控除合計', '差引支給額', '銀行振込１', '銀行振込２', '健保事業主負担', '介護事業主負担', '厚年事業主負担', '子育拠出金', '雇保事業主負担', '労災保険料', '一般拠出金', '確定拠出企業年金', 'キャッシュバランス', '出勤日数', '出勤時間', '所定内残業', '普通残業', '深夜残業', '法定外休日残業', '法定休日残業', '60時間超', '代休控除日数', '欠勤控除時間', '遅刻早退欠勤控除時間', '当月所定労働時間', '備考'], 'dtypes': {'Unnamed: 0.1': 'int64', 'Unnamed: 0': 'int64', '従業員名': 'float64', 'スタッフコード': 'int64', 'グループ名': 'float64', '給与規定グループ': 'object', '基本給': 'int64', '基本給調整': 'int64', '非課税通勤手当': 'int64', '課税通勤手当': 'int64', '通勤費調整（非）': 'int64', '通勤費調整（課）': 'int64', '自宅駐車場手当': 'int64', '自宅駐車場手当調整': 'int64', 'WFH 手当': 'int64', 'WFH 手当調整': 'int64', '単身赴任手当': 'int64', '帰郷旅費手当': 'int64', '赴任手当(課税)': 'int64', '赴任手当(非課税)': 'int64', '調整手当': 'int64', '調整手当精算': 'int64', '育児費用補助': 'int64', '慶弔金': 'int64', 'その他支給(課税）': 'int64', 'その他支給(非課税）': 'int64', 'Recognitionポイント': 'int64', 'Recognition ポイント 所得税': 'int64', 'その他報奨': 'int64', 'その他報奨 所得税': 'int64', '永年勤続': 'int64', '交代勤務手当': 'int64', '連操手当': 'int64', '所定内残業手当': 'int64', '普通残業手当': 'int64', '深夜残業手当': 'int64', '法定外休日残業手当': 'int64', '法定休日残業手当': 'int64', '60時間超手当': 'int64', '時間外手当遡及': 'int64', '代休控除': 'int64', '遅刻早退欠勤控除': 'int64', '経費': 'int64', '支給合計': 'int64', '課税支給合計': 'int64', '非課税支給合計': 'int64', '健康保険料': 'int64', '健康保険料\u3000本人負担（翌月分）': 'int64', '介護保険料': 'int64', '介護保険料\u3000本人負担（翌月分）': 'int64', '厚生年金保険料': 'int64', '厚年保険料\u3000本人負担（翌月分）': 'int64', '社会保険料調整\u3000本人負担': 'int64', '雇用保険料': 'int64', '社会保険料合計': 'int64', 'DC加入者掛金': 'int64', '所得税': 'int64', '2024減税額': 'int64', '2024減税後所得税': 'int64', '住民税': 'int64', '扶養是正': 'int64', '還付徴収額（年調）': 'int64', 'Recognition ポイント控除': 'int64', '現物支給控除': 'int64', '社用車プライベート使用料': 'int64', '社宅費': 'int64', '組合費': 'int64', '給食費': 'int64', '差押': 'int64', '生保日本生命': 'int64', '生保第一生命': 'int64', '生保アフラック': 'int64', '生保大樹': 'int64', '積立貯蓄': 'int64', '財形労金': 'int64', 'その他控除': 'int64', '控除合計': 'int64', '差引支給額': 'int64', '銀行振込１': 'int64', '銀行振込２': 'int64', '健保事業主負担': 'int64', '介護事業主負担': 'int64', '厚年事業主負担': 'int64', '子育拠出金': 'float64', '雇保事業主負担': 'float64', '労災保険料': 'float64', '一般拠出金': 'float64', '確定拠出企業年金': 'int64', 'キャッシュバランス': 'int64', '出勤日数': 'float64', '出勤時間': 'object', '所定内残業': 'object', '普通残業': 'object', '深夜残業': 'object', '法定外休日残業': 'object', '法定休日残業': 'object', '60時間超': 'object', '代休控除日数': 'float64', '欠勤控除時間': 'object', '遅刻早退欠勤控除時間': 'object', '当月所定労働時間': 'object', '備考': 'float64'}, 'has_nulls': {'Unnamed: 0.1': False, 'Unnamed: 0': False, '従業員名': True, 'スタッフコード': False, 'グループ名': False, '給与規定グループ': False, '基本給': False, '基本給調整': False, '非課税通勤手当': False, '課税通勤手当': False, '通勤費調整（非）': False, '通勤費調整（課）': False, '自宅駐車場手当': False, '自宅駐車場手当調整': False, 'WFH 手当': False, 'WFH 手当調整': False, '単身赴任手当': False, '帰郷旅費手当': False, '赴任手当(課税)': False, '赴任手当(非課税)': False, '調整手当': False, '調整手当精算': False, '育児費用補助': False, '慶弔金': False, 'その他支給(課税）': False, 'その他支給(非課税）': False, 'Recognitionポイント': False, 'Recognition ポイント 所得税': False, 'その他報奨': False, 'その他報奨 所得税': False, '永年勤続': False, '交代勤務手当': False, '連操手当': False, '所定内残業手当': False, '普通残業手当': False, '深夜残業手当': False, '法定外休日残業手当': False, '法定休日残業手当': False, '60時間超手当': False, '時間外手当遡及': False, '代休控除': False, '遅刻早退欠勤控除': False, '経費': False, '支給合計': False, '課税支給合計': False, '非課税支給合計': False, '健康保険料': False, '健康保険料\u3000本人負担（翌月分）': False, '介護保険料': False, '介護保険料\u3000本人負担（翌月分）': False, '厚生年金保険料': False, '厚年保険料\u3000本人負担（翌月分）': False, '社会保険料調整\u3000本人負担': False, '雇用保険料': False, '社会保険料合計': False, 'DC加入者掛金': False, '所得税': False, '2024減税額': False, '2024減税後所得税': False, '住民税': False, '扶養是正': False, '還付徴収額（年調）': False, 'Recognition ポイント控除': False, '現物支給控除': False, '社用車プライベート使用料': False, '社宅費': False, '組合費': False, '給食費': False, '差押': False, '生保日本生命': False, '生保第一生命': False, '生保アフラック': False, '生保大樹': False, '積立貯蓄': False, '財形労金': False, 'その他控除': False, '控除合計': False, '差引支給額': False, '銀行振込１': False, '銀行振込２': False, '健保事業主負担': False, '介護事業主負担': False, '厚年事業主負担': False, '子育拠出金': False, '雇保事業主負担': False, '労災保険料': False, '一般拠出金': False, '確定拠出企業年金': False, 'キャッシュバランス': False, '出勤日数': False, '出勤時間': False, '所定内残業': False, '普通残業': False, '深夜残業': False, '法定外休日残業': False, '法定休日残業': False, '60時間超': False, '代休控除日数': False, '欠勤控除時間': False, '遅刻早退欠勤控除時間': False, '当月所定労働時間': False, '備考': True}}
2025-03-20 00:44:21,779 - application.modules.file_agent - DEBUG - DataFile record created with ID: 2
2025-03-20 00:44:21,927 - application.modules.file_agent - DEBUG - Saved chunk 1 with 490 records
2025-03-20 00:44:21,939 - application.modules.file_agent - INFO - ファイルを保存しました。DataFile ID=2, 490 行, 1 chunks
2025-03-20 00:44:21,940 - payroll_api - INFO - File successfully stored in database with ID: 2
2025-03-20 00:44:21,940 - application.services.payroll_service - INFO - Processing message: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\fe715044-b5b7-420c-afb8-fac3b7e8351e.csv
2025-03-20 00:44:21,940 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 00:44:21,941 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈
human: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\f1b5d985-d187-47fe-9e97-fa5948dab836.csv
AI: 意図=file_upload

# 現在のユーザー入力
User: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\fe715044-b5b7-420c-afb8-fac3b7e8351e.csv

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 00:44:21,949 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\nhuman: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\f1b5d985-d187-47fe-9e97-fa5948dab836.csv\nAI: 意図=file_upload\n\n# 現在のユーザー入力\nUser: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\fe715044-b5b7-420c-afb8-fac3b7e8351e.csv\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 00:44:21,951 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 00:44:21,952 - httpcore.connection - DEBUG - close.started
2025-03-20 00:44:21,952 - httpcore.connection - DEBUG - close.complete
2025-03-20 00:44:21,953 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 00:44:22,242 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000146988D48D0>
2025-03-20 00:44:22,243 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000146F9774F80> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 00:44:22,605 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000146988D7750>
2025-03-20 00:44:22,605 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 00:44:22,606 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 00:44:22,606 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 00:44:22,607 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 00:44:22,607 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 00:44:23,263 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1258'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'78151734-540a-4c6a-9edd-29e91bbd9c46'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'999'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'96797'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'419'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'472'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'3d654334-c1ac-4d83-b830-8d25fbfa8d0a'), (b'ms-azureml-model-time', b'469'), (b'x-ms-client-request-id', b'78151734-540a-4c6a-9edd-29e91bbd9c46'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 15:44:22 GMT')])
2025-03-20 00:44:23,264 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 00:44:23,265 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 00:44:23,265 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 00:44:23,265 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 00:44:23,265 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 00:44:23,267 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1258', 'content-type': 'application/json', 'apim-request-id': '78151734-540a-4c6a-9edd-29e91bbd9c46', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '999', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '96797', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '419', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '472', 'x-ms-rai-invoked': 'true', 'x-request-id': '3d654334-c1ac-4d83-b830-8d25fbfa8d0a', 'ms-azureml-model-time': '469', 'x-ms-client-request-id': '78151734-540a-4c6a-9edd-29e91bbd9c46', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 15:44:22 GMT'})
2025-03-20 00:44:23,267 - openai._base_client - DEBUG - request_id: 3d654334-c1ac-4d83-b830-8d25fbfa8d0a
2025-03-20 00:44:23,268 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'file_upload', 'file_type': 'csv'}
2025-03-20 00:44:23,268 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\fe715044-b5b7-420c-afb8-fac3b7e8351e.csv
2025-03-20 00:44:23,375 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('アップロードされたファイルは以下のファイルの一つと推定する：\n支給控除等一覧(データ更新)-支給・控除等一覧表\n支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表\n支給控除等一覧(後処理)-更新された支給・控除等一覧表\n支給控除等一覧(後処理)-削除リスト\n支給控除等一覧(後処理)-漢字変換リスト\nYonosukeデータ作成(加算処理)-給与明細データ\nYonosukeデータ作成(加算処理)-前月Yonosukeデータ\nYonosukeデータ作成(加算処理)-賞与データ\nYonosukeデータ作成(データ除去)-今月Yonosukeデータ\nYonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト', ''), type: <class 'tuple'>
2025-03-20 00:44:23,375 - application.services.payroll_service - DEBUG - Standardized response: (アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト, )
2025-03-20 00:44:23,377 - payroll_api - DEBUG - Payroll service processed message: アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト
2025-03-20 00:44:23,381 - payroll_api - INFO - File uploaded successfully: sikyu_csv_sample.csv with 490 rows
2025-03-20 00:44:23,384 - payroll_api - DEBUG - Cleaned up temporary file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\fe715044-b5b7-420c-afb8-fac3b7e8351e.csv
2025-03-20 00:44:23,391 - application.services.session_service - INFO - Created new session: 734517d8-6e89-4623-b7e2-c40bdca5c3a6
2025-03-20 00:44:23,391 - payroll_api - INFO - Invalid session ID provided, created new session: 734517d8-6e89-4623-b7e2-c40bdca5c3a6
2025-03-20 00:44:23,392 - payroll_api - INFO - Files list requested by user admin for session 734517d8-6e89-4623-b7e2-c40bdca5c3a6
2025-03-20 00:44:23,393 - application.services.file_service - INFO - Getting list of all files
2025-03-20 00:44:23,393 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 00:44:23,396 - application.modules.file_agent - DEBUG - Database check successful. File count: 2
2025-03-20 00:44:23,397 - application.modules.file_agent - INFO - Retrieved 2 files from database
2025-03-20 00:44:23,397 - application.services.file_service - INFO - Retrieved 2 files from database
2025-03-20 00:44:23,398 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x00000146F935E150>, <application.modules.file_agent.DataFile object at 0x00000146F5659010>]
2025-03-20 00:44:23,398 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}
2025-03-20 00:44:23,398 - application.services.file_service - DEBUG - Processed file: {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}
2025-03-20 00:44:23,399 - application.services.file_service - INFO - Returning 2 processed files
2025-03-20 00:44:23,399 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}, {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}]
2025-03-20 00:44:23,400 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}, {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}]
2025-03-20 00:44:38,455 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:44:38,458 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-20 00:44:38,458 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-20 00:44:38,459 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:44:38,460 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-20 00:44:38,460 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-20 00:44:38,461 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:44:38,461 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:44:38,462 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:224]
2025-03-20 00:44:38,462 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:44:38,462 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:44:38,463 - python_multipart.multipart - DEBUG - Calling on_header_field with data[268:287]
2025-03-20 00:44:38,463 - python_multipart.multipart - DEBUG - Calling on_header_value with data[289:316]
2025-03-20 00:44:38,463 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:44:38,465 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:44:38,465 - python_multipart.multipart - DEBUG - Calling on_part_data with data[320:323]
2025-03-20 00:44:38,465 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:44:38,466 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 00:44:38,466 - python_multipart.multipart - DEBUG - Calling on_header_field with data[367:386]
2025-03-20 00:44:38,466 - python_multipart.multipart - DEBUG - Calling on_header_value with data[388:416]
2025-03-20 00:44:38,467 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 00:44:38,467 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 00:44:38,467 - python_multipart.multipart - DEBUG - Calling on_part_data with data[420:456]
2025-03-20 00:44:38,467 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 00:44:38,468 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 00:44:38,470 - application.services.session_service - INFO - Created new session: 7e86029b-05df-419e-a15a-231b878fbe20
2025-03-20 00:44:38,470 - payroll_api - INFO - Invalid session ID provided, created new session: 7e86029b-05df-419e-a15a-231b878fbe20
2025-03-20 00:44:38,474 - payroll_api - INFO - File upload request from user admin, session 7e86029b-05df-419e-a15a-231b878fbe20: kanji_csv_sample.csv
2025-03-20 00:44:38,476 - payroll_api - DEBUG - File saved to: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\4f7888aa-9b1e-421f-90b5-e247b5bb4ba0.csv
2025-03-20 00:44:38,495 - payroll_api - INFO - Successfully read file with 1 rows
2025-03-20 00:44:38,495 - application.modules.file_agent - INFO - store_csv_file開始: uploaded_5d53cee8-b8dd-4b89-9c95-7b3b69376490, definition=Uploaded CSV file, task_name=Manual Upload, rows=1
2025-03-20 00:44:38,496 - application.modules.file_agent - DEBUG - Database check successful. File count: 2
2025-03-20 00:44:38,498 - application.modules.file_agent - DEBUG - DataFrame info: {'columns': ['スタッフコード', '変換対象', '変換文字列'], 'dtypes': {'スタッフコード': 'int64', '変換対象': 'object', '変換文字列': 'object'}, 'has_nulls': {'スタッフコード': False, '変換対象': False, '変換文字列': False}}
2025-03-20 00:44:38,501 - application.modules.file_agent - DEBUG - DataFile record created with ID: 3
2025-03-20 00:44:38,502 - application.modules.file_agent - DEBUG - Saved chunk 1 with 1 records
2025-03-20 00:44:38,507 - application.modules.file_agent - INFO - ファイルを保存しました。DataFile ID=3, 1 行, 1 chunks
2025-03-20 00:44:38,507 - payroll_api - INFO - File successfully stored in database with ID: 3
2025-03-20 00:44:38,507 - application.services.payroll_service - INFO - Processing message: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\4f7888aa-9b1e-421f-90b5-e247b5bb4ba0.csv
2025-03-20 00:44:38,508 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 00:44:38,508 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈
AI: 意図=file_upload
human: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\fe715044-b5b7-420c-afb8-fac3b7e8351e.csv
AI: 意図=file_upload

# 現在のユーザー入力
User: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\4f7888aa-9b1e-421f-90b5-e247b5bb4ba0.csv

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 00:44:38,515 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\nAI: 意図=file_upload\nhuman: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\fe715044-b5b7-420c-afb8-fac3b7e8351e.csv\nAI: 意図=file_upload\n\n# 現在のユーザー入力\nUser: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\4f7888aa-9b1e-421f-90b5-e247b5bb4ba0.csv\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 00:44:38,518 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 00:44:38,518 - httpcore.connection - DEBUG - close.started
2025-03-20 00:44:38,519 - httpcore.connection - DEBUG - close.complete
2025-03-20 00:44:38,519 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 00:44:38,798 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000146989F6B90>
2025-03-20 00:44:38,798 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000146F9774F80> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 00:44:39,157 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000146988E03D0>
2025-03-20 00:44:39,157 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 00:44:39,158 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 00:44:39,158 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 00:44:39,158 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 00:44:39,159 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 00:44:39,847 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1258'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'699f8139-d399-4854-a9ad-1fb32eb8964c'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'998'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'93589'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'429'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-02'), (b'x-envoy-upstream-service-time', b'487'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'6aa476e9-51e1-4932-a230-71be5c2c2246'), (b'ms-azureml-model-time', b'483'), (b'x-ms-client-request-id', b'699f8139-d399-4854-a9ad-1fb32eb8964c'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 15:44:39 GMT')])
2025-03-20 00:44:39,848 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 00:44:39,848 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 00:44:39,848 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 00:44:39,850 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 00:44:39,850 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 00:44:39,850 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1258', 'content-type': 'application/json', 'apim-request-id': '699f8139-d399-4854-a9ad-1fb32eb8964c', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '998', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '93589', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '429', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-02', 'x-envoy-upstream-service-time': '487', 'x-ms-rai-invoked': 'true', 'x-request-id': '6aa476e9-51e1-4932-a230-71be5c2c2246', 'ms-azureml-model-time': '483', 'x-ms-client-request-id': '699f8139-d399-4854-a9ad-1fb32eb8964c', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 15:44:39 GMT'})
2025-03-20 00:44:39,851 - openai._base_client - DEBUG - request_id: 6aa476e9-51e1-4932-a230-71be5c2c2246
2025-03-20 00:44:39,852 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'file_upload', 'file_type': 'csv'}
2025-03-20 00:44:39,853 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\4f7888aa-9b1e-421f-90b5-e247b5bb4ba0.csv
2025-03-20 00:44:39,868 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('アップロードされたファイルは以下のファイルの一つと推定する：\n支給控除等一覧(データ更新)-支給・控除等一覧表\n支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表\n支給控除等一覧(後処理)-更新された支給・控除等一覧表\n支給控除等一覧(後処理)-削除リスト\n支給控除等一覧(後処理)-漢字変換リスト\nYonosukeデータ作成(加算処理)-給与明細データ\nYonosukeデータ作成(加算処理)-前月Yonosukeデータ\nYonosukeデータ作成(加算処理)-賞与データ\nYonosukeデータ作成(データ除去)-今月Yonosukeデータ\nYonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト', ''), type: <class 'tuple'>
2025-03-20 00:44:39,868 - application.services.payroll_service - DEBUG - Standardized response: (アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト, )
2025-03-20 00:44:39,870 - payroll_api - DEBUG - Payroll service processed message: アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト
2025-03-20 00:44:39,875 - payroll_api - INFO - File uploaded successfully: kanji_csv_sample.csv with 1 rows
2025-03-20 00:44:39,880 - payroll_api - DEBUG - Cleaned up temporary file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\4f7888aa-9b1e-421f-90b5-e247b5bb4ba0.csv
2025-03-20 00:44:39,886 - application.services.session_service - INFO - Created new session: d9ca8b1b-f997-444f-b69c-bb676d30f378
2025-03-20 00:44:39,887 - payroll_api - INFO - Invalid session ID provided, created new session: d9ca8b1b-f997-444f-b69c-bb676d30f378
2025-03-20 00:44:39,888 - payroll_api - INFO - Files list requested by user admin for session d9ca8b1b-f997-444f-b69c-bb676d30f378
2025-03-20 00:44:39,888 - application.services.file_service - INFO - Getting list of all files
2025-03-20 00:44:39,890 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 00:44:39,891 - application.modules.file_agent - DEBUG - Database check successful. File count: 3
2025-03-20 00:44:39,893 - application.modules.file_agent - INFO - Retrieved 3 files from database
2025-03-20 00:44:39,893 - application.services.file_service - INFO - Retrieved 3 files from database
2025-03-20 00:44:39,893 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x00000146988B3890>, <application.modules.file_agent.DataFile object at 0x00000146988B0B90>, <application.modules.file_agent.DataFile object at 0x00000146988B1450>]
2025-03-20 00:44:39,894 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}
2025-03-20 00:44:39,895 - application.services.file_service - DEBUG - Processed file: {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}
2025-03-20 00:44:39,895 - application.services.file_service - DEBUG - Processed file: {'id': 3, 'name': 'kanji_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:38', 'row_count': 1, 'output': False}
2025-03-20 00:44:39,895 - application.services.file_service - INFO - Returning 3 processed files
2025-03-20 00:44:39,895 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}, {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}, {'id': 3, 'name': 'kanji_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:38', 'row_count': 1, 'output': False}]
2025-03-20 00:44:39,897 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}, {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}, {'id': 3, 'name': 'kanji_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:38', 'row_count': 1, 'output': False}]
2025-03-20 00:45:50,287 - application.services.session_service - INFO - Created new session: 95cf1222-9eba-4d39-be4b-c7d635728f9d
2025-03-20 00:45:50,287 - payroll_api - INFO - Invalid session ID provided, created new session: 95cf1222-9eba-4d39-be4b-c7d635728f9d
2025-03-20 00:45:50,288 - payroll_api - INFO - Processing chat message for user admin, session 95cf1222-9eba-4d39-be4b-c7d635728f9d: 給与計算について教えてください
2025-03-20 00:45:50,291 - application.services.payroll_service - INFO - Processing message: 給与計算について教えてください
2025-03-20 00:45:50,291 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 00:45:50,291 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈
AI: 意図=file_upload
human: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\4f7888aa-9b1e-421f-90b5-e247b5bb4ba0.csv
AI: 意図=file_upload

# 現在のユーザー入力
User: 給与計算について教えてください

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 00:45:50,296 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\nAI: 意図=file_upload\nhuman: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\4f7888aa-9b1e-421f-90b5-e247b5bb4ba0.csv\nAI: 意図=file_upload\n\n# 現在のユーザー入力\nUser: 給与計算について教えてください\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 00:45:50,297 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 00:45:50,298 - httpcore.connection - DEBUG - close.started
2025-03-20 00:45:50,298 - httpcore.connection - DEBUG - close.complete
2025-03-20 00:45:50,299 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 00:45:50,604 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000146E3DB8B90>
2025-03-20 00:45:50,604 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000146F9774F80> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 00:45:50,995 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000014698A19A10>
2025-03-20 00:45:50,996 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 00:45:50,996 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 00:45:50,996 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 00:45:50,997 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 00:45:50,997 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 00:45:51,598 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1169'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'3737c707-64d6-4fcb-8d89-9c04765079b9'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'999'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'96820'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'349'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-02'), (b'x-envoy-upstream-service-time', b'411'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'b54040d0-40a6-48d4-b495-4cfb158ee4c0'), (b'ms-azureml-model-time', b'400'), (b'x-ms-client-request-id', b'3737c707-64d6-4fcb-8d89-9c04765079b9'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 15:45:51 GMT')])
2025-03-20 00:45:51,599 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 00:45:51,600 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 00:45:51,600 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 00:45:51,600 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 00:45:51,601 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 00:45:51,601 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1169', 'content-type': 'application/json', 'apim-request-id': '3737c707-64d6-4fcb-8d89-9c04765079b9', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '999', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '96820', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '349', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-02', 'x-envoy-upstream-service-time': '411', 'x-ms-rai-invoked': 'true', 'x-request-id': 'b54040d0-40a6-48d4-b495-4cfb158ee4c0', 'ms-azureml-model-time': '400', 'x-ms-client-request-id': '3737c707-64d6-4fcb-8d89-9c04765079b9', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 15:45:51 GMT'})
2025-03-20 00:45:51,603 - openai._base_client - DEBUG - request_id: b54040d0-40a6-48d4-b495-4cfb158ee4c0
2025-03-20 00:45:51,603 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'question', 'query': '給与計算について教えてください'}
2025-03-20 00:45:51,604 - application.modules.rag_agent - INFO - RAG_Agentに問い合わせ実行: 給与計算について教えてください
2025-03-20 00:45:51,669 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': 'messages=[HumanMessage(content="You are an assistant for question-answering tasks. Use the following pieces of retrieved context to answer the question. If you don\'t know the answer, just say that you don\'t know. Use three sentences maximum and keep the answer concise.\\nQuestion: 給与計算について教えてください(タスクを紹介する場合必ず定義を含め) \\nContext: # Sample Rule\\n\\n## Overview\\nThis is a sample rule file for testing the system.\\n\\n## Processing Rules\\n1. Handle payroll calculations according to standard procedures\\n2. Apply appropriate tax deductions\\n3. Generate reports in the required format \\nAnswer:", additional_kwargs={}, response_metadata={})]'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 00:45:51,670 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 00:45:51,671 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 00:45:51,847 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000146988E1BD0>
2025-03-20 00:45:51,848 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000146F9775370> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 00:45:52,212 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000146F9408E90>
2025-03-20 00:45:52,213 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 00:45:52,213 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 00:45:52,213 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 00:45:52,214 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 00:45:52,214 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 00:45:56,157 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1440'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'a45e933c-f85a-4325-95b1-2acbf24683df'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'998'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'93661'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'3715'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-02'), (b'x-envoy-upstream-service-time', b'3759'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'042e8eb3-086c-4a65-b307-dbca5ccf962a'), (b'ms-azureml-model-time', b'3756'), (b'x-ms-client-request-id', b'a45e933c-f85a-4325-95b1-2acbf24683df'), (b'azureml-model-session', b'v20250318-1-164381587'), (b'Date', b'Wed, 19 Mar 2025 15:45:55 GMT')])
2025-03-20 00:45:56,159 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 00:45:56,159 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 00:45:56,159 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 00:45:56,160 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 00:45:56,160 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 00:45:56,160 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1440', 'content-type': 'application/json', 'apim-request-id': 'a45e933c-f85a-4325-95b1-2acbf24683df', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '998', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '93661', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '3715', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-02', 'x-envoy-upstream-service-time': '3759', 'x-ms-rai-invoked': 'true', 'x-request-id': '042e8eb3-086c-4a65-b307-dbca5ccf962a', 'ms-azureml-model-time': '3756', 'x-ms-client-request-id': 'a45e933c-f85a-4325-95b1-2acbf24683df', 'azureml-model-session': 'v20250318-1-164381587', 'date': 'Wed, 19 Mar 2025 15:45:55 GMT'})
2025-03-20 00:45:56,160 - openai._base_client - DEBUG - request_id: 042e8eb3-086c-4a65-b307-dbca5ccf962a
2025-03-20 00:45:56,162 - application.modules.rag_agent - DEBUG - RAG応答: 給与計算は、従業員の労働時間や給与率に基づいて給与を計算し、適切な税金控除を適用するプロセスです。標準的な手順に従って計算を行い、必要な形式でレポートを生成します。具体的なタスクには、時間の記録、税金や控除の計算、最終的な給与の支払いが含まれます。
2025-03-20 00:45:56,163 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('給与計算は、従業員の労働時間や給与率に基づいて給与を計算し、適切な税金控除を適用するプロセスです。標準的な手順に従って計算を行い、必要な形式でレポートを生成します。具体的なタスクには、時間の記録、税金や控除の計算、最終的な給与の支払いが含まれます。', ''), type: <class 'tuple'>
2025-03-20 00:45:56,163 - application.services.payroll_service - DEBUG - Standardized response: (給与計算は、従業員の労働時間や給与率に基づいて給与を計算し、適切な税金控除を適用するプロセスです。標準的な手順に従って計算を行い、必要な形式でレポートを生成します。具体的なタスクには、時間の記録、税金や控除の計算、最終的な給与の支払いが含まれます。, )
2025-03-20 00:46:10,142 - payroll_api - INFO - Conversation history requested by user admin for session cd5889bf-793f-451f-bf3a-50e0633ebddb
2025-03-20 00:46:10,142 - payroll_api - ERROR - Error getting conversation history: Session cd5889bf-793f-451f-bf3a-50e0633ebddb not found or has no history
2025-03-20 00:46:38,600 - application.services.session_service - INFO - Created new session: 421b10fc-e4fe-44cd-8c76-d39f47a0f0f5
2025-03-20 00:46:38,601 - payroll_api - INFO - Invalid session ID provided, created new session: 421b10fc-e4fe-44cd-8c76-d39f47a0f0f5
2025-03-20 00:46:38,605 - payroll_api - INFO - Session reset requested by user admin for session 421b10fc-e4fe-44cd-8c76-d39f47a0f0f5
2025-03-20 00:46:38,608 - application.modules.agent_collection - INFO - タスク 支給控除等一覧(データ更新) をリセットします。
2025-03-20 00:46:38,609 - application.modules.agent_collection - INFO - タスク 支給控除等一覧(後処理) をリセットします。
2025-03-20 00:46:38,610 - application.modules.agent_collection - INFO - タスク Yonosukeデータ作成(加算処理) をリセットします。
2025-03-20 00:46:38,610 - application.modules.agent_collection - INFO - タスク Yonosukeデータ作成(データ除去) をリセットします。
2025-03-20 00:46:38,612 - application.modules.agent_collection - INFO - 状態を変更: chat -> chat
2025-03-20 00:46:44,142 - application.services.session_service - INFO - Created new session: 6ea00faf-937b-4c1d-b823-548cf6868d06
2025-03-20 00:46:44,143 - payroll_api - INFO - Invalid session ID provided, created new session: 6ea00faf-937b-4c1d-b823-548cf6868d06
2025-03-20 00:46:44,145 - payroll_api - INFO - Task list requested by user admin for session 6ea00faf-937b-4c1d-b823-548cf6868d06
2025-03-20 00:46:44,147 - payroll_api - ERROR - Error getting tasks: 'TaskResponse' object has no attribute 'get'
2025-03-20 00:46:44,170 - application.services.session_service - INFO - Created new session: 59430dc7-5358-4cbb-8c3e-105d4e45bcec
2025-03-20 00:46:44,171 - payroll_api - INFO - Invalid session ID provided, created new session: 59430dc7-5358-4cbb-8c3e-105d4e45bcec
2025-03-20 00:46:44,172 - payroll_api - INFO - Files list requested by user admin for session 59430dc7-5358-4cbb-8c3e-105d4e45bcec
2025-03-20 00:46:44,173 - application.services.file_service - INFO - Getting list of all files
2025-03-20 00:46:44,175 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 00:46:44,177 - application.modules.file_agent - DEBUG - Database check successful. File count: 3
2025-03-20 00:46:44,179 - application.modules.file_agent - INFO - Retrieved 3 files from database
2025-03-20 00:46:44,180 - application.services.file_service - INFO - Retrieved 3 files from database
2025-03-20 00:46:44,180 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x0000014698888290>, <application.modules.file_agent.DataFile object at 0x0000014698889490>, <application.modules.file_agent.DataFile object at 0x0000014698888F10>]
2025-03-20 00:46:44,181 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}
2025-03-20 00:46:44,181 - application.services.file_service - DEBUG - Processed file: {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}
2025-03-20 00:46:44,181 - application.services.file_service - DEBUG - Processed file: {'id': 3, 'name': 'kanji_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:38', 'row_count': 1, 'output': False}
2025-03-20 00:46:44,182 - application.services.file_service - INFO - Returning 3 processed files
2025-03-20 00:46:44,182 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}, {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}, {'id': 3, 'name': 'kanji_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:38', 'row_count': 1, 'output': False}]
2025-03-20 00:46:44,182 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}, {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}, {'id': 3, 'name': 'kanji_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:38', 'row_count': 1, 'output': False}]
2025-03-20 00:46:44,195 - application.services.session_service - INFO - Created new session: c6127413-571e-4cc5-8176-32e0e9de0b2e
2025-03-20 00:46:44,196 - payroll_api - INFO - Invalid session ID provided, created new session: c6127413-571e-4cc5-8176-32e0e9de0b2e
2025-03-20 00:46:44,198 - payroll_api - INFO - Session history list requested by user admin for session c6127413-571e-4cc5-8176-32e0e9de0b2e
2025-03-20 00:46:44,211 - application.services.session_service - INFO - Created new session: 33d45df3-1f4c-4803-8ff6-60afe0a72a01
2025-03-20 00:46:44,214 - payroll_api - INFO - Invalid session ID provided, created new session: 33d45df3-1f4c-4803-8ff6-60afe0a72a01
2025-03-20 00:46:44,216 - payroll_api - INFO - Task list requested by user admin for session 33d45df3-1f4c-4803-8ff6-60afe0a72a01
2025-03-20 00:46:44,217 - payroll_api - ERROR - Error getting tasks: 'TaskResponse' object has no attribute 'get'
2025-03-20 00:46:44,226 - application.services.session_service - INFO - Created new session: 3175f8be-6911-4ae0-8198-0027c3e63ce4
2025-03-20 00:46:44,227 - payroll_api - INFO - Invalid session ID provided, created new session: 3175f8be-6911-4ae0-8198-0027c3e63ce4
2025-03-20 00:46:44,231 - payroll_api - INFO - Files list requested by user admin for session 3175f8be-6911-4ae0-8198-0027c3e63ce4
2025-03-20 00:46:44,232 - application.services.file_service - INFO - Getting list of all files
2025-03-20 00:46:44,232 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 00:46:44,234 - application.modules.file_agent - DEBUG - Database check successful. File count: 3
2025-03-20 00:46:44,238 - application.modules.file_agent - INFO - Retrieved 3 files from database
2025-03-20 00:46:44,238 - application.services.file_service - INFO - Retrieved 3 files from database
2025-03-20 00:46:44,239 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x00000146989E7450>, <application.modules.file_agent.DataFile object at 0x00000146989E66D0>, <application.modules.file_agent.DataFile object at 0x00000146989E4FD0>]
2025-03-20 00:46:44,240 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}
2025-03-20 00:46:44,241 - application.services.file_service - DEBUG - Processed file: {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}
2025-03-20 00:46:44,242 - application.services.file_service - DEBUG - Processed file: {'id': 3, 'name': 'kanji_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:38', 'row_count': 1, 'output': False}
2025-03-20 00:46:44,242 - application.services.file_service - INFO - Returning 3 processed files
2025-03-20 00:46:44,243 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}, {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}, {'id': 3, 'name': 'kanji_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:38', 'row_count': 1, 'output': False}]
2025-03-20 00:46:44,245 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'string', 'upload_date': '2025-03-20 00:30:42', 'row_count': 490, 'output': False}, {'id': 2, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:21', 'row_count': 490, 'output': False}, {'id': 3, 'name': 'kanji_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 00:44:38', 'row_count': 1, 'output': False}]
2025-03-20 00:46:44,253 - application.services.session_service - INFO - Created new session: 8b5b7eb7-b9cb-43d9-886a-dafa3b8617f0
2025-03-20 00:46:44,258 - payroll_api - INFO - Invalid session ID provided, created new session: 8b5b7eb7-b9cb-43d9-886a-dafa3b8617f0
2025-03-20 00:46:44,259 - payroll_api - INFO - Session history list requested by user admin for session 8b5b7eb7-b9cb-43d9-886a-dafa3b8617f0
2025-03-20 00:48:23,864 - payroll_api - INFO - API shutting down
2025-03-20 00:48:23,865 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 00:48:23,867 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 00:48:23,877 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 01:43:20,220 - payroll_api - INFO - Service modules imported successfully
2025-03-20 01:43:20,244 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 01:43:20,277 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 01:43:20,287 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 01:43:20,288 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 01:43:20,289 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 01:43:20,290 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 01:43:20,290 - payroll_api - INFO - FileService initialized successfully
2025-03-20 01:43:20,291 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 01:43:20,291 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 01:43:20,291 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 01:43:20,292 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 01:43:20,293 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 01:43:20,296 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 01:43:20,296 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 01:43:22,436 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 01:43:22,440 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 01:43:22,441 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 01:43:22,441 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 01:43:22,442 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 01:43:51,919 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 01:43:51,919 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 01:43:51,925 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 01:43:52,144 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 01:43:52,315 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 01:43:52,480 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 01:43:52,648 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 01:43:52,813 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 01:43:52,992 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 01:43:53,165 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 01:43:53,892 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 01:43:54,122 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 01:43:54,302 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 01:43:54,307 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 01:43:54,388 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 01:43:54,388 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 01:43:54,388 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 01:43:54,400 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 01:43:54,401 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 01:43:54,437 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 01:43:54,438 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 01:43:54,746 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 01:43:54,757 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 01:43:54,760 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 01:43:54,832 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 01:43:54,853 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 01:43:55,050 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 01:43:55,063 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 01:43:55,065 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 01:43:55,066 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 01:43:55,066 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 01:43:55,067 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 01:43:55,067 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 01:43:55,067 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 01:43:55,376 - application.services.session_service - INFO - Loaded 33 sessions from disk
2025-03-20 01:43:55,376 - application.services.session_service - INFO - SessionService initialized with 33 sessions
2025-03-20 01:43:55,377 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 01:43:55,395 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 01:43:55,631 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 01:43:55,632 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 01:43:55,632 - payroll_api - INFO - Admin password from env: password
2025-03-20 01:43:55,633 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 01:43:55,633 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 01:43:55,636 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 01:43:55,637 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 01:43:55,637 - payroll_api - INFO - Initializing authentication
2025-03-20 01:43:55,637 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 01:43:55,637 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 01:48:33,154 - payroll_api - INFO - API shutting down
2025-03-20 01:48:33,156 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 01:48:33,158 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 01:48:47,425 - payroll_api - INFO - Service modules imported successfully
2025-03-20 01:48:47,447 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 01:48:47,493 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 01:48:47,504 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 01:48:47,504 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 01:48:47,505 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 01:48:47,505 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 01:48:47,505 - payroll_api - INFO - FileService initialized successfully
2025-03-20 01:48:47,506 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 01:48:47,506 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 01:48:47,506 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 01:48:47,507 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 01:48:47,509 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 01:48:47,513 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 01:48:47,514 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 01:48:50,911 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 01:48:50,915 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 01:48:50,915 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 01:48:50,915 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 01:48:50,917 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 01:49:01,708 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 01:49:01,709 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 01:49:01,715 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 01:49:01,944 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 01:49:02,136 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 01:49:02,299 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 01:49:02,467 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 01:49:02,635 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 01:49:02,807 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 01:49:02,978 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 01:49:03,656 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 01:49:03,894 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 01:49:04,064 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 01:49:04,067 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 01:49:04,096 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 01:49:04,097 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 01:49:04,097 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 01:49:04,100 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 01:49:04,100 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 01:49:04,127 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 01:49:04,128 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 01:49:04,159 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 01:49:04,170 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 01:49:04,173 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 01:49:04,183 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 01:49:04,211 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 01:49:04,387 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 01:49:04,412 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 01:49:04,415 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 01:49:04,415 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 01:49:04,415 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 01:49:04,416 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 01:49:04,417 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 01:49:04,417 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 01:49:04,427 - application.services.session_service - INFO - Loaded 33 sessions from disk
2025-03-20 01:49:04,427 - application.services.session_service - INFO - SessionService initialized with 33 sessions
2025-03-20 01:49:04,427 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 01:49:04,644 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 01:49:04,644 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 01:49:04,645 - payroll_api - INFO - Admin password from env: password
2025-03-20 01:49:04,645 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 01:49:04,645 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 01:49:04,646 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 01:49:04,647 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 01:49:04,647 - payroll_api - INFO - Initializing authentication
2025-03-20 01:49:04,647 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 01:49:04,647 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 01:50:52,879 - payroll_api - INFO - API shutting down
2025-03-20 01:50:52,880 - payroll_api - INFO - Deleted 0 old temporary files
2025-03-20 01:50:52,882 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 01:50:52,891 - langsmith.client - DEBUG - Closing Client.session
2025-03-20 23:29:57,832 - payroll_api - INFO - Service modules imported successfully
2025-03-20 23:29:57,848 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 23:29:57,906 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 23:29:57,916 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 23:29:57,916 - application.services.file_service - INFO - Loading config from C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json for FileAgent
2025-03-20 23:29:57,916 - application.services.file_service - WARNING - Config file not found at C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\json\config.json, using empty task_configs
2025-03-20 23:29:57,917 - application.services.file_service - INFO - FileService initialized with temp_dir: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads
2025-03-20 23:29:57,917 - payroll_api - INFO - FileService initialized successfully
2025-03-20 23:29:57,918 - application.services.payroll_service - INFO - Initializing PayrollService with config: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 23:29:57,918 - application.modules.agent_collection - INFO - エージェントコレクションを初期化しています...
2025-03-20 23:29:57,918 - application.modules.file_agent - INFO - FileAgent を初期化します。
2025-03-20 23:29:57,918 - application.modules.file_agent - WARNING - Could not remove existing database file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 23:29:57,919 - application.modules.file_agent - WARNING - Will try to reuse existing database.
2025-03-20 23:29:57,921 - application.modules.file_agent - INFO - FileAgent 初期化完了: sqlite:///C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\data\app.db
2025-03-20 23:29:57,921 - application.modules.agent_collection - INFO - ファイルエージェントを初期化しました。
2025-03-20 23:29:59,660 - application.modules.agent_collection - INFO - 設定ファイルを正常に読み込みました: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\json\config.json
2025-03-20 23:29:59,665 - application.modules.agent_collection - INFO - タスクを正常に作成。タスク数: 4
2025-03-20 23:29:59,665 - application.modules.agent_collection - INFO - IntentAnalyzer を初期化
2025-03-20 23:29:59,665 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化開始
2025-03-20 23:29:59,666 - application.modules.rag_agent - INFO - RAG_Agentを初期化します。
2025-03-20 23:30:29,154 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-20 23:30:29,154 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-20 23:30:29,159 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-20 23:30:29,380 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 23:30:29,671 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-20 23:30:29,922 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-20 23:30:30,101 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-20 23:30:30,285 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-20 23:30:30,467 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-20 23:30:30,635 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-20 23:30:31,531 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-20 23:30:31,814 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-20 23:30:32,002 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-20 23:30:32,010 - application.modules.rag_agent - DEBUG - HuggingFaceEmbeddings インスタンス生成OK
2025-03-20 23:30:32,222 - application.modules.rag_agent - DEBUG - embed_query実行OK. 長さ=384
2025-03-20 23:30:32,223 - application.modules.rag_agent - DEBUG - RAG用chainを作成します。
2025-03-20 23:30:32,223 - application.modules.rag_agent - INFO - RAG用に複数ファイルからRetrieverを作成します。
2025-03-20 23:30:32,226 - application.modules.rag_agent - DEBUG - ファイル C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\rule\test_rule.md は 1 個に分割
2025-03-20 23:30:32,226 - application.modules.rag_agent - DEBUG - 合計 1 個の分割ドキュメントを作成します。
2025-03-20 23:30:32,266 - faiss.loader - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-03-20 23:30:32,268 - faiss.loader - INFO - Loading faiss with AVX2 support.
2025-03-20 23:30:32,597 - faiss.loader - INFO - Successfully loaded faiss with AVX2 support.
2025-03-20 23:30:32,610 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.
2025-03-20 23:30:32,613 - application.modules.rag_agent - DEBUG - Vectorstore(Faiss)作成完了
2025-03-20 23:30:32,678 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): api.smith.langchain.com:443
2025-03-20 23:30:32,704 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (2): api.smith.langchain.com:443
2025-03-20 23:30:32,881 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /info HTTP/1.1" 200 672
2025-03-20 23:30:32,901 - urllib3.connectionpool - DEBUG - https://api.smith.langchain.com:443 "GET /commits/rlm/rag-prompt/latest HTTP/1.1" 200 844
2025-03-20 23:30:32,903 - application.modules.rag_agent - INFO - RAG_Agent初期化完了
2025-03-20 23:30:32,904 - application.modules.agent_collection - INFO - RAG_AGENT: 初期化完了
2025-03-20 23:30:32,904 - application.modules.agent_collection - INFO - workflow 作成
2025-03-20 23:30:32,905 - application.services.payroll_service - INFO - AgentCollection initialized successfully
2025-03-20 23:30:32,905 - payroll_api - INFO - PayrollService initialized successfully
2025-03-20 23:30:32,906 - application.services.session_service - INFO - Session persistence enabled, using directory: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\sessions
2025-03-20 23:30:32,906 - application.services.session_service - INFO - Skipping expired session 0d55bcd8-5765-47c2-8b2c-4835c490e9b7
2025-03-20 23:30:32,907 - application.services.session_service - ERROR - Error loading session 0d55bcd8-5765-47c2-8b2c-4835c490e9b7: [WinError 32] The process cannot access the file because it is being used by another process: 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\sessions\\0d55bcd8-5765-47c2-8b2c-4835c490e9b7.json'
2025-03-20 23:30:32,909 - application.services.session_service - INFO - Skipping expired session 10c9a701-dcda-4cd9-8794-b0d35740f2e6
2025-03-20 23:30:32,909 - application.services.session_service - ERROR - Error loading session 10c9a701-dcda-4cd9-8794-b0d35740f2e6: [WinError 32] The process cannot access the file because it is being used by another process: 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\sessions\\10c9a701-dcda-4cd9-8794-b0d35740f2e6.json'
2025-03-20 23:30:32,910 - application.services.session_service - INFO - Skipping expired session 20bea39a-5115-4efb-84ac-b5c013ef9258
2025-03-20 23:30:32,911 - application.services.session_service - ERROR - Error loading session 20bea39a-5115-4efb-84ac-b5c013ef9258: [WinError 32] The process cannot access the file because it is being used by another process: 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\sessions\\20bea39a-5115-4efb-84ac-b5c013ef9258.json'
2025-03-20 23:30:32,912 - application.services.session_service - INFO - Skipping expired session 2278e4d1-8ad6-461a-9f4c-c1c83c48bfef
2025-03-20 23:30:32,913 - application.services.session_service - ERROR - Error loading session 2278e4d1-8ad6-461a-9f4c-c1c83c48bfef: [WinError 32] The process cannot access the file because it is being used by another process: 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\sessions\\2278e4d1-8ad6-461a-9f4c-c1c83c48bfef.json'
2025-03-20 23:30:32,920 - application.services.session_service - INFO - Skipping expired session d511907a-03f9-4ffc-a01c-9537e1b0484c
2025-03-20 23:30:32,921 - application.services.session_service - ERROR - Error loading session d511907a-03f9-4ffc-a01c-9537e1b0484c: [WinError 32] The process cannot access the file because it is being used by another process: 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\sessions\\d511907a-03f9-4ffc-a01c-9537e1b0484c.json'
2025-03-20 23:30:32,923 - application.services.session_service - INFO - Skipping expired session e8b29861-e8fc-4f55-a8e0-5201d6e819ed
2025-03-20 23:30:32,923 - application.services.session_service - ERROR - Error loading session e8b29861-e8fc-4f55-a8e0-5201d6e819ed: [WinError 32] The process cannot access the file because it is being used by another process: 'C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\sessions\\e8b29861-e8fc-4f55-a8e0-5201d6e819ed.json'
2025-03-20 23:30:32,925 - application.services.session_service - INFO - Loaded 27 sessions from disk
2025-03-20 23:30:32,925 - application.services.session_service - INFO - SessionService initialized with 27 sessions
2025-03-20 23:30:32,926 - payroll_api - INFO - SessionService initialized successfully
2025-03-20 23:30:33,175 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 23:30:33,176 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 23:30:33,176 - payroll_api - INFO - Admin password from env: password
2025-03-20 23:30:33,176 - application.services.session_service - INFO - Cleaned up 0 old sessions
2025-03-20 23:30:33,177 - payroll_api - INFO - Startup: cleaned up 0 sessions older than 24 hours
2025-03-20 23:30:33,180 - payroll_api - INFO - Deleted 2 old temporary files
2025-03-20 23:30:33,180 - payroll_api - INFO - Startup: cleaned up temporary files
2025-03-20 23:30:33,180 - payroll_api - INFO - Initializing authentication
2025-03-20 23:30:33,180 - payroll_api - INFO - User authentication initialized with 2 users
2025-03-20 23:30:33,181 - payroll_api - INFO - Authentication initialized successfully
2025-03-20 23:31:03,746 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 23:31:03,747 - python_multipart.multipart - DEBUG - Calling on_field_name with data[0:8]
2025-03-20 23:31:03,747 - python_multipart.multipart - DEBUG - Calling on_field_data with data[9:14]
2025-03-20 23:31:03,747 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 23:31:03,747 - python_multipart.multipart - DEBUG - Calling on_field_start with no data
2025-03-20 23:31:03,748 - python_multipart.multipart - DEBUG - Calling on_field_name with data[15:23]
2025-03-20 23:31:03,748 - python_multipart.multipart - DEBUG - Calling on_field_data with data[24:32]
2025-03-20 23:31:03,748 - python_multipart.multipart - DEBUG - Calling on_field_end with no data
2025-03-20 23:31:03,748 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 23:31:03,751 - payroll_api - DEBUG - Login attempt: username=admin, password=***
2025-03-20 23:31:03,752 - payroll_api - INFO - User database path: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\application\services\security\users.json
2025-03-20 23:31:03,752 - payroll_api - INFO - Users in database: ['admin', 'user']
2025-03-20 23:31:03,753 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2025-03-20 23:31:03,754 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2025-03-20 23:31:04,120 - payroll_api - DEBUG - Authentication result: True
2025-03-20 23:31:04,342 - application.services.session_service - INFO - Created new session: ca5fa1ba-65f5-4591-8dfb-999dfb30a5f7
2025-03-20 23:31:04,342 - payroll_api - INFO - Invalid session ID provided, created new session: ca5fa1ba-65f5-4591-8dfb-999dfb30a5f7
2025-03-20 23:31:04,345 - payroll_api - INFO - Task list requested by user admin for session ca5fa1ba-65f5-4591-8dfb-999dfb30a5f7
2025-03-20 23:31:04,346 - payroll_api - ERROR - Error getting tasks: 'TaskResponse' object has no attribute 'get'
2025-03-20 23:31:04,352 - application.services.session_service - INFO - Created new session: 7a7400cb-6c37-4d8b-b15d-a41d14640ec7
2025-03-20 23:31:04,353 - payroll_api - INFO - Invalid session ID provided, created new session: 7a7400cb-6c37-4d8b-b15d-a41d14640ec7
2025-03-20 23:31:04,353 - payroll_api - INFO - Files list requested by user admin for session 7a7400cb-6c37-4d8b-b15d-a41d14640ec7
2025-03-20 23:31:04,353 - application.services.file_service - INFO - Getting list of all files
2025-03-20 23:31:04,354 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 23:31:04,356 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 23:31:04,361 - application.modules.file_agent - INFO - Retrieved 0 files from database
2025-03-20 23:31:04,361 - application.services.file_service - INFO - Retrieved 0 files from database
2025-03-20 23:31:04,362 - application.services.file_service - DEBUG - Raw files from database: []
2025-03-20 23:31:04,362 - application.services.file_service - WARNING - No files found in database
2025-03-20 23:31:04,363 - application.services.file_service - INFO - Returning 0 processed files
2025-03-20 23:31:04,363 - payroll_api - DEBUG - Raw files from file_service: []
2025-03-20 23:31:04,363 - payroll_api - DEBUG - Adapted files for frontend: []
2025-03-20 23:31:04,371 - application.services.session_service - INFO - Created new session: 64747d0e-1aaf-4af1-83f3-2f2e18be6028
2025-03-20 23:31:04,372 - payroll_api - INFO - Invalid session ID provided, created new session: 64747d0e-1aaf-4af1-83f3-2f2e18be6028
2025-03-20 23:31:04,376 - payroll_api - INFO - Session history list requested by user admin for session 64747d0e-1aaf-4af1-83f3-2f2e18be6028
2025-03-20 23:31:04,384 - application.services.session_service - INFO - Created new session: 1382bcb4-8a39-4d0a-8a1b-071f93c88b8f
2025-03-20 23:31:04,384 - payroll_api - INFO - Invalid session ID provided, created new session: 1382bcb4-8a39-4d0a-8a1b-071f93c88b8f
2025-03-20 23:31:04,385 - payroll_api - INFO - Task list requested by user admin for session 1382bcb4-8a39-4d0a-8a1b-071f93c88b8f
2025-03-20 23:31:04,385 - payroll_api - ERROR - Error getting tasks: 'TaskResponse' object has no attribute 'get'
2025-03-20 23:31:04,397 - application.services.session_service - INFO - Created new session: 2c5e41e2-75fd-4620-9224-8e7855fe2888
2025-03-20 23:31:04,399 - payroll_api - INFO - Invalid session ID provided, created new session: 2c5e41e2-75fd-4620-9224-8e7855fe2888
2025-03-20 23:31:04,400 - payroll_api - INFO - Files list requested by user admin for session 2c5e41e2-75fd-4620-9224-8e7855fe2888
2025-03-20 23:31:04,400 - application.services.file_service - INFO - Getting list of all files
2025-03-20 23:31:04,400 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 23:31:04,403 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 23:31:04,405 - application.modules.file_agent - INFO - Retrieved 0 files from database
2025-03-20 23:31:04,405 - application.services.file_service - INFO - Retrieved 0 files from database
2025-03-20 23:31:04,405 - application.services.file_service - DEBUG - Raw files from database: []
2025-03-20 23:31:04,406 - application.services.file_service - WARNING - No files found in database
2025-03-20 23:31:04,406 - application.services.file_service - INFO - Returning 0 processed files
2025-03-20 23:31:04,406 - payroll_api - DEBUG - Raw files from file_service: []
2025-03-20 23:31:04,407 - payroll_api - DEBUG - Adapted files for frontend: []
2025-03-20 23:31:04,414 - application.services.session_service - INFO - Created new session: 32e71ce5-2015-460b-bb3d-139b4613e40c
2025-03-20 23:31:04,415 - payroll_api - INFO - Invalid session ID provided, created new session: 32e71ce5-2015-460b-bb3d-139b4613e40c
2025-03-20 23:31:04,415 - payroll_api - INFO - Session history list requested by user admin for session 32e71ce5-2015-460b-bb3d-139b4613e40c
2025-03-20 23:31:10,018 - payroll_api - INFO - Conversation history requested by user admin for session 32e71ce5-2015-460b-bb3d-139b4613e40c
2025-03-20 23:31:10,018 - payroll_api - ERROR - Error getting conversation history: Session 32e71ce5-2015-460b-bb3d-139b4613e40c not found or has no history
2025-03-20 23:31:22,013 - application.services.session_service - INFO - Created new session: fa31cee3-2efc-4dff-a3a1-a3554c24939e
2025-03-20 23:31:22,013 - payroll_api - INFO - Invalid session ID provided, created new session: fa31cee3-2efc-4dff-a3a1-a3554c24939e
2025-03-20 23:31:22,015 - payroll_api - INFO - Session reset requested by user admin for session fa31cee3-2efc-4dff-a3a1-a3554c24939e
2025-03-20 23:31:22,017 - application.modules.agent_collection - INFO - タスク 支給控除等一覧(データ更新) をリセットします。
2025-03-20 23:31:22,017 - application.modules.agent_collection - INFO - タスク 支給控除等一覧(後処理) をリセットします。
2025-03-20 23:31:22,018 - application.modules.agent_collection - INFO - タスク Yonosukeデータ作成(加算処理) をリセットします。
2025-03-20 23:31:22,018 - application.modules.agent_collection - INFO - タスク Yonosukeデータ作成(データ除去) をリセットします。
2025-03-20 23:31:22,019 - application.modules.agent_collection - INFO - 状態を変更: chat -> chat
2025-03-20 23:31:24,248 - application.services.session_service - INFO - Created new session: 18c55862-4c35-4825-a95b-f500512d9cb1
2025-03-20 23:31:24,248 - payroll_api - INFO - Invalid session ID provided, created new session: 18c55862-4c35-4825-a95b-f500512d9cb1
2025-03-20 23:31:24,250 - payroll_api - INFO - Processing chat message for user admin, session 18c55862-4c35-4825-a95b-f500512d9cb1: 給与計算について教えてください
2025-03-20 23:31:24,252 - application.services.payroll_service - INFO - Processing message: 給与計算について教えてください
2025-03-20 23:31:24,253 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 23:31:24,253 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈


# 現在のユーザー入力
User: 給与計算について教えてください

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 23:31:24,265 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\n\n\n# 現在のユーザー入力\nUser: 給与計算について教えてください\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 23:31:24,284 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 23:31:24,287 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 23:31:24,573 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000196F105ABD0>
2025-03-20 23:31:24,574 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000196F13D4F80> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 23:31:24,943 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000196903BE8D0>
2025-03-20 23:31:24,943 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 23:31:24,943 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 23:31:24,945 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 23:31:24,945 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 23:31:24,945 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 23:31:25,534 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1169'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'e783bbfb-ab3f-48b8-ae6c-5923f6312abf'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'999'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'96862'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'345'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'398'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'e19740ed-c0d9-46cd-b99e-6f22e66639bf'), (b'ms-azureml-model-time', b'395'), (b'x-ms-client-request-id', b'e783bbfb-ab3f-48b8-ae6c-5923f6312abf'), (b'azureml-model-session', b'v20250319-1-164616836'), (b'Date', b'Thu, 20 Mar 2025 14:31:24 GMT')])
2025-03-20 23:31:25,537 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 23:31:25,537 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 23:31:25,537 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 23:31:25,538 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 23:31:25,538 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 23:31:25,538 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1169', 'content-type': 'application/json', 'apim-request-id': 'e783bbfb-ab3f-48b8-ae6c-5923f6312abf', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '999', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '96862', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '345', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '398', 'x-ms-rai-invoked': 'true', 'x-request-id': 'e19740ed-c0d9-46cd-b99e-6f22e66639bf', 'ms-azureml-model-time': '395', 'x-ms-client-request-id': 'e783bbfb-ab3f-48b8-ae6c-5923f6312abf', 'azureml-model-session': 'v20250319-1-164616836', 'date': 'Thu, 20 Mar 2025 14:31:24 GMT'})
2025-03-20 23:31:25,539 - openai._base_client - DEBUG - request_id: e19740ed-c0d9-46cd-b99e-6f22e66639bf
2025-03-20 23:31:25,542 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'question', 'query': '給与計算について教えてください'}
2025-03-20 23:31:25,543 - application.modules.rag_agent - INFO - RAG_Agentに問い合わせ実行: 給与計算について教えてください
2025-03-20 23:31:25,601 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': 'messages=[HumanMessage(content="You are an assistant for question-answering tasks. Use the following pieces of retrieved context to answer the question. If you don\'t know the answer, just say that you don\'t know. Use three sentences maximum and keep the answer concise.\\nQuestion: 給与計算について教えてください(タスクを紹介する場合必ず定義を含め) \\nContext: # Sample Rule\\n\\n## Overview\\nThis is a sample rule file for testing the system.\\n\\n## Processing Rules\\n1. Handle payroll calculations according to standard procedures\\n2. Apply appropriate tax deductions\\n3. Generate reports in the required format \\nAnswer:", additional_kwargs={}, response_metadata={})]'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 23:31:25,602 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 23:31:25,603 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 23:31:25,785 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000196904079D0>
2025-03-20 23:31:25,785 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000196F13D5370> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 23:31:26,165 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690402110>
2025-03-20 23:31:26,166 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 23:31:26,166 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 23:31:26,166 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 23:31:26,167 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 23:31:26,167 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 23:31:28,560 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1316'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'7cd05179-aa1e-49c0-897c-2178a14bcb60'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'998'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'93703'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'2152'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-02'), (b'x-envoy-upstream-service-time', b'2203'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'4612f79c-5f23-4cf2-b4ab-0fcae00abd47'), (b'ms-azureml-model-time', b'2197'), (b'x-ms-client-request-id', b'7cd05179-aa1e-49c0-897c-2178a14bcb60'), (b'azureml-model-session', b'v20250319-1-164616836'), (b'Date', b'Thu, 20 Mar 2025 14:31:27 GMT')])
2025-03-20 23:31:28,562 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 23:31:28,562 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 23:31:28,562 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 23:31:28,563 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 23:31:28,563 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 23:31:28,563 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1316', 'content-type': 'application/json', 'apim-request-id': '7cd05179-aa1e-49c0-897c-2178a14bcb60', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '998', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '93703', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '2152', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-02', 'x-envoy-upstream-service-time': '2203', 'x-ms-rai-invoked': 'true', 'x-request-id': '4612f79c-5f23-4cf2-b4ab-0fcae00abd47', 'ms-azureml-model-time': '2197', 'x-ms-client-request-id': '7cd05179-aa1e-49c0-897c-2178a14bcb60', 'azureml-model-session': 'v20250319-1-164616836', 'date': 'Thu, 20 Mar 2025 14:31:27 GMT'})
2025-03-20 23:31:28,564 - openai._base_client - DEBUG - request_id: 4612f79c-5f23-4cf2-b4ab-0fcae00abd47
2025-03-20 23:31:28,564 - application.modules.rag_agent - DEBUG - RAG応答: 給与計算は、従業員の給与を計算するプロセスで、標準的な手順に従って行われます。これには、適切な税金控除の適用が含まれます。最終的に、必要な形式でレポートを生成します。
2025-03-20 23:31:28,565 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('給与計算は、従業員の給与を計算するプロセスで、標準的な手順に従って行われます。これには、適切な税金控除の適用が含まれます。最終的に、必要な形式でレポートを生成します。', ''), type: <class 'tuple'>
2025-03-20 23:31:28,565 - application.services.payroll_service - DEBUG - Standardized response: (給与計算は、従業員の給与を計算するプロセスで、標準的な手順に従って行われます。これには、適切な税金控除の適用が含まれます。最終的に、必要な形式でレポートを生成します。, )
2025-03-20 23:31:46,457 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 23:31:46,457 - python_multipart.multipart - DEBUG - Calling on_header_field with data[42:61]
2025-03-20 23:31:46,457 - python_multipart.multipart - DEBUG - Calling on_header_value with data[63:118]
2025-03-20 23:31:46,458 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 23:31:46,458 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120:132]
2025-03-20 23:31:46,458 - python_multipart.multipart - DEBUG - Calling on_header_value with data[134:142]
2025-03-20 23:31:46,458 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 23:31:46,460 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 23:31:46,460 - python_multipart.multipart - DEBUG - Calling on_part_data with data[146:32768]
2025-03-20 23:31:46,461 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:49152]
2025-03-20 23:31:46,464 - python_multipart.multipart - DEBUG - Calling on_part_data with data[0:120621]
2025-03-20 23:31:46,464 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 23:31:46,465 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 23:31:46,465 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120665:120684]
2025-03-20 23:31:46,466 - python_multipart.multipart - DEBUG - Calling on_header_value with data[120686:120713]
2025-03-20 23:31:46,466 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 23:31:46,466 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 23:31:46,468 - python_multipart.multipart - DEBUG - Calling on_part_data with data[120717:120720]
2025-03-20 23:31:46,468 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 23:31:46,469 - python_multipart.multipart - DEBUG - Calling on_part_begin with no data
2025-03-20 23:31:46,469 - python_multipart.multipart - DEBUG - Calling on_header_field with data[120764:120783]
2025-03-20 23:31:46,469 - python_multipart.multipart - DEBUG - Calling on_header_value with data[120785:120813]
2025-03-20 23:31:46,471 - python_multipart.multipart - DEBUG - Calling on_header_end with no data
2025-03-20 23:31:46,471 - python_multipart.multipart - DEBUG - Calling on_headers_finished with no data
2025-03-20 23:31:46,471 - python_multipart.multipart - DEBUG - Calling on_part_data with data[120817:120853]
2025-03-20 23:31:46,472 - python_multipart.multipart - DEBUG - Calling on_part_end with no data
2025-03-20 23:31:46,472 - python_multipart.multipart - DEBUG - Calling on_end with no data
2025-03-20 23:31:46,475 - application.services.session_service - INFO - Created new session: 25452176-80d7-4991-bbd1-536952a9aa74
2025-03-20 23:31:46,475 - payroll_api - INFO - Invalid session ID provided, created new session: 25452176-80d7-4991-bbd1-536952a9aa74
2025-03-20 23:31:46,477 - payroll_api - INFO - File upload request from user admin, session 25452176-80d7-4991-bbd1-536952a9aa74: sikyu_csv_sample.csv
2025-03-20 23:31:46,479 - payroll_api - DEBUG - File saved to: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\a60cb099-1df1-42c7-89c9-45668f2fea25.csv
2025-03-20 23:31:46,527 - payroll_api - INFO - Successfully read file with 490 rows
2025-03-20 23:31:46,527 - application.modules.file_agent - INFO - store_csv_file開始: uploaded_60693e37-3b8d-4f1c-86b0-0a2fd6885035, definition=Uploaded CSV file, task_name=Manual Upload, rows=490
2025-03-20 23:31:46,529 - application.modules.file_agent - DEBUG - Database check successful. File count: 0
2025-03-20 23:31:46,532 - application.modules.file_agent - DEBUG - DataFrame info: {'columns': ['Unnamed: 0.1', 'Unnamed: 0', '従業員名', 'スタッフコード', 'グループ名', '給与規定グループ', '基本給', '基本給調整', '非課税通勤手当', '課税通勤手当', '通勤費調整（非）', '通勤費調整（課）', '自宅駐車場手当', '自宅駐車場手当調整', 'WFH 手当', 'WFH 手当調整', '単身赴任手当', '帰郷旅費手当', '赴任手当(課税)', '赴任手当(非課税)', '調整手当', '調整手当精算', '育児費用補助', '慶弔金', 'その他支給(課税）', 'その他支給(非課税）', 'Recognitionポイント', 'Recognition ポイント 所得税', 'その他報奨', 'その他報奨 所得税', '永年勤続', '交代勤務手当', '連操手当', '所定内残業手当', '普通残業手当', '深夜残業手当', '法定外休日残業手当', '法定休日残業手当', '60時間超手当', '時間外手当遡及', '代休控除', '遅刻早退欠勤控除', '経費', '支給合計', '課税支給合計', '非課税支給合計', '健康保険料', '健康保険料\u3000本人負担（翌月分）', '介護保険料', '介護保険料\u3000本人負担（翌月分）', '厚生年金保険料', '厚年保険料\u3000本人負担（翌月分）', '社会保険料調整\u3000本人負担', '雇用保険料', '社会保険料合計', 'DC加入者掛金', '所得税', '2024減税額', '2024減税後所得税', '住民税', '扶養是正', '還付徴収額（年調）', 'Recognition ポイント控除', '現物支給控除', '社用車プライベート使用料', '社宅費', '組合費', '給食費', '差押', '生保日本生命', '生保第一生命', '生保アフラック', '生保大樹', '積立貯蓄', '財形労金', 'その他控除', '控除合計', '差引支給額', '銀行振込１', '銀行振込２', '健保事業主負担', '介護事業主負担', '厚年事業主負担', '子育拠出金', '雇保事業主負担', '労災保険料', '一般拠出金', '確定拠出企業年金', 'キャッシュバランス', '出勤日数', '出勤時間', '所定内残業', '普通残業', '深夜残業', '法定外休日残業', '法定休日残業', '60時間超', '代休控除日数', '欠勤控除時間', '遅刻早退欠勤控除時間', '当月所定労働時間', '備考'], 'dtypes': {'Unnamed: 0.1': 'int64', 'Unnamed: 0': 'int64', '従業員名': 'float64', 'スタッフコード': 'int64', 'グループ名': 'float64', '給与規定グループ': 'object', '基本給': 'int64', '基本給調整': 'int64', '非課税通勤手当': 'int64', '課税通勤手当': 'int64', '通勤費調整（非）': 'int64', '通勤費調整（課）': 'int64', '自宅駐車場手当': 'int64', '自宅駐車場手当調整': 'int64', 'WFH 手当': 'int64', 'WFH 手当調整': 'int64', '単身赴任手当': 'int64', '帰郷旅費手当': 'int64', '赴任手当(課税)': 'int64', '赴任手当(非課税)': 'int64', '調整手当': 'int64', '調整手当精算': 'int64', '育児費用補助': 'int64', '慶弔金': 'int64', 'その他支給(課税）': 'int64', 'その他支給(非課税）': 'int64', 'Recognitionポイント': 'int64', 'Recognition ポイント 所得税': 'int64', 'その他報奨': 'int64', 'その他報奨 所得税': 'int64', '永年勤続': 'int64', '交代勤務手当': 'int64', '連操手当': 'int64', '所定内残業手当': 'int64', '普通残業手当': 'int64', '深夜残業手当': 'int64', '法定外休日残業手当': 'int64', '法定休日残業手当': 'int64', '60時間超手当': 'int64', '時間外手当遡及': 'int64', '代休控除': 'int64', '遅刻早退欠勤控除': 'int64', '経費': 'int64', '支給合計': 'int64', '課税支給合計': 'int64', '非課税支給合計': 'int64', '健康保険料': 'int64', '健康保険料\u3000本人負担（翌月分）': 'int64', '介護保険料': 'int64', '介護保険料\u3000本人負担（翌月分）': 'int64', '厚生年金保険料': 'int64', '厚年保険料\u3000本人負担（翌月分）': 'int64', '社会保険料調整\u3000本人負担': 'int64', '雇用保険料': 'int64', '社会保険料合計': 'int64', 'DC加入者掛金': 'int64', '所得税': 'int64', '2024減税額': 'int64', '2024減税後所得税': 'int64', '住民税': 'int64', '扶養是正': 'int64', '還付徴収額（年調）': 'int64', 'Recognition ポイント控除': 'int64', '現物支給控除': 'int64', '社用車プライベート使用料': 'int64', '社宅費': 'int64', '組合費': 'int64', '給食費': 'int64', '差押': 'int64', '生保日本生命': 'int64', '生保第一生命': 'int64', '生保アフラック': 'int64', '生保大樹': 'int64', '積立貯蓄': 'int64', '財形労金': 'int64', 'その他控除': 'int64', '控除合計': 'int64', '差引支給額': 'int64', '銀行振込１': 'int64', '銀行振込２': 'int64', '健保事業主負担': 'int64', '介護事業主負担': 'int64', '厚年事業主負担': 'int64', '子育拠出金': 'float64', '雇保事業主負担': 'float64', '労災保険料': 'float64', '一般拠出金': 'float64', '確定拠出企業年金': 'int64', 'キャッシュバランス': 'int64', '出勤日数': 'float64', '出勤時間': 'object', '所定内残業': 'object', '普通残業': 'object', '深夜残業': 'object', '法定外休日残業': 'object', '法定休日残業': 'object', '60時間超': 'object', '代休控除日数': 'float64', '欠勤控除時間': 'object', '遅刻早退欠勤控除時間': 'object', '当月所定労働時間': 'object', '備考': 'float64'}, 'has_nulls': {'Unnamed: 0.1': False, 'Unnamed: 0': False, '従業員名': True, 'スタッフコード': False, 'グループ名': False, '給与規定グループ': False, '基本給': False, '基本給調整': False, '非課税通勤手当': False, '課税通勤手当': False, '通勤費調整（非）': False, '通勤費調整（課）': False, '自宅駐車場手当': False, '自宅駐車場手当調整': False, 'WFH 手当': False, 'WFH 手当調整': False, '単身赴任手当': False, '帰郷旅費手当': False, '赴任手当(課税)': False, '赴任手当(非課税)': False, '調整手当': False, '調整手当精算': False, '育児費用補助': False, '慶弔金': False, 'その他支給(課税）': False, 'その他支給(非課税）': False, 'Recognitionポイント': False, 'Recognition ポイント 所得税': False, 'その他報奨': False, 'その他報奨 所得税': False, '永年勤続': False, '交代勤務手当': False, '連操手当': False, '所定内残業手当': False, '普通残業手当': False, '深夜残業手当': False, '法定外休日残業手当': False, '法定休日残業手当': False, '60時間超手当': False, '時間外手当遡及': False, '代休控除': False, '遅刻早退欠勤控除': False, '経費': False, '支給合計': False, '課税支給合計': False, '非課税支給合計': False, '健康保険料': False, '健康保険料\u3000本人負担（翌月分）': False, '介護保険料': False, '介護保険料\u3000本人負担（翌月分）': False, '厚生年金保険料': False, '厚年保険料\u3000本人負担（翌月分）': False, '社会保険料調整\u3000本人負担': False, '雇用保険料': False, '社会保険料合計': False, 'DC加入者掛金': False, '所得税': False, '2024減税額': False, '2024減税後所得税': False, '住民税': False, '扶養是正': False, '還付徴収額（年調）': False, 'Recognition ポイント控除': False, '現物支給控除': False, '社用車プライベート使用料': False, '社宅費': False, '組合費': False, '給食費': False, '差押': False, '生保日本生命': False, '生保第一生命': False, '生保アフラック': False, '生保大樹': False, '積立貯蓄': False, '財形労金': False, 'その他控除': False, '控除合計': False, '差引支給額': False, '銀行振込１': False, '銀行振込２': False, '健保事業主負担': False, '介護事業主負担': False, '厚年事業主負担': False, '子育拠出金': False, '雇保事業主負担': False, '労災保険料': False, '一般拠出金': False, '確定拠出企業年金': False, 'キャッシュバランス': False, '出勤日数': False, '出勤時間': False, '所定内残業': False, '普通残業': False, '深夜残業': False, '法定外休日残業': False, '法定休日残業': False, '60時間超': False, '代休控除日数': False, '欠勤控除時間': False, '遅刻早退欠勤控除時間': False, '当月所定労働時間': False, '備考': True}}
2025-03-20 23:31:46,543 - application.modules.file_agent - DEBUG - DataFile record created with ID: 1
2025-03-20 23:31:46,725 - application.modules.file_agent - DEBUG - Saved chunk 1 with 490 records
2025-03-20 23:31:46,742 - application.modules.file_agent - INFO - ファイルを保存しました。DataFile ID=1, 490 行, 1 chunks
2025-03-20 23:31:46,743 - payroll_api - INFO - File successfully stored in database with ID: 1
2025-03-20 23:31:46,744 - application.services.payroll_service - INFO - Processing message: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\a60cb099-1df1-42c7-89c9-45668f2fea25.csv
2025-03-20 23:31:46,744 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 23:31:46,744 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈
human: 給与計算について教えてください
AI: 意図=question

# 現在のユーザー入力
User: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\a60cb099-1df1-42c7-89c9-45668f2fea25.csv

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 23:31:46,753 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\nhuman: 給与計算について教えてください\nAI: 意図=question\n\n# 現在のユーザー入力\nUser: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\a60cb099-1df1-42c7-89c9-45668f2fea25.csv\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 23:31:46,754 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 23:31:46,756 - httpcore.connection - DEBUG - close.started
2025-03-20 23:31:46,757 - httpcore.connection - DEBUG - close.complete
2025-03-20 23:31:46,757 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 23:31:47,024 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690515E90>
2025-03-20 23:31:47,024 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000196F13D4F80> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 23:31:47,387 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690515610>
2025-03-20 23:31:47,388 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 23:31:47,389 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 23:31:47,389 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 23:31:47,391 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 23:31:47,391 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 23:31:48,110 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1258'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'41b07654-b696-49ab-9def-bb56f5ca8acf'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'997'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'90528'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'490'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'537'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'c9815857-f275-4c61-b275-ce72007a1943'), (b'ms-azureml-model-time', b'534'), (b'x-ms-client-request-id', b'41b07654-b696-49ab-9def-bb56f5ca8acf'), (b'azureml-model-session', b'v20250319-1-164616836'), (b'Date', b'Thu, 20 Mar 2025 14:31:47 GMT')])
2025-03-20 23:31:48,111 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 23:31:48,113 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 23:31:48,113 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 23:31:48,113 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 23:31:48,114 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 23:31:48,114 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1258', 'content-type': 'application/json', 'apim-request-id': '41b07654-b696-49ab-9def-bb56f5ca8acf', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '997', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '90528', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '490', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '537', 'x-ms-rai-invoked': 'true', 'x-request-id': 'c9815857-f275-4c61-b275-ce72007a1943', 'ms-azureml-model-time': '534', 'x-ms-client-request-id': '41b07654-b696-49ab-9def-bb56f5ca8acf', 'azureml-model-session': 'v20250319-1-164616836', 'date': 'Thu, 20 Mar 2025 14:31:47 GMT'})
2025-03-20 23:31:48,115 - openai._base_client - DEBUG - request_id: c9815857-f275-4c61-b275-ce72007a1943
2025-03-20 23:31:48,116 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'file_upload', 'file_type': 'csv'}
2025-03-20 23:31:48,117 - application.modules.file_agent - INFO - check_file_identity開始: file_path=C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\a60cb099-1df1-42c7-89c9-45668f2fea25.csv
2025-03-20 23:31:48,252 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('アップロードされたファイルは以下のファイルの一つと推定する：\n支給控除等一覧(データ更新)-支給・控除等一覧表\n支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表\n支給控除等一覧(後処理)-更新された支給・控除等一覧表\n支給控除等一覧(後処理)-削除リスト\n支給控除等一覧(後処理)-漢字変換リスト\nYonosukeデータ作成(加算処理)-給与明細データ\nYonosukeデータ作成(加算処理)-前月Yonosukeデータ\nYonosukeデータ作成(加算処理)-賞与データ\nYonosukeデータ作成(データ除去)-今月Yonosukeデータ\nYonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト', ''), type: <class 'tuple'>
2025-03-20 23:31:48,253 - application.services.payroll_service - DEBUG - Standardized response: (アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト, )
2025-03-20 23:31:48,254 - payroll_api - DEBUG - Payroll service processed message: アップロードされたファイルは以下のファイルの一つと推定する：
支給控除等一覧(データ更新)-支給・控除等一覧表
支給控除等一覧(データ更新)-支給控除一覧_社保手修正一覧表
支給控除等一覧(後処理)-更新された支給・控除等一覧表
支給控除等一覧(後処理)-削除リスト
支給控除等一覧(後処理)-漢字変換リスト
Yonosukeデータ作成(加算処理)-給与明細データ
Yonosukeデータ作成(加算処理)-前月Yonosukeデータ
Yonosukeデータ作成(加算処理)-賞与データ
Yonosukeデータ作成(データ除去)-今月Yonosukeデータ
Yonosukeデータ作成(データ除去)-Yonosukeの不要行の削除リスト
2025-03-20 23:31:48,260 - payroll_api - INFO - File uploaded successfully: sikyu_csv_sample.csv with 490 rows
2025-03-20 23:31:48,263 - payroll_api - DEBUG - Cleaned up temporary file: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\a60cb099-1df1-42c7-89c9-45668f2fea25.csv
2025-03-20 23:31:48,271 - application.services.session_service - INFO - Created new session: 9062f651-0570-4b3a-9549-17e02296038f
2025-03-20 23:31:48,272 - payroll_api - INFO - Invalid session ID provided, created new session: 9062f651-0570-4b3a-9549-17e02296038f
2025-03-20 23:31:48,273 - payroll_api - INFO - Files list requested by user admin for session 9062f651-0570-4b3a-9549-17e02296038f
2025-03-20 23:31:48,273 - application.services.file_service - INFO - Getting list of all files
2025-03-20 23:31:48,274 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 23:31:48,275 - application.modules.file_agent - DEBUG - Database check successful. File count: 1
2025-03-20 23:31:48,277 - application.modules.file_agent - INFO - Retrieved 1 files from database
2025-03-20 23:31:48,277 - application.services.file_service - INFO - Retrieved 1 files from database
2025-03-20 23:31:48,278 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x0000019690425F10>]
2025-03-20 23:31:48,278 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 23:31:46', 'row_count': 490, 'output': False}
2025-03-20 23:31:48,280 - application.services.file_service - INFO - Returning 1 processed files
2025-03-20 23:31:48,280 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 23:31:46', 'row_count': 490, 'output': False}]
2025-03-20 23:31:48,281 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 23:31:46', 'row_count': 490, 'output': False}]
2025-03-20 23:32:03,096 - application.services.session_service - INFO - Created new session: cdb57980-4f69-4d1a-9b82-e5195ff35ceb
2025-03-20 23:32:03,097 - payroll_api - INFO - Invalid session ID provided, created new session: cdb57980-4f69-4d1a-9b82-e5195ff35ceb
2025-03-20 23:32:03,098 - payroll_api - INFO - Processing chat message for user admin, session cdb57980-4f69-4d1a-9b82-e5195ff35ceb: こんにちは
2025-03-20 23:32:03,100 - application.services.payroll_service - INFO - Processing message: こんにちは
2025-03-20 23:32:03,100 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 23:32:03,101 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈
AI: 意図=question
human: 選択されたファイル: C:\Users\Udit Pradhan\formai_excelllm\InfoDeliver\web_application\uploads\a60cb099-1df1-42c7-89c9-45668f2fea25.csv
AI: 意図=file_upload

# 現在のユーザー入力
User: こんにちは

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 23:32:03,110 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\nAI: 意図=question\nhuman: 選択されたファイル: C:\\Users\\Udit Pradhan\\formai_excelllm\\InfoDeliver\\web_application\\uploads\\a60cb099-1df1-42c7-89c9-45668f2fea25.csv\nAI: 意図=file_upload\n\n# 現在のユーザー入力\nUser: こんにちは\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 23:32:03,113 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 23:32:03,114 - httpcore.connection - DEBUG - close.started
2025-03-20 23:32:03,115 - httpcore.connection - DEBUG - close.complete
2025-03-20 23:32:03,115 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 23:32:03,388 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690424210>
2025-03-20 23:32:03,389 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000196F13D4F80> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 23:32:03,753 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000196904226D0>
2025-03-20 23:32:03,753 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 23:32:03,754 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 23:32:03,754 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 23:32:03,754 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 23:32:03,755 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 23:32:04,547 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1263'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'9cab1c53-6bb6-4c93-a0a4-ae2ce2ad583d'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'996'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'87351'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'563'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'610'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'c24f5028-b106-461a-ac03-80935c7ce4a9'), (b'ms-azureml-model-time', b'606'), (b'x-ms-client-request-id', b'9cab1c53-6bb6-4c93-a0a4-ae2ce2ad583d'), (b'azureml-model-session', b'v20250319-1-164616836'), (b'Date', b'Thu, 20 Mar 2025 14:32:03 GMT')])
2025-03-20 23:32:04,549 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 23:32:04,549 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 23:32:04,549 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 23:32:04,550 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 23:32:04,550 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 23:32:04,550 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1263', 'content-type': 'application/json', 'apim-request-id': '9cab1c53-6bb6-4c93-a0a4-ae2ce2ad583d', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '996', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '87351', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '563', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '610', 'x-ms-rai-invoked': 'true', 'x-request-id': 'c24f5028-b106-461a-ac03-80935c7ce4a9', 'ms-azureml-model-time': '606', 'x-ms-client-request-id': '9cab1c53-6bb6-4c93-a0a4-ae2ce2ad583d', 'azureml-model-session': 'v20250319-1-164616836', 'date': 'Thu, 20 Mar 2025 14:32:03 GMT'})
2025-03-20 23:32:04,551 - openai._base_client - DEBUG - request_id: c24f5028-b106-461a-ac03-80935c7ce4a9
2025-03-20 23:32:04,552 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'question', 'query': 'こんにちは'}
2025-03-20 23:32:04,552 - application.modules.rag_agent - INFO - RAG_Agentに問い合わせ実行: こんにちは
2025-03-20 23:32:04,576 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': 'messages=[HumanMessage(content="You are an assistant for question-answering tasks. Use the following pieces of retrieved context to answer the question. If you don\'t know the answer, just say that you don\'t know. Use three sentences maximum and keep the answer concise.\\nQuestion: こんにちは(タスクを紹介する場合必ず定義を含め) \\nContext: # Sample Rule\\n\\n## Overview\\nThis is a sample rule file for testing the system.\\n\\n## Processing Rules\\n1. Handle payroll calculations according to standard procedures\\n2. Apply appropriate tax deductions\\n3. Generate reports in the required format \\nAnswer:", additional_kwargs={}, response_metadata={})]'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 23:32:04,578 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 23:32:04,579 - httpcore.connection - DEBUG - close.started
2025-03-20 23:32:04,579 - httpcore.connection - DEBUG - close.complete
2025-03-20 23:32:04,579 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 23:32:04,756 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690515ED0>
2025-03-20 23:32:04,756 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000196F13D5370> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 23:32:05,115 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690515B50>
2025-03-20 23:32:05,115 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 23:32:05,115 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 23:32:05,117 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 23:32:05,117 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 23:32:05,117 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 23:32:05,836 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1202'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'ae5070d8-acc8-4625-81a3-4db0d58e3f43'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'995'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'84195'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'479'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'533'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'96c56dd9-517d-4bb6-896f-d857d4c688b0'), (b'ms-azureml-model-time', b'530'), (b'x-ms-client-request-id', b'ae5070d8-acc8-4625-81a3-4db0d58e3f43'), (b'azureml-model-session', b'v20250319-1-164616836'), (b'Date', b'Thu, 20 Mar 2025 14:32:04 GMT')])
2025-03-20 23:32:05,837 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 23:32:05,837 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 23:32:05,838 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 23:32:05,838 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 23:32:05,838 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 23:32:05,838 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1202', 'content-type': 'application/json', 'apim-request-id': 'ae5070d8-acc8-4625-81a3-4db0d58e3f43', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '995', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '84195', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '479', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '533', 'x-ms-rai-invoked': 'true', 'x-request-id': '96c56dd9-517d-4bb6-896f-d857d4c688b0', 'ms-azureml-model-time': '530', 'x-ms-client-request-id': 'ae5070d8-acc8-4625-81a3-4db0d58e3f43', 'azureml-model-session': 'v20250319-1-164616836', 'date': 'Thu, 20 Mar 2025 14:32:04 GMT'})
2025-03-20 23:32:05,840 - openai._base_client - DEBUG - request_id: 96c56dd9-517d-4bb6-896f-d857d4c688b0
2025-03-20 23:32:05,841 - application.modules.rag_agent - DEBUG - RAG応答: I'm sorry, but I don't have enough information to answer your question. Could you please provide more context or clarify your question?
2025-03-20 23:32:05,841 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ("I'm sorry, but I don't have enough information to answer your question. Could you please provide more context or clarify your question?", ''), type: <class 'tuple'>
2025-03-20 23:32:05,841 - application.services.payroll_service - DEBUG - Standardized response: (I'm sorry, but I don't have enough information to answer your question. Could you please provide more context or clarify your question?, )
2025-03-20 23:32:17,999 - application.services.session_service - INFO - Created new session: 92a6772e-8679-4ab0-a3b8-088f3e10324e
2025-03-20 23:32:17,999 - payroll_api - INFO - Invalid session ID provided, created new session: 92a6772e-8679-4ab0-a3b8-088f3e10324e
2025-03-20 23:32:18,000 - payroll_api - INFO - Processing chat message for user admin, session 92a6772e-8679-4ab0-a3b8-088f3e10324e: 給与計算について教えてください
2025-03-20 23:32:18,003 - application.services.payroll_service - INFO - Processing message: 給与計算について教えてください
2025-03-20 23:32:18,003 - application.modules.intent_analyzer - DEBUG - IntentAnalyzer呼び出し
2025-03-20 23:32:18,004 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerのプロンプト:

# 会話文脈
AI: 意図=file_upload
human: こんにちは
AI: 意図=question

# 現在のユーザー入力
User: 給与計算について教えてください

# 現在使えるタスク
支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)

# タスク
上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。
以下のいずれかの形式でJSONとして返してください：

- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}
- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}
- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}
- 確認応答: {"intent": "confirmation", "response": true/false}
- メニューに戻る: {"intent": "return_to_menu"}
- 他: {"intent": "unknown"}

# 出力形式
JSON形式のみを出力してください。

2025-03-20 23:32:18,012 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': '\n# 会話文脈\nAI: 意図=file_upload\nhuman: こんにちは\nAI: 意図=question\n\n# 現在のユーザー入力\nUser: 給与計算について教えてください\n\n# 現在使えるタスク\n支給控除等一覧(データ更新) | 支給控除等一覧(後処理) | Yonosukeデータ作成(加算処理) | Yonosukeデータ作成(データ除去)\n\n# タスク\n上記の会話文脈とユーザー入力から、ユーザーの意図を解析してください。\n以下のいずれかの形式でJSONとして返してください：\n\n- 給与計算タスク開始: {"intent": "task_start", "task_name": "task1 | task2 | ..."}\n- 質問、紹介、問い合わせ: {"intent": "question", "query": "ユーザー入力"}\n- ファイルアップロード: {"intent": "file_upload", "file_type": "ファイル種類"}\n- 確認応答: {"intent": "confirmation", "response": true/false}\n- メニューに戻る: {"intent": "return_to_menu"}\n- 他: {"intent": "unknown"}\n\n# 出力形式\nJSON形式のみを出力してください。\n'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 23:32:18,014 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 23:32:18,014 - httpcore.connection - DEBUG - close.started
2025-03-20 23:32:18,015 - httpcore.connection - DEBUG - close.complete
2025-03-20 23:32:18,015 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 23:32:18,271 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690516AD0>
2025-03-20 23:32:18,271 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000196F13D4F80> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 23:32:18,635 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690516490>
2025-03-20 23:32:18,636 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 23:32:18,636 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 23:32:18,636 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 23:32:18,637 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 23:32:18,637 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 23:32:19,216 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1169'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'b2468151-6ea2-456d-9a44-0cf65a07a599'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'994'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'81046'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'345'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-02'), (b'x-envoy-upstream-service-time', b'393'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'd54e16ab-f021-4b4e-abdf-5b52895cd308'), (b'ms-azureml-model-time', b'391'), (b'x-ms-client-request-id', b'b2468151-6ea2-456d-9a44-0cf65a07a599'), (b'azureml-model-session', b'v20250319-1-164616836'), (b'Date', b'Thu, 20 Mar 2025 14:32:18 GMT')])
2025-03-20 23:32:19,217 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 23:32:19,217 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 23:32:19,218 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 23:32:19,218 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 23:32:19,219 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 23:32:19,219 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1169', 'content-type': 'application/json', 'apim-request-id': 'b2468151-6ea2-456d-9a44-0cf65a07a599', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '994', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '81046', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '345', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-02', 'x-envoy-upstream-service-time': '393', 'x-ms-rai-invoked': 'true', 'x-request-id': 'd54e16ab-f021-4b4e-abdf-5b52895cd308', 'ms-azureml-model-time': '391', 'x-ms-client-request-id': 'b2468151-6ea2-456d-9a44-0cf65a07a599', 'azureml-model-session': 'v20250319-1-164616836', 'date': 'Thu, 20 Mar 2025 14:32:18 GMT'})
2025-03-20 23:32:19,220 - openai._base_client - DEBUG - request_id: d54e16ab-f021-4b4e-abdf-5b52895cd308
2025-03-20 23:32:19,220 - application.modules.intent_analyzer - DEBUG - IntentAnalyzerの解析結果: {'intent': 'question', 'query': '給与計算について教えてください'}
2025-03-20 23:32:19,222 - application.modules.rag_agent - INFO - RAG_Agentに問い合わせ実行: 給与計算について教えてください
2025-03-20 23:32:19,251 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/deployments/gptest/chat/completions', 'headers': {'api-key': '<redacted>'}, 'files': None, 'json_data': {'messages': [{'role': 'user', 'content': [{'type': 'text', 'text': 'messages=[HumanMessage(content="You are an assistant for question-answering tasks. Use the following pieces of retrieved context to answer the question. If you don\'t know the answer, just say that you don\'t know. Use three sentences maximum and keep the answer concise.\\nQuestion: 給与計算について教えてください(タスクを紹介する場合必ず定義を含め) \\nContext: # Sample Rule\\n\\n## Overview\\nThis is a sample rule file for testing the system.\\n\\n## Processing Rules\\n1. Handle payroll calculations according to standard procedures\\n2. Apply appropriate tax deductions\\n3. Generate reports in the required format \\nAnswer:", additional_kwargs={}, response_metadata={})]'}]}], 'model': 'gptest', 'max_tokens': 3000, 'temperature': 0}}
2025-03-20 23:32:19,253 - openai._base_client - DEBUG - Sending HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview
2025-03-20 23:32:19,253 - httpcore.connection - DEBUG - close.started
2025-03-20 23:32:19,254 - httpcore.connection - DEBUG - close.complete
2025-03-20 23:32:19,254 - httpcore.connection - DEBUG - connect_tcp.started host='formaigpt.openai.azure.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-03-20 23:32:19,423 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690525BD0>
2025-03-20 23:32:19,424 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000196F13D5370> server_hostname='formaigpt.openai.azure.com' timeout=5.0
2025-03-20 23:32:19,772 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000019690524050>
2025-03-20 23:32:19,772 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-03-20 23:32:19,774 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-20 23:32:19,774 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-03-20 23:32:19,774 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-20 23:32:19,774 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-03-20 23:32:21,988 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Length', b'1316'), (b'Content-Type', b'application/json'), (b'apim-request-id', b'3d3f7206-78ff-40f5-84a0-2f91a73dea12'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'x-content-type-options', b'nosniff'), (b'x-ms-region', b'East US'), (b'x-ratelimit-remaining-requests', b'993'), (b'x-ratelimit-limit-requests', b'1000'), (b'x-ratelimit-remaining-tokens', b'77887'), (b'x-ratelimit-limit-tokens', b'100000'), (b'cmp-upstream-response-duration', b'1986'), (b'x-accel-buffering', b'no'), (b'x-aml-cluster', b'hyena-eastus-01'), (b'x-envoy-upstream-service-time', b'2030'), (b'x-ms-rai-invoked', b'true'), (b'x-request-id', b'4445b54d-74e0-4f76-99df-84afac8992f1'), (b'ms-azureml-model-time', b'2028'), (b'x-ms-client-request-id', b'3d3f7206-78ff-40f5-84a0-2f91a73dea12'), (b'azureml-model-session', b'v20250319-1-164616836'), (b'Date', b'Thu, 20 Mar 2025 14:32:21 GMT')])
2025-03-20 23:32:21,989 - httpx - INFO - HTTP Request: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-03-20 23:32:21,990 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-03-20 23:32:21,990 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-20 23:32:21,991 - httpcore.http11 - DEBUG - response_closed.started
2025-03-20 23:32:21,991 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-20 23:32:21,991 - openai._base_client - DEBUG - HTTP Response: POST https://formaigpt.openai.azure.com/openai/deployments/gptest/chat/completions?api-version=2024-02-15-preview "200 OK" Headers({'content-length': '1316', 'content-type': 'application/json', 'apim-request-id': '3d3f7206-78ff-40f5-84a0-2f91a73dea12', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'x-ms-region': 'East US', 'x-ratelimit-remaining-requests': '993', 'x-ratelimit-limit-requests': '1000', 'x-ratelimit-remaining-tokens': '77887', 'x-ratelimit-limit-tokens': '100000', 'cmp-upstream-response-duration': '1986', 'x-accel-buffering': 'no', 'x-aml-cluster': 'hyena-eastus-01', 'x-envoy-upstream-service-time': '2030', 'x-ms-rai-invoked': 'true', 'x-request-id': '4445b54d-74e0-4f76-99df-84afac8992f1', 'ms-azureml-model-time': '2028', 'x-ms-client-request-id': '3d3f7206-78ff-40f5-84a0-2f91a73dea12', 'azureml-model-session': 'v20250319-1-164616836', 'date': 'Thu, 20 Mar 2025 14:32:21 GMT'})
2025-03-20 23:32:21,992 - openai._base_client - DEBUG - request_id: 4445b54d-74e0-4f76-99df-84afac8992f1
2025-03-20 23:32:21,993 - application.modules.rag_agent - DEBUG - RAG応答: 給与計算は、従業員の給与を計算するプロセスで、標準的な手順に従って行われます。これには、適切な税金控除の適用が含まれます。最終的に、必要な形式でレポートを生成します。
2025-03-20 23:32:21,993 - application.services.payroll_service - DEBUG - Result from agent_collection.process_message: ('給与計算は、従業員の給与を計算するプロセスで、標準的な手順に従って行われます。これには、適切な税金控除の適用が含まれます。最終的に、必要な形式でレポートを生成します。', ''), type: <class 'tuple'>
2025-03-20 23:32:21,993 - application.services.payroll_service - DEBUG - Standardized response: (給与計算は、従業員の給与を計算するプロセスで、標準的な手順に従って行われます。これには、適切な税金控除の適用が含まれます。最終的に、必要な形式でレポートを生成します。, )
2025-03-20 23:46:00,287 - application.services.session_service - INFO - Created new session: 785be1ca-c065-4270-a7b3-0f7b573342a4
2025-03-20 23:46:00,288 - payroll_api - INFO - Invalid session ID provided, created new session: 785be1ca-c065-4270-a7b3-0f7b573342a4
2025-03-20 23:46:00,326 - payroll_api - INFO - Task list requested by user admin for session 785be1ca-c065-4270-a7b3-0f7b573342a4
2025-03-20 23:46:00,327 - payroll_api - ERROR - Error getting tasks: 'TaskResponse' object has no attribute 'get'
2025-03-20 23:46:00,332 - application.services.session_service - INFO - Created new session: ab40482b-1036-42c8-b17c-dd8086d92467
2025-03-20 23:46:00,334 - payroll_api - INFO - Invalid session ID provided, created new session: ab40482b-1036-42c8-b17c-dd8086d92467
2025-03-20 23:46:00,340 - payroll_api - INFO - Files list requested by user admin for session ab40482b-1036-42c8-b17c-dd8086d92467
2025-03-20 23:46:00,342 - application.services.file_service - INFO - Getting list of all files
2025-03-20 23:46:00,344 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 23:46:00,348 - application.modules.file_agent - DEBUG - Database check successful. File count: 1
2025-03-20 23:46:00,351 - application.modules.file_agent - INFO - Retrieved 1 files from database
2025-03-20 23:46:00,352 - application.services.file_service - INFO - Retrieved 1 files from database
2025-03-20 23:46:00,354 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x00000196905264D0>]
2025-03-20 23:46:00,357 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 23:31:46', 'row_count': 490, 'output': False}
2025-03-20 23:46:00,359 - application.services.file_service - INFO - Returning 1 processed files
2025-03-20 23:46:00,360 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 23:31:46', 'row_count': 490, 'output': False}]
2025-03-20 23:46:00,362 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 23:31:46', 'row_count': 490, 'output': False}]
2025-03-20 23:46:00,371 - application.services.session_service - INFO - Created new session: 474ca2e5-b216-4380-af47-2e64e479ed35
2025-03-20 23:46:00,372 - payroll_api - INFO - Invalid session ID provided, created new session: 474ca2e5-b216-4380-af47-2e64e479ed35
2025-03-20 23:46:00,377 - payroll_api - INFO - Session history list requested by user admin for session 474ca2e5-b216-4380-af47-2e64e479ed35
2025-03-20 23:46:00,411 - application.services.session_service - INFO - Created new session: ded8ae0f-e81e-4481-9f49-fe59b680bf01
2025-03-20 23:46:00,411 - payroll_api - INFO - Invalid session ID provided, created new session: ded8ae0f-e81e-4481-9f49-fe59b680bf01
2025-03-20 23:46:00,416 - payroll_api - INFO - Task list requested by user admin for session ded8ae0f-e81e-4481-9f49-fe59b680bf01
2025-03-20 23:46:00,416 - payroll_api - ERROR - Error getting tasks: 'TaskResponse' object has no attribute 'get'
2025-03-20 23:46:00,424 - application.services.session_service - INFO - Created new session: 3f567035-3b43-4061-8439-d7a7b970303b
2025-03-20 23:46:00,425 - payroll_api - INFO - Invalid session ID provided, created new session: 3f567035-3b43-4061-8439-d7a7b970303b
2025-03-20 23:46:00,427 - payroll_api - INFO - Files list requested by user admin for session 3f567035-3b43-4061-8439-d7a7b970303b
2025-03-20 23:46:00,428 - application.services.file_service - INFO - Getting list of all files
2025-03-20 23:46:00,429 - application.modules.file_agent - DEBUG - get_all_files開始
2025-03-20 23:46:00,431 - application.modules.file_agent - DEBUG - Database check successful. File count: 1
2025-03-20 23:46:00,433 - application.modules.file_agent - INFO - Retrieved 1 files from database
2025-03-20 23:46:00,434 - application.services.file_service - INFO - Retrieved 1 files from database
2025-03-20 23:46:00,434 - application.services.file_service - DEBUG - Raw files from database: [<application.modules.file_agent.DataFile object at 0x0000019690549CD0>]
2025-03-20 23:46:00,435 - application.services.file_service - DEBUG - Processed file: {'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 23:31:46', 'row_count': 490, 'output': False}
2025-03-20 23:46:00,437 - application.services.file_service - INFO - Returning 1 processed files
2025-03-20 23:46:00,438 - payroll_api - DEBUG - Raw files from file_service: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 23:31:46', 'row_count': 490, 'output': False}]
2025-03-20 23:46:00,439 - payroll_api - DEBUG - Adapted files for frontend: [{'id': 1, 'name': 'sikyu_csv_sample.csv', 'task_name': 'Manual Upload', 'upload_date': '2025-03-20 23:31:46', 'row_count': 490, 'output': False}]
2025-03-20 23:46:00,445 - application.services.session_service - INFO - Created new session: 8abb2f59-c441-42fe-96be-0daafeb58da5
2025-03-20 23:46:00,445 - payroll_api - INFO - Invalid session ID provided, created new session: 8abb2f59-c441-42fe-96be-0daafeb58da5
2025-03-20 23:46:00,494 - payroll_api - INFO - Session history list requested by user admin for session 8abb2f59-c441-42fe-96be-0daafeb58da5
2025-03-20 23:46:15,546 - payroll_api - INFO - Conversation history requested by user admin for session 8abb2f59-c441-42fe-96be-0daafeb58da5
2025-03-20 23:46:15,547 - payroll_api - ERROR - Error getting conversation history: Session 8abb2f59-c441-42fe-96be-0daafeb58da5 not found or has no history
